{
  "systemPrompt": "당신은 PowerPoint 편집 전문가입니다. 기존 PPTX 파일을 읽고, 슬라이드를 수정/추가/삭제할 때 반드시 Python(python-pptx) 스크립트를 작성하여 command_execute로 실행합니다. 원본 파일을 직접 덮어쓰지 않고 새 파일로 저장합니다. 스크립트 실행 결과를 사용자에게 명확히 안내합니다.\n\n## 핵심 실행 규칙 (반드시 준수)\n\n1. **스크립트 작성 후 반드시 즉시 실행**: Python 스크립트를 file_write로 작성한 직후, 반드시 command_execute로 실행하세요. 스크립트만 작성하고 실행하지 않는 것은 절대 금지입니다.\n2. **사용자에게 수동 설치를 절대 요청하지 마세요**: `pip install`을 사용자에게 직접 실행하라고 안내하지 마세요. 모든 패키지 설치는 SEPilot venv 내에서 자동 처리합니다.\n3. **SEPilot venv 환경 사용 (필수)**: 글로벌 Python에 직접 pip install하지 마세요. 반드시 SEPilot 전용 가상환경을 사용합니다.\n   - command_execute 원샷 패턴:\n     ```bash\n     VENV=\"$HOME/.sepilot/environments/python\" && \\\n     (test -f \"$VENV/bin/python\" || python3 -m venv \"$VENV\") && \\\n     \"$VENV/bin/pip\" install -q python-pptx && \\\n     \"$VENV/bin/python\" /path/to/script.py\n     ```\n   - 스크립트 내부 패턴:\n     ```python\n     import subprocess, os\n     VENV = os.path.expanduser('~/.sepilot/environments/python')\n     BIN = 'Scripts' if os.name == 'nt' else 'bin'\n     VENV_PIP = os.path.join(VENV, BIN, 'pip')\n     subprocess.check_call([VENV_PIP, 'install', '-q', 'python-pptx'])\n     ```\n4. **Python 환경 자동 감지**: `python3`이 실패하면 `python`으로 venv 생성을 재시도하세요.\n5. **패키지 미설치를 이유로 작업을 중단하지 마세요**: venv 내에서 자동으로 설치 후 재시도합니다.\n\n## 디자인 품질 규칙 (편집 시)\n\n1. 기존 슬라이드의 컬러 스킴을 파악하고 일관성 유지\n2. 텍스트 추가/수정 시 반드시 font.color.rgb 명시 — 기본값에 의존하면 흰 배경에 흰 글자가 될 수 있음\n3. 새 슬라이드 추가 시 기존 디자인 패턴(헤더 바, 배경색, 폰트 크기)을 따름\n4. 배경색 대비 텍스트 가독성 확인 — 밝은 배경에는 어두운 텍스트(0x2D,0x2D,0x2D), 어두운 배경에는 밝은 텍스트(0xF5,0xF5,0xF5)\n5. 도형, 표, 이미지 추가 시 기존 위치/여백 패턴을 분석하고 따름",
  "knowledge": [
    {
      "title": "PowerPoint 파일 읽기 및 구조 탐색",
      "content": "# PowerPoint 파일 읽기 및 구조 탐색\n\n## 설치\n```bash\npip install python-pptx\n```\n\n## 프레젠테이션 열기 및 기본 정보\n```python\nfrom pptx import Presentation\nfrom pptx.util import Inches, Pt, Cm, Emu\n\nprs = Presentation('input.pptx')\n\nprint(f'슬라이드 수: {len(prs.slides)}')\nprint(f'슬라이드 크기: {prs.slide_width.inches}\" x {prs.slide_height.inches}\"')\nprint(f'레이아웃 수: {len(prs.slide_layouts)}')\n\nfor i, layout in enumerate(prs.slide_layouts):\n    print(f'  레이아웃 {i}: {layout.name}')\n```\n\n## 슬라이드 내용 읽기\n```python\nfor i, slide in enumerate(prs.slides):\n    print(f'\\n=== 슬라이드 {i+1} ===')\n    print(f'레이아웃: {slide.slide_layout.name}')\n    print(f'도형 수: {len(slide.shapes)}')\n\n    for shape in slide.shapes:\n        print(f'\\n  도형: {shape.shape_type}, 이름: {shape.name}')\n        print(f'  위치: ({shape.left}, {shape.top}), 크기: ({shape.width}, {shape.height})')\n\n        if shape.has_text_frame:\n            for para in shape.text_frame.paragraphs:\n                text = para.text\n                if text.strip():\n                    print(f'  텍스트: {text}')\n\n        if shape.has_table:\n            table = shape.table\n            print(f'  표: {table.rows.__len__()}행 x {len(table.columns)}열')\n            for row in table.rows:\n                cells = [cell.text for cell in row.cells]\n                print(f'    {cells}')\n\n        if hasattr(shape, 'image'):\n            print(f'  이미지: {shape.image.content_type}')\n```\n\n## 전체 텍스트 추출\n```python\ndef extract_all_text(pptx_path):\n    prs = Presentation(pptx_path)\n    all_text = []\n    for i, slide in enumerate(prs.slides):\n        slide_text = []\n        for shape in slide.shapes:\n            if shape.has_text_frame:\n                for para in shape.text_frame.paragraphs:\n                    if para.text.strip():\n                        slide_text.append(para.text)\n            if shape.has_table:\n                for row in shape.table.rows:\n                    for cell in row.cells:\n                        if cell.text.strip():\n                            slide_text.append(cell.text)\n        all_text.append({\n            'slide': i + 1,\n            'layout': slide.slide_layout.name,\n            'text': slide_text\n        })\n    return all_text\n\nresult = extract_all_text('input.pptx')\nfor slide in result:\n    print(f\"\\n[슬라이드 {slide['slide']}] ({slide['layout']})\")\n    for text in slide['text']:\n        print(f'  - {text}')\n```\n\n## 슬라이드 노트 읽기\n```python\nfor i, slide in enumerate(prs.slides):\n    if slide.has_notes_slide:\n        notes = slide.notes_slide.notes_text_frame.text\n        if notes.strip():\n            print(f'슬라이드 {i+1} 노트: {notes}')\n```"
    },
    {
      "title": "슬라이드 텍스트 수정",
      "content": "# 슬라이드 텍스트 수정\n\n## 특정 텍스트 찾아 바꾸기\n```python\nfrom pptx import Presentation\nfrom copy import deepcopy\n\ndef replace_text_in_pptx(pptx_path, replacements, output_path):\n    \"\"\"프레젠테이션 전체에서 텍스트를 찾아 바꿉니다.\n    \n    Args:\n        replacements: {\"찾을 텍스트\": \"바꿀 텍스트\", ...}\n    \"\"\"\n    prs = Presentation(pptx_path)\n    count = 0\n\n    for slide in prs.slides:\n        for shape in slide.shapes:\n            if shape.has_text_frame:\n                for para in shape.text_frame.paragraphs:\n                    for run in para.runs:\n                        for old, new in replacements.items():\n                            if old in run.text:\n                                run.text = run.text.replace(old, new)\n                                count += 1\n\n            if shape.has_table:\n                for row in shape.table.rows:\n                    for cell in row.cells:\n                        for para in cell.text_frame.paragraphs:\n                            for run in para.runs:\n                                for old, new in replacements.items():\n                                    if old in run.text:\n                                        run.text = run.text.replace(old, new)\n                                        count += 1\n\n    prs.save(output_path)\n    print(f'{count}건 텍스트 교체 완료: {output_path}')\n\n# 사용 예시\nreplace_text_in_pptx(\n    'input.pptx',\n    {\n        '2024년': '2025년',\n        '홍길동': '김철수',\n        'OOO 프로젝트': '신규 프로젝트'\n    },\n    'output.pptx'\n)\n```\n\n## 특정 슬라이드 텍스트 수정\n```python\nfrom pptx import Presentation\nfrom pptx.util import Pt\nfrom pptx.dml.color import RGBColor\n\nprs = Presentation('input.pptx')\nslide = prs.slides[0]  # 첫 번째 슬라이드\n\n# 제목 수정\nif slide.shapes.title:\n    slide.shapes.title.text = '새로운 제목'\n\n# 특정 도형 찾아 수정\nfor shape in slide.shapes:\n    if shape.has_text_frame and '기존 텍스트' in shape.text:\n        tf = shape.text_frame\n        tf.clear()  # 기존 내용 지우기\n        p = tf.paragraphs[0]\n        run = p.add_run()\n        run.text = '수정된 텍스트'\n        run.font.size = Pt(24)\n        run.font.bold = True\n        run.font.color.rgb = RGBColor(0xFF, 0x00, 0x00)\n\nprs.save('output.pptx')\n```\n\n## Run 단위 서식 유지하며 텍스트만 변경\n```python\ndef replace_run_text(shape, old_text, new_text):\n    \"\"\"Run 서식을 유지하면서 텍스트만 교체합니다.\"\"\"\n    if not shape.has_text_frame:\n        return False\n    replaced = False\n    for para in shape.text_frame.paragraphs:\n        full_text = para.text\n        if old_text in full_text:\n            # 모든 run의 텍스트를 합쳐서 교체\n            new_full = full_text.replace(old_text, new_text)\n            # 첫 run에 전체 텍스트, 나머지 run 비우기\n            if para.runs:\n                para.runs[0].text = new_full\n                for run in para.runs[1:]:\n                    run.text = ''\n                replaced = True\n    return replaced\n```\n\n## 슬라이드 노트 수정/추가\n```python\nfrom pptx import Presentation\n\nprs = Presentation('input.pptx')\n\nfor i, slide in enumerate(prs.slides):\n    # 노트 슬라이드 가져오기 (없으면 생성)\n    if not slide.has_notes_slide:\n        notes_slide = slide.notes_slide  # 자동 생성됨\n    else:\n        notes_slide = slide.notes_slide\n\n    tf = notes_slide.notes_text_frame\n    tf.text = f'슬라이드 {i+1} 발표 노트:\\n이 슬라이드에서는...'\n\nprs.save('output_with_notes.pptx')\nprint('노트 추가 완료')\n```"
    },
    {
      "title": "슬라이드 추가, 삭제, 복제, 순서 변경",
      "content": "# 슬라이드 추가, 삭제, 복제, 순서 변경\n\n## 빈 슬라이드 추가\n```python\nfrom pptx import Presentation\nfrom pptx.util import Inches, Pt\n\nprs = Presentation('input.pptx')\n\n# 레이아웃 선택 (인덱스 또는 이름으로)\nlayout = prs.slide_layouts[6]  # 보통 빈 슬라이드\n# 또는 이름으로 찾기\nfor sl in prs.slide_layouts:\n    if sl.name == 'Blank':\n        layout = sl\n        break\n\nslide = prs.slides.add_slide(layout)\n\n# 텍스트 박스 추가\nfrom pptx.util import Inches, Pt\ntxBox = slide.shapes.add_textbox(Inches(1), Inches(1), Inches(8), Inches(1))\ntf = txBox.text_frame\ntf.text = '새로 추가된 슬라이드'\n\nprs.save('output.pptx')\nprint(f'슬라이드 추가 완료. 총 {len(prs.slides)}장')\n```\n\n## 슬라이드 삭제\n```python\nfrom pptx import Presentation\nimport lxml.etree as etree\n\ndef delete_slide(prs, slide_index):\n    \"\"\"특정 인덱스의 슬라이드를 삭제합니다.\"\"\"\n    rId = prs.slides._sldIdLst[slide_index].get('r:id')\n    prs.part.drop_rel(rId)\n    del prs.slides._sldIdLst[slide_index]\n\nprs = Presentation('input.pptx')\nprint(f'삭제 전: {len(prs.slides)}장')\n\n# 마지막 슬라이드 삭제\ndelete_slide(prs, len(prs.slides) - 1)\n\n# 여러 슬라이드 삭제 (뒤에서부터 삭제해야 인덱스 꼬이지 않음)\nfor idx in sorted([2, 5, 7], reverse=True):\n    if idx < len(prs.slides):\n        delete_slide(prs, idx)\n\nprint(f'삭제 후: {len(prs.slides)}장')\nprs.save('output.pptx')\n```\n\n## 슬라이드 복제\n```python\nfrom pptx import Presentation\nfrom copy import deepcopy\nfrom lxml import etree\nimport copy\n\ndef duplicate_slide(prs, slide_index):\n    \"\"\"슬라이드를 복제하여 끝에 추가합니다.\"\"\"\n    source = prs.slides[slide_index]\n    layout = source.slide_layout\n    new_slide = prs.slides.add_slide(layout)\n\n    # 기존 도형 제거\n    for shape in list(new_slide.shapes):\n        sp = shape._element\n        sp.getparent().remove(sp)\n\n    # 원본 도형 복사\n    for shape in source.shapes:\n        el = copy.deepcopy(shape._element)\n        new_slide.shapes._spTree.append(el)\n\n    # 이미지 등 관계(relationship) 복사\n    for rel in source.part.rels.values():\n        if 'image' in rel.reltype:\n            new_slide.part.rels.get_or_add(rel.reltype, rel.target_part)\n\n    return new_slide\n\nprs = Presentation('input.pptx')\nnew_slide = duplicate_slide(prs, 0)  # 첫 슬라이드 복제\nprs.save('output.pptx')\nprint('슬라이드 복제 완료')\n```\n\n## 슬라이드 순서 변경\n```python\nfrom pptx import Presentation\n\ndef move_slide(prs, old_index, new_index):\n    \"\"\"슬라이드를 old_index에서 new_index로 이동합니다.\"\"\"\n    slides = list(prs.slides._sldIdLst)\n    slide = slides.pop(old_index)\n    slides.insert(new_index, slide)\n    # 재구성\n    for s in prs.slides._sldIdLst[:]:\n        prs.slides._sldIdLst.remove(s)\n    for s in slides:\n        prs.slides._sldIdLst.append(s)\n\nprs = Presentation('input.pptx')\nmove_slide(prs, 3, 0)  # 4번째 슬라이드를 맨 앞으로\nprs.save('output.pptx')\nprint('슬라이드 순서 변경 완료')\n```"
    },
    {
      "title": "도형, 이미지, 표 수정 및 고급 편집",
      "content": "# 도형, 이미지, 표 수정 및 고급 편집\n\n## 도형 추가/수정\n```python\nfrom pptx import Presentation\nfrom pptx.util import Inches, Pt, Cm\nfrom pptx.dml.color import RGBColor\nfrom pptx.enum.shapes import MSO_SHAPE\nfrom pptx.enum.text import PP_ALIGN\n\nprs = Presentation('input.pptx')\nslide = prs.slides[0]\n\n# 사각형 도형 추가\nshape = slide.shapes.add_shape(\n    MSO_SHAPE.ROUNDED_RECTANGLE,\n    Inches(1), Inches(2), Inches(4), Inches(1.5)\n)\nshape.fill.solid()\nshape.fill.fore_color.rgb = RGBColor(0x00, 0x70, 0xC0)\nshape.line.color.rgb = RGBColor(0x00, 0x50, 0x90)\nshape.line.width = Pt(2)\n\n# 도형에 텍스트\ntf = shape.text_frame\ntf.word_wrap = True\np = tf.paragraphs[0]\np.text = '중요 사항'\np.font.size = Pt(16)\np.font.bold = True\np.font.color.rgb = RGBColor(0xFF, 0xFF, 0xFF)\np.alignment = PP_ALIGN.CENTER\n\n# 기존 도형 수정 (이름으로 찾기)\nfor shape in slide.shapes:\n    if shape.name == 'TextBox 1':\n        shape.text_frame.paragraphs[0].text = '수정됨'\n    if shape.name == 'Rectangle 1':\n        shape.fill.fore_color.rgb = RGBColor(0xFF, 0x00, 0x00)\n\nprs.save('output.pptx')\n```\n\n## 이미지 교체/추가\n```python\nfrom pptx import Presentation\nfrom pptx.util import Inches\n\nprs = Presentation('input.pptx')\nslide = prs.slides[0]\n\n# 이미지 추가\nslide.shapes.add_picture(\n    'new_logo.png',\n    Inches(8), Inches(0.5),  # 위치\n    width=Inches(1.5)         # 크기 (비율 자동 유지)\n)\n\n# 기존 이미지 교체 (위치/크기 유지)\nfor shape in slide.shapes:\n    if shape.shape_type == 13:  # 이미지 타입\n        if 'logo' in shape.name.lower():\n            # 위치와 크기 저장\n            left, top = shape.left, shape.top\n            width, height = shape.width, shape.height\n            # 기존 이미지 삭제\n            sp = shape._element\n            sp.getparent().remove(sp)\n            # 새 이미지 추가\n            slide.shapes.add_picture(\n                'new_logo.png', left, top, width, height\n            )\n            break\n\nprs.save('output.pptx')\n```\n\n## 표 수정\n```python\nfrom pptx import Presentation\nfrom pptx.util import Inches, Pt\nfrom pptx.dml.color import RGBColor\n\nprs = Presentation('input.pptx')\n\n# 표가 있는 슬라이드 찾기\nfor slide in prs.slides:\n    for shape in slide.shapes:\n        if shape.has_table:\n            table = shape.table\n            print(f'표 발견: {len(table.rows)}행 x {len(table.columns)}열')\n\n            # 셀 값 수정\n            table.cell(0, 0).text = '수정된 헤더'\n            table.cell(1, 2).text = '999'\n\n            # 행 추가 (python-pptx 직접 지원 없음, XML 조작 필요)\n            # 대안: 새 표를 만들어 교체\n\n            # 셀 서식 변경\n            for i, cell in enumerate(table.rows[0].cells):\n                for para in cell.text_frame.paragraphs:\n                    para.font.bold = True\n                    para.font.size = Pt(11)\n                    para.font.color.rgb = RGBColor(0xFF, 0xFF, 0xFF)\n                cell.fill.solid()\n                cell.fill.fore_color.rgb = RGBColor(0x2F, 0x54, 0x96)\n\nprs.save('output.pptx')\n```\n\n## 마스터 슬라이드/테마 색상 변경\n```python\nfrom pptx import Presentation\n\nprs = Presentation('input.pptx')\n\n# 슬라이드 마스터 정보\nfor master in prs.slide_masters:\n    print(f'마스터: {len(master.slide_layouts)}개 레이아웃')\n    for layout in master.slide_layouts:\n        print(f'  - {layout.name}')\n\n# 배경색 변경\nfrom pptx.dml.color import RGBColor\nfrom pptx.enum.dml import MSO_THEME_COLOR\n\nslide = prs.slides[0]\nbackground = slide.background\nfill = background.fill\nfill.solid()\nfill.fore_color.rgb = RGBColor(0x1a, 0x1a, 0x2e)\n\nprs.save('output.pptx')\n```\n\n## 공통 워크플로우\n```bash\n# PPTX 읽기/분석\npip install python-pptx && python read_pptx.py\n\n# PPTX 수정 (새 파일 저장)\npip install python-pptx && python edit_pptx.py\n\n# 이미지 삽입 포함\npip install python-pptx Pillow && python edit_pptx.py\n```\n\n## 에러 처리\n```python\nimport sys\ntry:\n    prs = Presentation(input_path)\nexcept Exception as e:\n    print(f'PPTX 열기 실패: {e}', file=sys.stderr)\n    sys.exit(1)\n\n# 주의: 원본 파일 보호\noutput_path = input_path.replace('.pptx', '_modified.pptx')\nprs.save(output_path)\nprint(f'저장 완료: {output_path}')\n```"
    },
    {
      "title": "슬라이드 디자인 개선 및 프로페셔널 스타일 적용",
      "content": "# 슬라이드 디자인 개선 및 프로페셔널 스타일 적용\n\n## 컬러 스킴 (5가지)\n\n기존 PPTX를 편집하거나 새 슬라이드를 추가할 때 일관된 컬러 스킴을 적용합니다.\n\n```python\nfrom pptx.dml.color import RGBColor\nfrom pptx.util import Inches, Pt\nfrom pptx.enum.shapes import MSO_SHAPE\nfrom pptx.enum.text import PP_ALIGN\n\n# 1. Corporate Blue (기본)\nCOLORS = {\n    'primary': RGBColor(0x1B, 0x3A, 0x5C), 'secondary': RGBColor(0x2E, 0x86, 0xC1),\n    'accent': RGBColor(0xE7, 0x4C, 0x3C), 'bg_light': RGBColor(0xF8, 0xF9, 0xFA),\n    'bg_dark': RGBColor(0x1B, 0x3A, 0x5C), 'text_dark': RGBColor(0x2D, 0x2D, 0x2D),\n    'text_light': RGBColor(0xF5, 0xF5, 0xF5), 'text_muted': RGBColor(0x7F, 0x8C, 0x8D),\n    'divider': RGBColor(0xD5, 0xDB, 0xDB), 'white': RGBColor(0xFF, 0xFF, 0xFF),\n}\n# 2. Modern Dark\nCOLORS_DARK = {'primary': RGBColor(0x1E,0x1E,0x2E), 'secondary': RGBColor(0x6C,0x5C,0xE7), 'accent': RGBColor(0x00,0xCE,0xC9), 'bg_light': RGBColor(0x2D,0x2D,0x3F), 'bg_dark': RGBColor(0x14,0x14,0x22), 'text_dark': RGBColor(0xEC,0xEC,0xEC), 'text_light': RGBColor(0xF5,0xF5,0xF5), 'text_muted': RGBColor(0xA0,0xA0,0xB0), 'divider': RGBColor(0x44,0x44,0x55), 'white': RGBColor(0xFF,0xFF,0xFF)}\n# 3. Nature Green\nCOLORS_GREEN = {'primary': RGBColor(0x1E,0x8A,0x49), 'secondary': RGBColor(0x27,0xAE,0x60), 'accent': RGBColor(0xF3,0x9C,0x12), 'bg_light': RGBColor(0xF5,0xF9,0xF5), 'bg_dark': RGBColor(0x14,0x55,0x2E), 'text_dark': RGBColor(0x2C,0x3E,0x2C), 'text_light': RGBColor(0xF0,0xF8,0xF0), 'text_muted': RGBColor(0x7D,0x8C,0x7D), 'divider': RGBColor(0xC8,0xE0,0xC8), 'white': RGBColor(0xFF,0xFF,0xFF)}\n# 4. Warm Professional\nCOLORS_WARM = {'primary': RGBColor(0x8B,0x4D,0x1A), 'secondary': RGBColor(0xD4,0x7B,0x2A), 'accent': RGBColor(0xC0,0x39,0x2B), 'bg_light': RGBColor(0xFD,0xF8,0xF0), 'bg_dark': RGBColor(0x5D,0x33,0x10), 'text_dark': RGBColor(0x3C,0x2A,0x1A), 'text_light': RGBColor(0xFA,0xF0,0xE0), 'text_muted': RGBColor(0x9C,0x88,0x70), 'divider': RGBColor(0xE0,0xD0,0xC0), 'white': RGBColor(0xFF,0xFF,0xFF)}\n# 5. Elegant Gray\nCOLORS_GRAY = {'primary': RGBColor(0x34,0x34,0x34), 'secondary': RGBColor(0x5D,0x5D,0x5D), 'accent': RGBColor(0xC0,0x39,0x2B), 'bg_light': RGBColor(0xFA,0xFA,0xFA), 'bg_dark': RGBColor(0x2C,0x2C,0x2C), 'text_dark': RGBColor(0x33,0x33,0x33), 'text_light': RGBColor(0xF0,0xF0,0xF0), 'text_muted': RGBColor(0x88,0x88,0x88), 'divider': RGBColor(0xDD,0xDD,0xDD), 'white': RGBColor(0xFF,0xFF,0xFF)}\n```\n\n## 핵심 헬퍼 함수\n```python\ndef add_slide_bg(slide, prs, color):\n    bg = slide.shapes.add_shape(MSO_SHAPE.RECTANGLE, 0, 0, prs.slide_width, prs.slide_height)\n    bg.fill.solid(); bg.fill.fore_color.rgb = color; bg.line.fill.background()\n    return bg\n\ndef add_text(slide, left, top, w, h, text, size=18, bold=False, color=None, align=PP_ALIGN.LEFT):\n    tx = slide.shapes.add_textbox(Inches(left), Inches(top), Inches(w), Inches(h))\n    tx.text_frame.word_wrap = True\n    p = tx.text_frame.paragraphs[0]; p.text = text; p.font.size = Pt(size); p.font.bold = bold\n    if color: p.font.color.rgb = color\n    p.alignment = align\n    return tx\n\ndef add_bar(slide, left, top, w, h, color):\n    bar = slide.shapes.add_shape(MSO_SHAPE.RECTANGLE, Inches(left), Inches(top), Inches(w), Inches(h))\n    bar.fill.solid(); bar.fill.fore_color.rgb = color; bar.line.fill.background()\n    return bar\n```\n\n## 1. 기존 디자인 분석\n```python\nfrom collections import Counter\ndef analyze_design(pptx_path):\n    prs = Presentation(pptx_path)\n    text_colors, bg_colors, font_sizes = Counter(), [], Counter()\n    for slide in prs.slides:\n        bg = slide.background.fill\n        if bg.type is not None:\n            try: bg_colors.append(str(bg.fore_color.rgb))\n            except: pass\n        for shape in slide.shapes:\n            if shape.has_text_frame:\n                for para in shape.text_frame.paragraphs:\n                    for run in para.runs:\n                        if run.font.color and run.font.color.rgb:\n                            text_colors[str(run.font.color.rgb)] += 1\n                        if run.font.size: font_sizes[run.font.size] += 1\n    print(f'텍스트 색상: {dict(text_colors.most_common(5))}')\n    print(f'배경 색상: {bg_colors}')\n    print(f'폰트 크기: {dict(font_sizes.most_common(5))}')\n    return text_colors, bg_colors, font_sizes\n```\n\n## 2. 텍스트 색상 일괄 수정\n```python\ndef fix_text_colors(pptx_path, output_path, old_rgb='FFFFFF', new_color=RGBColor(0x2D, 0x2D, 0x2D)):\n    prs = Presentation(pptx_path)\n    count = 0\n    for slide in prs.slides:\n        for shape in slide.shapes:\n            frames = []\n            if shape.has_text_frame: frames.append(shape.text_frame)\n            if shape.has_table:\n                for row in shape.table.rows:\n                    for cell in row.cells: frames.append(cell.text_frame)\n            for tf in frames:\n                for para in tf.paragraphs:\n                    for run in para.runs:\n                        if run.font.color and run.font.color.rgb and str(run.font.color.rgb) == old_rgb:\n                            run.font.color.rgb = new_color; count += 1\n    prs.save(output_path)\n    print(f'{count}건 텍스트 색상 변경: {output_path}')\n\ndef ensure_text_color(pptx_path, output_path, default=RGBColor(0x2D, 0x2D, 0x2D)):\n    \"\"\"색상 미지정 텍스트에 기본 색상 적용\"\"\"\n    prs = Presentation(pptx_path); count = 0\n    for slide in prs.slides:\n        for shape in slide.shapes:\n            if shape.has_text_frame:\n                for para in shape.text_frame.paragraphs:\n                    for run in para.runs:\n                        if not run.font.color or not run.font.color.rgb:\n                            run.font.color.rgb = default; count += 1\n    prs.save(output_path)\n    print(f'{count}건 기본 색상 적용: {output_path}')\n```\n\n## 3. 프로페셔널 슬라이드 추가 (기존 PPTX에)\n```python\ndef add_content_slide(prs, title, bullets, colors=COLORS):\n    slide = prs.slides.add_slide(prs.slide_layouts[6])\n    add_slide_bg(slide, prs, colors['bg_light'])\n    add_bar(slide, 0, 0, 13.333, 1.1, colors['primary'])\n    add_text(slide, 0.8, 0.2, 11, 0.7, title, size=32, bold=True, color=colors['text_light'])\n    tx = slide.shapes.add_textbox(Inches(1.0), Inches(1.6), Inches(11), Inches(5.2))\n    tf = tx.text_frame; tf.word_wrap = True\n    for i, b in enumerate(bullets):\n        p = tf.paragraphs[0] if i == 0 else tf.add_paragraph()\n        p.text = f'\\u2022  {b}'; p.font.size = Pt(18); p.font.color.rgb = colors['text_dark']\n        p.space_after = Pt(12)\n    return slide\n\ndef add_section_slide(prs, title, number=None, colors=COLORS):\n    slide = prs.slides.add_slide(prs.slide_layouts[6])\n    add_slide_bg(slide, prs, colors['secondary'])\n    if number: add_text(slide, 1.0, 2.0, 3, 1, f'{number:02d}', size=72, bold=True, color=colors['white'])\n    add_text(slide, 1.0, 3.5, 11, 1, title, size=40, bold=True, color=colors['white'])\n    add_bar(slide, 1.0, 4.8, 4.0, 0.06, colors['white'])\n    return slide\n\ndef add_two_col_slide(prs, title, left_items, right_items, colors=COLORS):\n    slide = prs.slides.add_slide(prs.slide_layouts[6])\n    add_slide_bg(slide, prs, colors['bg_light'])\n    add_bar(slide, 0, 0, 13.333, 1.1, colors['primary'])\n    add_text(slide, 0.8, 0.2, 11, 0.7, title, size=32, bold=True, color=colors['text_light'])\n    for items, left_pos in [(left_items, 0.8), (right_items, 7.0)]:\n        tx = slide.shapes.add_textbox(Inches(left_pos), Inches(1.6), Inches(5.5), Inches(5.0))\n        tf = tx.text_frame; tf.word_wrap = True\n        for i, item in enumerate(items):\n            p = tf.paragraphs[0] if i == 0 else tf.add_paragraph()\n            p.text = f'\\u2022  {item}'; p.font.size = Pt(17); p.font.color.rgb = colors['text_dark']\n    add_bar(slide, 6.6, 1.6, 0.03, 4.8, colors['divider'])\n    return slide\n```\n\n## 4. KPI 카드\n```python\ndef add_kpi_card(slide, left, top, w, h, label, value, colors=COLORS):\n    card = slide.shapes.add_shape(MSO_SHAPE.ROUNDED_RECTANGLE, Inches(left), Inches(top), Inches(w), Inches(h))\n    card.fill.solid(); card.fill.fore_color.rgb = colors['white']\n    card.line.color.rgb = colors['divider']; card.line.width = Pt(1)\n    add_bar(slide, left, top, w, 0.06, colors['secondary'])\n    add_text(slide, left+0.2, top+0.3, w-0.4, 0.4, label, size=13, color=colors['text_muted'])\n    add_text(slide, left+0.2, top+0.7, w-0.4, 0.6, value, size=36, bold=True, color=colors['primary'])\n```\n\n## 5. 테이블 스타일 일괄 개선\n```python\ndef style_tables(pptx_path, output_path, colors=COLORS):\n    prs = Presentation(pptx_path)\n    for slide in prs.slides:\n        for shape in slide.shapes:\n            if shape.has_table:\n                table = shape.table\n                for cell in table.rows[0].cells:\n                    cell.fill.solid(); cell.fill.fore_color.rgb = colors['primary']\n                    for p in cell.text_frame.paragraphs:\n                        p.font.bold = True; p.font.size = Pt(14)\n                        p.font.color.rgb = colors['white']; p.alignment = PP_ALIGN.CENTER\n                for i in range(1, len(table.rows)):\n                    bg = colors['white'] if i % 2 == 1 else RGBColor(0xEB, 0xF5, 0xFB)\n                    for cell in table.rows[i].cells:\n                        cell.fill.solid(); cell.fill.fore_color.rgb = bg\n                        for p in cell.text_frame.paragraphs:\n                            p.font.size = Pt(13); p.font.color.rgb = colors['text_dark']\n    prs.save(output_path)\n```\n\n## 6. 배경/헤더 바 일괄 적용\n```python\ndef set_all_backgrounds(pptx_path, output_path, color=RGBColor(0xF8, 0xF9, 0xFA)):\n    prs = Presentation(pptx_path)\n    for slide in prs.slides:\n        slide.background.fill.solid(); slide.background.fill.fore_color.rgb = color\n    prs.save(output_path)\n\ndef add_header_bars(pptx_path, output_path, color=RGBColor(0x1B, 0x3A, 0x5C), skip_first=True):\n    prs = Presentation(pptx_path)\n    for i, slide in enumerate(prs.slides):\n        if skip_first and i == 0: continue\n        bar = slide.shapes.add_shape(MSO_SHAPE.RECTANGLE, 0, 0, prs.slide_width, Inches(1.0))\n        bar.fill.solid(); bar.fill.fore_color.rgb = color; bar.line.fill.background()\n        if slide.shapes.title:\n            slide.shapes.title.top = Inches(0.15)\n            for p in slide.shapes.title.text_frame.paragraphs:\n                p.font.color.rgb = RGBColor(0xF5, 0xF5, 0xF5)\n    prs.save(output_path)\n```\n\n## 디자인 적용 워크플로우\n\n기존 PPTX를 디자인 개선할 때 권장 순서:\n1. `analyze_design()` — 기존 색상/폰트 분석\n2. 컬러 스킴 선택 (COLORS, COLORS_DARK, COLORS_GREEN, COLORS_WARM, COLORS_GRAY)\n3. `set_all_backgrounds()` — 배경 통일\n4. `fix_text_colors()` / `ensure_text_color()` — 텍스트 가독성 확보\n5. `add_header_bars()` — 시각적 구조 강화\n6. `style_tables()` — 테이블 프로페셔널화\n7. 필요 시 `add_content_slide()` / `add_section_slide()` — 새 슬라이드 추가\n\n## 디자인 체크리스트\n- **모든 텍스트에 font.color.rgb 명시** — 기본값 사용 금지\n- **배경-텍스트 대비** — 밝은 배경→어두운 텍스트, 어두운 배경→밝은 텍스트\n- **일관된 컬러 스킴** — 하나의 COLORS dict로 통일\n- **폰트 크기 계층** — 제목 40-48pt > 소제목 28-32pt > 본문 16-18pt > 캡션 12pt\n- **16:9 비율** — Inches(13.333) x Inches(7.5)\n- **장식 도형 line 제거** — shape.line.fill.background()\n- **원본 보호** — 별도 output_path 사용"
    }
  ]
}
