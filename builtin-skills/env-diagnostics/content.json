{
  "systemPrompt": "당신은 기업 IT 환경 진단 전문가입니다. 프록시, 인증서, DNS, 방화벽, 패키지 매니저 설정 문제를 체계적으로 진단합니다.\n\n## 필수 규칙: Human-in-the-Loop\n\n⚠️ 모든 진단 명령어는 command_execute 도구를 통해 실행하며, 사용자 승인을 반드시 받습니다.\n- 한 번에 하나의 진단 단계만 실행합니다\n- 각 명령어 실행 전 목적과 안전성을 설명합니다\n- 절대로 시스템을 변경하는 명령어(레지스트리 수정, 설정 변경 등)를 먼저 제안하지 않습니다\n- 먼저 읽기 전용 진단 명령어로 상태를 파악하고, 해결 방안은 사용자에게 제안만 합니다\n\n## 진단 흐름 (단계별)\n\n1. **OS/환경 감지**: Windows/WSL/Linux 여부 및 기본 시스템 정보 확인\n2. **프록시 설정 확인**: 환경변수 + 시스템 프록시 + 앱별 프록시 설정\n3. **인증서 체인 확인**: 자체 서명 인증서, 기업 CA, 인증서 저장소 상태\n4. **네트워크 연결 테스트**: 대상 서버 연결, 포트 상태, 방화벽 차단 여부\n5. **DNS 확인**: 이름 해석, DNS 서버 설정\n6. **패키지 매니저별 설정 확인**: npm, pip, git, conda 등의 프록시/인증서 설정\n7. **종합 판단 및 해결 방안 제시**\n\n## 진단 명령어 원칙\n\n- Windows: PowerShell 명령어 사용 (Get-*, Test-*, Resolve-*, [System.Net.*] 등)\n- WSL/Linux: bash 명령어 사용 (curl, openssl, dig, nslookup 등)\n- 읽기 전용(read-only) 명령어만 사용\n- 사용자 데이터에 접근하지 않음\n\n## 출력 형식\n\n각 진단 단계의 결과를 아래 형식으로 정리합니다:\n\n```\n## [단계명] 진단 결과\n\n### 확인 항목\n- 항목1: ✅ 정상 / ⚠️ 경고 / ❌ 문제\n- 항목2: ...\n\n### 발견된 문제 (있을 경우)\n- 문제 설명 및 영향\n\n### 권장 조치 (있을 경우)\n- 조치 방법 제안\n```\n\n## 종합 보고서\n\n모든 단계 완료 후 다음을 포함하는 종합 보고서를 작성합니다:\n1. 전체 환경 상태 요약\n2. 발견된 문제 목록 (심각도 순)\n3. 단계별 해결 방안\n4. 추가 조치가 필요한 항목",
  "knowledge": [
    {
      "title": "프록시 환경 진단",
      "content": "# 프록시 환경 진단\n\n## 개요\n기업 환경에서 HTTP/HTTPS 프록시 설정이 올바르지 않으면 패키지 다운로드, API 호출, 웹 접근이 실패합니다. 환경변수, 시스템 프록시, 앱별 프록시 설정을 모두 확인해야 합니다.\n\n## Windows PowerShell 명령어\n\n### 환경변수 확인\n```powershell\n# 프록시 관련 환경변수 모두 확인\n[Environment]::GetEnvironmentVariable('HTTP_PROXY', 'User')\n[Environment]::GetEnvironmentVariable('HTTPS_PROXY', 'User')\n[Environment]::GetEnvironmentVariable('NO_PROXY', 'User')\n[Environment]::GetEnvironmentVariable('HTTP_PROXY', 'Machine')\n[Environment]::GetEnvironmentVariable('HTTPS_PROXY', 'Machine')\n[Environment]::GetEnvironmentVariable('NO_PROXY', 'Machine')\n\n# 현재 세션의 환경변수\n$env:HTTP_PROXY\n$env:HTTPS_PROXY\n$env:NO_PROXY\n$env:ALL_PROXY\n```\n\n### 시스템 프록시 (WinINET — 브라우저/앱 공용)\n```powershell\n# Internet Explorer/Edge 프록시 설정 (대부분의 Windows 앱이 참조)\nGet-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings' |\n  Select-Object ProxyEnable, ProxyServer, ProxyOverride, AutoConfigURL\n```\n\n### WinHTTP 프록시 (시스템 서비스용)\n```powershell\n# WinHTTP 프록시 설정 확인 (Windows Update, .NET 등이 사용)\nnetsh winhttp show proxy\n```\n\n### PAC (Proxy Auto-Configuration) 파일 확인\n```powershell\n# PAC/WPAD 자동 구성 URL 확인\n$settings = Get-ItemProperty 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings'\nif ($settings.AutoConfigURL) {\n    Write-Output \"PAC URL: $($settings.AutoConfigURL)\"\n    # PAC 파일 내용 확인 (읽기 전용)\n    try { (Invoke-WebRequest -Uri $settings.AutoConfigURL -UseBasicParsing).Content | Select-Object -First 50 } catch { Write-Output \"PAC 파일 접근 불가: $_\" }\n}\n```\n\n## WSL/Linux bash 명령어\n\n### 환경변수 확인\n```bash\n# 프록시 환경변수 확인\nenv | grep -i proxy\n\n# 개별 확인\necho \"HTTP_PROXY=$HTTP_PROXY\"\necho \"HTTPS_PROXY=$HTTPS_PROXY\"\necho \"NO_PROXY=$NO_PROXY\"\necho \"ALL_PROXY=$ALL_PROXY\"\necho \"http_proxy=$http_proxy\"\necho \"https_proxy=$https_proxy\"\n```\n\n### 프록시 동작 테스트\n```bash\n# 프록시 경유 연결 테스트\ncurl -v --proxy \"$HTTP_PROXY\" https://registry.npmjs.org/ 2>&1 | head -30\n\n# 프록시 없이 직접 연결 테스트 (비교용)\ncurl -v --noproxy '*' https://registry.npmjs.org/ 2>&1 | head -30\n```\n\n## 일반적인 문제와 원인\n\n| 증상 | 가능한 원인 |\n|------|------------|\n| `407 Proxy Authentication Required` | 프록시 인증 필요 (NTLM/Kerberos) |\n| `502 Bad Gateway` | 프록시 서버 자체 문제 |\n| `ETIMEDOUT` / `ECONNREFUSED` | 프록시 주소/포트 오류 |\n| 특정 도메인만 실패 | NO_PROXY 설정 누락 |\n| PAC 관련 오류 | PAC 파일 접근 불가 또는 스크립트 오류 |"
    },
    {
      "title": "인증서 체인 진단",
      "content": "# 인증서 체인 진단\n\n## 개요\n기업 환경에서는 HTTPS 트래픽을 검사하기 위해 SSL/TLS 중간자(MITM) 프록시를 사용하거나 자체 서명(Self-Signed) 인증서를 배포합니다. 이로 인해 `UNABLE_TO_VERIFY_LEAF_SIGNATURE`, `SELF_SIGNED_CERT_IN_CHAIN`, `CERT_HAS_EXPIRED` 등의 오류가 발생합니다.\n\n## Windows PowerShell 명령어\n\n### 대상 서버 인증서 체인 확인\n```powershell\n# 특정 서버의 인증서 체인 전체 확인\n$url = 'https://registry.npmjs.org'\ntry {\n    $request = [System.Net.HttpWebRequest]::Create($url)\n    $request.AllowAutoRedirect = $false\n    $request.Timeout = 10000\n    $response = $request.GetResponse()\n    $cert = $request.ServicePoint.Certificate\n    $chain = New-Object System.Security.Cryptography.X509Certificates.X509Chain\n    $chain.Build([System.Security.Cryptography.X509Certificates.X509Certificate2]$cert) | Out-Null\n    Write-Output \"=== 인증서 체인 ===\"\n    $chain.ChainElements | ForEach-Object { Write-Output \"  $($_.Certificate.Subject) [만료: $($_.Certificate.NotAfter)]\" }\n    Write-Output \"`n=== 인증서 상태 ===\"\n    $chain.ChainStatus | ForEach-Object { Write-Output \"  $($_.Status): $($_.StatusInformation)\" }\n    $response.Close()\n} catch {\n    Write-Output \"연결 실패: $_\"\n}\n```\n\n### Windows 인증서 저장소 확인\n```powershell\n# 신뢰할 수 있는 루트 CA 목록\nGet-ChildItem Cert:\\LocalMachine\\Root | Select-Object Subject, NotAfter, Thumbprint | Format-Table -AutoSize\n\n# 기업 CA 인증서 찾기 (일반적인 기업 CA 키워드)\nGet-ChildItem Cert:\\LocalMachine\\Root | Where-Object { $_.Subject -match 'Corp|Enterprise|Internal|Proxy|Firewall' } | Select-Object Subject, NotAfter\n\n# 중간 CA 확인\nGet-ChildItem Cert:\\LocalMachine\\CA | Where-Object { $_.Subject -match 'Corp|Enterprise|Internal|Proxy' } | Select-Object Subject, NotAfter\n```\n\n### NODE_EXTRA_CA_CERTS 확인\n```powershell\n# Node.js가 사용하는 추가 CA 인증서 파일\n[Environment]::GetEnvironmentVariable('NODE_EXTRA_CA_CERTS', 'User')\n[Environment]::GetEnvironmentVariable('NODE_EXTRA_CA_CERTS', 'Machine')\n$env:NODE_EXTRA_CA_CERTS\n```\n\n## WSL/Linux bash 명령어\n\n### OpenSSL로 인증서 체인 확인\n```bash\n# 서버 인증서 체인 표시\nopenssl s_client -connect registry.npmjs.org:443 -showcerts </dev/null 2>/dev/null | openssl x509 -noout -subject -issuer -dates\n\n# 전체 체인 확인\necho | openssl s_client -connect registry.npmjs.org:443 -showcerts 2>/dev/null | grep -E 's:|i:|depth'\n\n# 프록시 경유 인증서 확인\nopenssl s_client -connect registry.npmjs.org:443 -proxy proxy.company.com:8080 -showcerts </dev/null 2>/dev/null\n```\n\n### 시스템 CA 저장소 확인\n```bash\n# CA 인증서 번들 위치\nls -la /etc/ssl/certs/ca-certificates.crt 2>/dev/null || ls -la /etc/pki/tls/certs/ca-bundle.crt 2>/dev/null\n\n# 기업 CA 확인\nif [ -f /etc/ssl/certs/ca-certificates.crt ]; then\n    awk '/BEGIN CERT/,/END CERT/' /etc/ssl/certs/ca-certificates.crt | openssl x509 -noout -subject 2>/dev/null | grep -i 'corp\\|enterprise\\|internal'\nfi\n```\n\n## 일반적인 오류와 해결 방향\n\n| 오류 메시지 | 원인 | 해결 방향 |\n|------------|------|----------|\n| `UNABLE_TO_VERIFY_LEAF_SIGNATURE` | 중간 CA 인증서 누락 | NODE_EXTRA_CA_CERTS 설정 또는 기업 CA 인증서 추가 |\n| `SELF_SIGNED_CERT_IN_CHAIN` | 자체 서명 인증서 (기업 프록시) | 기업 CA 인증서를 신뢰 저장소에 추가 |\n| `CERT_HAS_EXPIRED` | 인증서 만료 | 만료된 인증서 갱신 요청 |\n| `ERR_TLS_CERT_ALTNAME_INVALID` | 인증서 도메인 불일치 | 프록시가 잘못된 인증서 제공 중 |\n\n## ⚠️ 주의: NODE_TLS_REJECT_UNAUTHORIZED=0\n이 설정은 모든 TLS 검증을 비활성화하므로 **진단 목적으로만 임시 사용**하고, 영구적으로 설정하면 안 됩니다. 근본 원인(인증서 누락)을 해결해야 합니다."
    },
    {
      "title": "네트워크 연결 진단",
      "content": "# 네트워크 연결 진단\n\n## 개요\n네트워크 연결 문제는 프록시 외에도 방화벽, 라우팅, 포트 차단, 대역폭 제한 등 다양한 원인이 있습니다. 단계별로 레이어를 확인합니다.\n\n## Windows PowerShell 명령어\n\n### TCP 연결 테스트\n```powershell\n# 특정 호스트:포트 연결 테스트\nTest-NetConnection -ComputerName registry.npmjs.org -Port 443\nTest-NetConnection -ComputerName pypi.org -Port 443\nTest-NetConnection -ComputerName github.com -Port 443\n\n# 상세 정보 포함\nTest-NetConnection -ComputerName registry.npmjs.org -Port 443 -InformationLevel Detailed\n```\n\n### HTTP/HTTPS 연결 테스트\n```powershell\n# HTTPS 응답 확인\ntry {\n    $response = Invoke-WebRequest -Uri 'https://registry.npmjs.org/' -UseBasicParsing -TimeoutSec 10\n    Write-Output \"Status: $($response.StatusCode) $($response.StatusDescription)\"\n} catch {\n    Write-Output \"실패: $($_.Exception.Message)\"\n}\n\n# 여러 대상 일괄 테스트\n@('https://registry.npmjs.org/', 'https://pypi.org/', 'https://github.com/', 'https://api.nuget.org/v3/index.json') | ForEach-Object {\n    try {\n        $r = Invoke-WebRequest -Uri $_ -UseBasicParsing -TimeoutSec 10\n        Write-Output \"✅ $_ → $($r.StatusCode)\"\n    } catch {\n        Write-Output \"❌ $_ → $($_.Exception.Message)\"\n    }\n}\n```\n\n### Traceroute\n```powershell\n# 경로 추적\nTest-NetConnection -ComputerName registry.npmjs.org -TraceRoute | Select-Object -ExpandProperty TraceRoute\n```\n\n### 네트워크 어댑터 정보\n```powershell\n# 활성 네트워크 어댑터\nGet-NetAdapter | Where-Object Status -eq 'Up' | Select-Object Name, InterfaceDescription, MacAddress, LinkSpeed\n\n# IP 설정\nGet-NetIPConfiguration | Where-Object { $_.IPv4DefaultGateway } | Select-Object InterfaceAlias, IPv4Address, IPv4DefaultGateway, DnsServer\n```\n\n## WSL/Linux bash 명령어\n\n### TCP 연결 테스트\n```bash\n# nc(netcat)로 포트 연결 테스트\nnc -zv registry.npmjs.org 443 2>&1\nnc -zv pypi.org 443 2>&1\nnc -zv github.com 443 2>&1\n\n# 타임아웃 포함\ntimeout 5 bash -c 'echo > /dev/tcp/registry.npmjs.org/443 && echo \"✅ 연결 성공\" || echo \"❌ 연결 실패\"' 2>&1\n```\n\n### HTTP 연결 테스트\n```bash\n# curl로 HTTP 응답 확인\ncurl -sI --connect-timeout 10 https://registry.npmjs.org/ | head -5\ncurl -sI --connect-timeout 10 https://pypi.org/ | head -5\ncurl -sI --connect-timeout 10 https://github.com/ | head -5\n```\n\n### Traceroute\n```bash\n# 경로 추적\ntraceroute -n registry.npmjs.org 2>/dev/null || tracepath registry.npmjs.org 2>/dev/null\n```\n\n### 네트워크 인터페이스\n```bash\n# IP 주소 및 인터페이스\nip addr show 2>/dev/null || ifconfig\n\n# 라우팅 테이블\nip route show 2>/dev/null || route -n\n\n# 게이트웨이\nip route | grep default\n```\n\n## 일반적인 문제와 원인\n\n| 증상 | 가능한 원인 |\n|------|------------|\n| `ETIMEDOUT` | 방화벽 차단, 프록시 필요, 서버 다운 |\n| `ECONNREFUSED` | 대상 포트 닫힘, 로컬 방화벽 차단 |\n| `ECONNRESET` | 중간 장비(프록시/방화벽)가 연결 끊음 |\n| `ENETUNREACH` | 네트워크 경로 없음 (라우팅 문제) |\n| 특정 사이트만 차단 | 방화벽 URL/도메인 필터링 |"
    },
    {
      "title": "DNS 진단",
      "content": "# DNS 진단\n\n## 개요\n도메인 이름이 IP 주소로 변환되지 않으면 모든 네트워크 연결이 실패합니다. 기업 환경에서는 내부 DNS 서버, Split DNS, DNS 필터링 등이 문제를 일으킬 수 있습니다.\n\n## Windows PowerShell 명령어\n\n### DNS 해석 테스트\n```powershell\n# 기본 DNS 해석\nResolve-DnsName registry.npmjs.org\nResolve-DnsName pypi.org\nResolve-DnsName github.com\n\n# 상세 정보 (TTL, 쿼리 타입 등)\nResolve-DnsName registry.npmjs.org -Type A -DnsOnly | Format-Table Name, IPAddress, TTL\n```\n\n### DNS 서버 확인\n```powershell\n# 현재 사용 중인 DNS 서버\nGet-DnsClientServerAddress | Where-Object { $_.AddressFamily -eq 2 } | Select-Object InterfaceAlias, ServerAddresses\n\n# DNS 클라이언트 설정\nGet-DnsClientGlobalSetting | Select-Object SuffixSearchList, UseDevolution\n```\n\n### DNS 캐시 확인\n```powershell\n# DNS 캐시에서 특정 도메인 확인\nGet-DnsClientCache | Where-Object { $_.Entry -like '*npmjs*' -or $_.Entry -like '*pypi*' -or $_.Entry -like '*github*' }\n\n# DNS 캐시 통계\nGet-DnsClientCache | Measure-Object | Select-Object Count\n```\n\n### hosts 파일 확인\n```powershell\n# hosts 파일 내용 (주석 제외)\nGet-Content $env:SystemRoot\\System32\\drivers\\etc\\hosts | Where-Object { $_ -and $_ -notmatch '^\\s*#' }\n```\n\n### 특정 DNS 서버로 쿼리\n```powershell\n# Google DNS로 확인 (내부 DNS 우회 테스트)\nResolve-DnsName registry.npmjs.org -Server 8.8.8.8\n\n# 내부 DNS와 비교\nResolve-DnsName registry.npmjs.org -Server (Get-DnsClientServerAddress | Where-Object { $_.AddressFamily -eq 2 } | Select-Object -First 1 -ExpandProperty ServerAddresses)\n```\n\n## WSL/Linux bash 명령어\n\n### DNS 해석 테스트\n```bash\n# nslookup\nnslookup registry.npmjs.org\nnslookup pypi.org\nnslookup github.com\n\n# dig (더 상세)\ndig registry.npmjs.org +short\ndig pypi.org +short\ndig github.com +short\n\n# dig 상세 정보\ndig registry.npmjs.org A +noall +answer +comments\n```\n\n### DNS 서버 확인\n```bash\n# 현재 DNS 설정\ncat /etc/resolv.conf\n\n# systemd-resolved 사용 시\nresolvectl status 2>/dev/null || systemd-resolve --status 2>/dev/null\n```\n\n### hosts 파일 확인\n```bash\n# hosts 파일 (주석 제외)\ngrep -v '^#' /etc/hosts | grep -v '^$'\n```\n\n### 특정 DNS 서버로 쿼리\n```bash\n# Google DNS로 확인\ndig registry.npmjs.org @8.8.8.8 +short\n\n# Cloudflare DNS\ndig registry.npmjs.org @1.1.1.1 +short\n```\n\n## 일반적인 문제와 원인\n\n| 증상 | 가능한 원인 |\n|------|------------|\n| `ENOTFOUND` / `getaddrinfo ENOTFOUND` | DNS 해석 실패 |\n| 내부에서만 해석 실패 | 내부 DNS 서버에 레코드 없음 |\n| 외부 DNS에서만 해석 성공 | 내부 DNS 필터링/차단 |\n| 간헐적 해석 실패 | DNS 서버 과부하 또는 캐시 문제 |\n| 잘못된 IP 반환 | DNS 하이재킹 또는 Split DNS 설정 |"
    },
    {
      "title": "패키지 매니저별 진단",
      "content": "# 패키지 매니저별 프록시/인증서 진단\n\n## 개요\n각 패키지 매니저(npm, pip, git, conda 등)는 독립적인 프록시 및 인증서 설정을 가집니다. 시스템 프록시와 별개로 각각 확인해야 합니다.\n\n## npm / pnpm / yarn\n\n### 설정 확인\n```bash\n# npm 프록시 설정\nnpm config get proxy\nnpm config get https-proxy\nnpm config get registry\nnpm config get cafile\nnpm config get strict-ssl\n\n# npm 전체 설정 목록\nnpm config list -l 2>/dev/null | grep -i 'proxy\\|registry\\|ssl\\|cert\\|ca'\n\n# .npmrc 파일 위치 및 내용\nnpm config get userconfig\nnpm config get globalconfig\ncat ~/.npmrc 2>/dev/null\n```\n\n```powershell\n# PowerShell에서\nnpm config get proxy\nnpm config get https-proxy\nnpm config get strict-ssl\nnpm config get cafile\n\n# .npmrc 확인\nif (Test-Path \"$env:USERPROFILE\\.npmrc\") { Get-Content \"$env:USERPROFILE\\.npmrc\" }\n```\n\n### npm 연결 테스트\n```bash\n# 레지스트리 연결 테스트\nnpm ping\n\n# 패키지 검색 테스트\nnpm view lodash version\n```\n\n## pip (Python)\n\n### 설정 확인\n```bash\n# pip 설정 확인\npip config list 2>/dev/null || pip3 config list 2>/dev/null\n\n# pip.conf / pip.ini 위치\npip config debug 2>/dev/null || pip3 config debug 2>/dev/null\n\n# 환경변수\necho \"PIP_INDEX_URL=$PIP_INDEX_URL\"\necho \"PIP_TRUSTED_HOST=$PIP_TRUSTED_HOST\"\necho \"PIP_CERT=$PIP_CERT\"\n```\n\n```powershell\n# PowerShell에서\npip config list 2>$null\n$env:PIP_INDEX_URL\n$env:PIP_TRUSTED_HOST\n$env:PIP_CERT\n\n# pip.ini 확인\nif (Test-Path \"$env:APPDATA\\pip\\pip.ini\") { Get-Content \"$env:APPDATA\\pip\\pip.ini\" }\n```\n\n### pip 연결 테스트\n```bash\n# PyPI 연결 테스트\npip install --dry-run requests 2>&1 | head -5\n```\n\n## git\n\n### 설정 확인\n```bash\n# git 프록시 설정\ngit config --global http.proxy\ngit config --global https.proxy\ngit config --global http.sslVerify\ngit config --global http.sslCAInfo\ngit config --global http.sslCAPath\n\n# git 전체 설정 (http 관련)\ngit config --global --list 2>/dev/null | grep -i 'http\\|ssl\\|proxy\\|cert'\n```\n\n```powershell\n# PowerShell에서\ngit config --global http.proxy\ngit config --global https.proxy\ngit config --global http.sslVerify\ngit config --global http.sslCAInfo\ngit config --global --list 2>$null | Select-String 'http|ssl|proxy|cert'\n```\n\n### git 연결 테스트\n```bash\n# GitHub 연결 테스트\ngit ls-remote https://github.com/nickel-lang/nickel.git HEAD 2>&1 | head -3\n\n# SSH 연결 테스트\nssh -T git@github.com 2>&1\n```\n\n## conda\n\n### 설정 확인\n```bash\n# conda 설정 확인\nconda config --show proxy_servers 2>/dev/null\nconda config --show ssl_verify 2>/dev/null\nconda config --show channels 2>/dev/null\n\n# .condarc 확인\ncat ~/.condarc 2>/dev/null\n```\n\n## 일반적인 해결 방향\n\n| 패키지 매니저 | 프록시 설정 명령어 | 인증서 무시 (임시) |\n|--------------|-------------------|-------------------|\n| npm | `npm config set proxy http://proxy:port` | `npm config set strict-ssl false` |\n| pip | `pip config set global.proxy http://proxy:port` | `pip config set global.trusted-host pypi.org` |\n| git | `git config --global http.proxy http://proxy:port` | `git config --global http.sslVerify false` |\n| conda | `.condarc`에 `proxy_servers` 추가 | `conda config --set ssl_verify false` |\n\n⚠️ **주의**: 인증서 검증 비활성화는 임시 진단 목적으로만 사용. 근본 해결은 올바른 CA 인증서 설정입니다."
    },
    {
      "title": "방화벽 및 보안 소프트웨어 진단",
      "content": "# 방화벽 및 보안 소프트웨어 진단\n\n## 개요\n기업 환경에서는 Windows 방화벽, 그룹 정책, 보안 소프트웨어(안티바이러스, DLP, EDR)가 네트워크 연결을 차단하거나 인증서를 교체할 수 있습니다.\n\n## Windows PowerShell 명령어\n\n### Windows 방화벽 상태\n```powershell\n# 방화벽 프로필별 상태\nGet-NetFirewallProfile | Select-Object Name, Enabled, DefaultInboundAction, DefaultOutboundAction | Format-Table\n\n# 아웃바운드 차단 규칙 (활성화된 것만)\nGet-NetFirewallRule -Direction Outbound -Enabled True -Action Block |\n  Select-Object DisplayName, Description | Format-Table -AutoSize\n```\n\n### 특정 포트 관련 방화벽 규칙\n```powershell\n# 443(HTTPS) 포트 관련 규칙\nGet-NetFirewallPortFilter | Where-Object { $_.LocalPort -eq 443 -or $_.RemotePort -eq 443 } |\n  Get-NetFirewallRule | Select-Object DisplayName, Direction, Action, Enabled | Format-Table\n\n# 80(HTTP) 포트 관련 규칙\nGet-NetFirewallPortFilter | Where-Object { $_.LocalPort -eq 80 -or $_.RemotePort -eq 80 } |\n  Get-NetFirewallRule | Select-Object DisplayName, Direction, Action, Enabled | Format-Table\n```\n\n### 보안 소프트웨어 감지\n```powershell\n# 안티바이러스 제품 확인\nGet-CimInstance -Namespace root/SecurityCenter2 -ClassName AntiVirusProduct 2>$null |\n  Select-Object displayName, pathToSignedProductExe | Format-Table\n\n# 보안 관련 프로세스 확인\nGet-Process | Where-Object {\n    $_.ProcessName -match 'McAfee|Symantec|Norton|Kaspersky|ESET|Sophos|CrowdStrike|SentinelOne|Carbon|Cylance|Trend|Falcon|Defender|Zscaler|Netskope|ForcePoint'\n} | Select-Object ProcessName, Id, Path | Format-Table -AutoSize\n\n# Windows Defender 상태\nGet-MpComputerStatus 2>$null | Select-Object RealTimeProtectionEnabled, AntivirusEnabled, AntispywareEnabled, NISEnabled\n```\n\n### 네트워크 필터링 드라이버\n```powershell\n# WFP (Windows Filtering Platform) 필터 개수\n(Get-NetFirewallRule).Count\n\n# 네트워크 필터 드라이버 (보안 SW가 설치한 것)\nGet-NetAdapterBinding | Where-Object { $_.Enabled -and $_.ComponentID -notmatch 'ms_' } |\n  Select-Object Name, DisplayName, ComponentID | Format-Table\n```\n\n## WSL/Linux bash 명령어\n\n### iptables/nftables 확인\n```bash\n# iptables 규칙 확인 (권한 필요할 수 있음)\nsudo iptables -L -n 2>/dev/null | head -30\n\n# nftables 확인\nsudo nft list ruleset 2>/dev/null | head -30\n\n# OUTPUT 체인 (아웃바운드 규칙)\nsudo iptables -L OUTPUT -n 2>/dev/null\n```\n\n### 보안 프로세스 확인\n```bash\n# 보안 관련 프로세스\nps aux | grep -iE 'falcon|crowd|sentinel|carbon|sophos|eset|mcafee|symantec|zscaler|netskope' | grep -v grep\n```\n\n## 일반적인 문제와 원인\n\n| 증상 | 가능한 원인 |\n|------|------------|\n| 특정 포트만 차단 | 방화벽 아웃바운드 규칙 |\n| 인증서 오류 + 보안 SW 실행 중 | 보안 SW의 SSL 검사 기능 |\n| 간헐적 연결 끊김 | DLP/EDR 소프트웨어의 패킷 검사 |\n| VPN 연결 시에만 문제 | VPN 라우팅 또는 Split Tunnel 설정 |"
    },
    {
      "title": "일반 환경 진단",
      "content": "# 일반 환경 진단\n\n## 개요\nOS 버전, 시스템 리소스, PATH 설정, 권한 등 기본적인 시스템 환경을 확인합니다.\n\n## Windows PowerShell 명령어\n\n### OS 및 시스템 정보\n```powershell\n# OS 버전\n[System.Environment]::OSVersion | Select-Object Platform, Version, ServicePack\nGet-CimInstance Win32_OperatingSystem | Select-Object Caption, Version, BuildNumber, OSArchitecture\n\n# PowerShell 버전\n$PSVersionTable\n\n# .NET 버전\n[System.Runtime.InteropServices.RuntimeInformation]::FrameworkDescription\n```\n\n### PATH 확인\n```powershell\n# PATH 환경변수 (줄별 표시)\n$env:PATH -split ';' | ForEach-Object { if ($_) { Write-Output $_ } }\n\n# 특정 도구의 실행 경로\nGet-Command node -ErrorAction SilentlyContinue | Select-Object Source\nGet-Command npm -ErrorAction SilentlyContinue | Select-Object Source\nGet-Command python -ErrorAction SilentlyContinue | Select-Object Source\nGet-Command pip -ErrorAction SilentlyContinue | Select-Object Source\nGet-Command git -ErrorAction SilentlyContinue | Select-Object Source\n```\n\n### 도구 버전\n```powershell\n# 주요 도구 버전 확인\n$tools = @('node', 'npm', 'python', 'pip', 'git', 'bun', 'pnpm', 'yarn', 'conda')\nforeach ($tool in $tools) {\n    $cmd = Get-Command $tool -ErrorAction SilentlyContinue\n    if ($cmd) {\n        try {\n            $ver = & $tool --version 2>$null\n            Write-Output \"✅ $tool : $ver ($($cmd.Source))\"\n        } catch { Write-Output \"⚠️ $tool : 설치됨 (버전 확인 실패)\" }\n    } else {\n        Write-Output \"❌ $tool : 미설치\"\n    }\n}\n```\n\n### 디스크 공간\n```powershell\n# 디스크 공간\nGet-PSDrive -PSProvider FileSystem | Select-Object Name, @{N='Used(GB)';E={[math]::Round($_.Used/1GB,1)}}, @{N='Free(GB)';E={[math]::Round($_.Free/1GB,1)}} | Format-Table\n```\n\n### 실행 정책 (PowerShell)\n```powershell\n# 스크립트 실행 정책\nGet-ExecutionPolicy -List\n```\n\n### WSL 상태 (Windows에서)\n```powershell\n# WSL 배포판 목록\nwsl --list --verbose 2>$null\n\n# WSL 버전\nwsl --version 2>$null\n```\n\n## WSL/Linux bash 명령어\n\n### OS 정보\n```bash\n# OS 정보\ncat /etc/os-release 2>/dev/null\nuname -a\n\n# WSL 감지\nif grep -qi microsoft /proc/version 2>/dev/null; then echo \"WSL 환경\"; else echo \"네이티브 Linux\"; fi\n```\n\n### PATH 확인\n```bash\n# PATH (줄별 표시)\necho $PATH | tr ':' '\\n'\n\n# 도구 위치\nwhich node npm python python3 pip pip3 git bun pnpm 2>/dev/null\n```\n\n### 도구 버전\n```bash\n# 주요 도구 버전\nfor tool in node npm python3 pip3 git bun pnpm yarn conda; do\n    if command -v $tool &>/dev/null; then\n        ver=$($tool --version 2>/dev/null | head -1)\n        echo \"✅ $tool: $ver ($(which $tool))\"\n    else\n        echo \"❌ $tool: 미설치\"\n    fi\ndone\n```\n\n### 디스크 공간\n```bash\n# 디스크 공간\ndf -h / /home 2>/dev/null | head -5\n\n# 사용자 홈 디렉토리 크기\ndu -sh ~ 2>/dev/null\n```\n\n### 권한 확인\n```bash\n# 현재 사용자\nwhoami\nid\n\n# sudo 가능 여부\nsudo -n true 2>/dev/null && echo \"sudo 가능\" || echo \"sudo 불가 (또는 비밀번호 필요)\"\n```"
    }
  ],
  "workflows": [
    {
      "id": "env-full-diagnostics",
      "name": "환경 문제 종합 진단 워크플로우",
      "description": "프록시, 인증서, DNS, 방화벽, 패키지 매니저 설정을 단계별로 체계적으로 진단하는 종합 워크플로우",
      "steps": [
        {
          "action": "OS/환경 감지: Windows/WSL/Linux 여부를 확인하고 기본 시스템 정보(OS 버전, PowerShell 버전, 주요 도구 설치 여부)를 수집합니다.",
          "tool": "command_execute"
        },
        {
          "action": "프록시 설정 확인: 환경변수(HTTP_PROXY, HTTPS_PROXY, NO_PROXY), 시스템 프록시(WinINET, WinHTTP), PAC 파일 설정을 확인합니다.",
          "tool": "command_execute"
        },
        {
          "action": "인증서 체인 확인: 대상 서버의 TLS 인증서 체인을 확인하고, 자체 서명 인증서나 기업 CA 삽입 여부, NODE_EXTRA_CA_CERTS 설정을 확인합니다.",
          "tool": "command_execute"
        },
        {
          "action": "네트워크 연결 테스트: 주요 패키지 레지스트리(npmjs.org, pypi.org, github.com)에 TCP 연결(443 포트)과 HTTPS 응답을 테스트합니다.",
          "tool": "command_execute"
        },
        {
          "action": "DNS 확인: 대상 도메인의 DNS 해석 정상 여부를 확인하고, 내부 DNS와 공개 DNS(8.8.8.8) 결과를 비교하여 DNS 필터링 여부를 판단합니다.",
          "tool": "command_execute"
        },
        {
          "action": "패키지 매니저 설정 확인: npm, pip, git 등의 프록시/인증서 설정을 확인하고 시스템 프록시와의 불일치를 비교합니다.",
          "tool": "command_execute"
        },
        {
          "action": "종합 판단 및 해결 방안 제시: 모든 단계의 결과를 종합하여 근본 원인을 판단하고, 구체적인 해결 방안을 '제안'으로만 제시합니다."
        }
      ]
    }
  ]
}
