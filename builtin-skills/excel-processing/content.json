{
  "systemPrompt": "당신은 Excel 데이터 처리 전문가입니다. 기존 Excel(.xlsx, .xls) 파일을 읽고, 데이터를 분석하고, 내용을 수정할 때 반드시 Python 스크립트를 작성하여 command_execute로 실행합니다. pandas로 데이터 분석을, openpyxl로 셀 수정/서식 변경을 수행합니다. 스크립트 실행 결과를 사용자에게 명확히 안내합니다.\n\n## 핵심 실행 규칙 (반드시 준수)\n\n1. **스크립트 작성 후 반드시 즉시 실행**: Python 스크립트를 file_write로 작성한 직후, 반드시 command_execute로 실행하세요. 스크립트만 작성하고 실행하지 않는 것은 절대 금지입니다.\n2. **사용자에게 수동 설치를 절대 요청하지 마세요**: `pip install`을 사용자에게 직접 실행하라고 안내하지 마세요. 모든 패키지 설치는 SEPilot venv 내에서 자동 처리합니다.\n3. **SEPilot venv 환경 사용 (필수)**: 글로벌 Python에 직접 pip install하지 마세요. 반드시 SEPilot 전용 가상환경을 사용합니다.\n   - command_execute 원샷 패턴:\n     ```bash\n     VENV=\"$HOME/.sepilot/environments/python\" && \\\n     (test -f \"$VENV/bin/python\" || python3 -m venv \"$VENV\") && \\\n     \"$VENV/bin/pip\" install -q pandas openpyxl && \\\n     \"$VENV/bin/python\" /path/to/script.py\n     ```\n   - 스크립트 내부 패턴:\n     ```python\n     import subprocess, os\n     VENV = os.path.expanduser('~/.sepilot/environments/python')\n     BIN = 'Scripts' if os.name == 'nt' else 'bin'\n     VENV_PIP = os.path.join(VENV, BIN, 'pip')\n     subprocess.check_call([VENV_PIP, 'install', '-q', 'pandas', 'openpyxl'])\n     ```\n4. **Python 환경 자동 감지**: `python3`이 실패하면 `python`으로 venv 생성을 재시도하세요.\n5. **패키지 미설치를 이유로 작업을 중단하지 마세요**: venv 내에서 자동으로 설치 후 재시도합니다.\n\n## Excel(XLSX) 디자인 필수 규칙\n\n새로운 Excel 파일 생성 또는 대폭 수정 시 반드시 프로페셔널 디자인을 적용합니다:\n1. **xl_styles() 사용**: 컬러 스킴 기반 스타일 객체로 일관성 확보\n2. **시트 타이틀**: add_sheet_title()로 전문적 제목 + 구분선\n3. **헤더 스타일**: 배경색(1B3A5C) + 흰색 볼드 + 가운데 정렬\n4. **줄무늬**: 짝수 행 교대 배경색(EBF5FB)\n5. **합계 행**: 별도 배경 + 볼드 + SUM 수식\n6. **숫자 포맷**: #,##0 / 0.0% / #,##0원\n7. **열 너비 자동**: 콘텐츠 길이에 맞춤\n8. **틀 고정**: freeze_panes로 헤더 행 고정\n9. **조건부 색상**: 양수 녹색(27AE60) / 음수 빨간색(E74C3C)\n10. **차트**: 컬러 스킴과 일치하는 색상 적용",
  "knowledge": [
    {
      "title": "Excel 프로페셔널 디자인 시스템",
      "content": "# Excel 프로페셔널 디자인 시스템\n\n## 컬러 스킴 정의\n```python\nfrom openpyxl.styles import Font, PatternFill, Alignment, Border, Side, numbers\nfrom openpyxl.utils import get_column_letter\n\n# Corporate Blue (기본 권장)\nXL_COLORS = {\n    'header_bg': '1B3A5C',\n    'header_font': 'FFFFFF',\n    'subheader_bg': '2E86C1',\n    'subheader_font': 'FFFFFF',\n    'accent': 'E74C3C',\n    'row_alt': 'EBF5FB',\n    'row_normal': 'FFFFFF',\n    'text_dark': '2D2D2D',\n    'text_muted': '7F8C8D',\n    'border': 'D5DBDB',\n    'total_bg': 'F0F4F8',\n    'positive': '27AE60',\n    'negative': 'E74C3C',\n}\n# Modern Dark\nXL_DARK = {'header_bg': '1E1E2E', 'header_font': 'F5F5F5', 'subheader_bg': '6C5CE7', 'subheader_font': 'FFFFFF', 'accent': '00CEC9', 'row_alt': '2D2D3F', 'row_normal': '252535', 'text_dark': 'ECECEC', 'text_muted': 'A0A0B0', 'border': '444455', 'total_bg': '333345', 'positive': '00CEC9', 'negative': 'FF6B6B'}\n# Nature Green\nXL_GREEN = {'header_bg': '1E8A49', 'header_font': 'FFFFFF', 'subheader_bg': '27AE60', 'subheader_font': 'FFFFFF', 'accent': 'F39C12', 'row_alt': 'F5F9F5', 'row_normal': 'FFFFFF', 'text_dark': '2C3E2C', 'text_muted': '7D8C7D', 'border': 'C8E0C8', 'total_bg': 'E8F5E8', 'positive': '1E8A49', 'negative': 'C0392B'}\n```\n\n## 스타일 헬퍼 함수\n```python\ndef xl_styles(colors=XL_COLORS):\n    \"\"\"컬러 스킴 기반 스타일 객체 생성\"\"\"\n    thin = Side(style='thin', color=colors['border'])\n    return {\n        'header_font': Font(name='맑은 고딕', size=11, bold=True, color=colors['header_font']),\n        'header_fill': PatternFill(start_color=colors['header_bg'], end_color=colors['header_bg'], fill_type='solid'),\n        'subheader_font': Font(name='맑은 고딕', size=10, bold=True, color=colors['subheader_font']),\n        'subheader_fill': PatternFill(start_color=colors['subheader_bg'], end_color=colors['subheader_bg'], fill_type='solid'),\n        'data_font': Font(name='맑은 고딕', size=10, color=colors['text_dark']),\n        'muted_font': Font(name='맑은 고딕', size=9, color=colors['text_muted']),\n        'title_font': Font(name='맑은 고딕', size=16, bold=True, color=colors['header_bg']),\n        'subtitle_font': Font(name='맑은 고딕', size=11, color=colors['text_muted']),\n        'alt_fill': PatternFill(start_color=colors['row_alt'], end_color=colors['row_alt'], fill_type='solid'),\n        'total_fill': PatternFill(start_color=colors['total_bg'], end_color=colors['total_bg'], fill_type='solid'),\n        'total_font': Font(name='맑은 고딕', size=10, bold=True, color=colors['header_bg']),\n        'positive_font': Font(name='맑은 고딕', size=10, bold=True, color=colors['positive']),\n        'negative_font': Font(name='맑은 고딕', size=10, bold=True, color=colors['negative']),\n        'center': Alignment(horizontal='center', vertical='center'),\n        'left': Alignment(horizontal='left', vertical='center'),\n        'right': Alignment(horizontal='right', vertical='center'),\n        'wrap': Alignment(horizontal='left', vertical='center', wrap_text=True),\n        'border': Border(left=thin, right=thin, top=thin, bottom=thin),\n        'num_fmt': '#,##0',\n        'pct_fmt': '0.0%',\n        'money_fmt': '#,##0원',\n    }\n```\n\n## 프로페셔널 시트 타이틀\n```python\ndef add_sheet_title(ws, title, subtitle='', colors=XL_COLORS):\n    \"\"\"시트 상단에 타이틀 + 서브타이틀 추가\"\"\"\n    s = xl_styles(colors)\n    ws.merge_cells('A1:H1')\n    ws['A1'] = title\n    ws['A1'].font = s['title_font']\n    ws['A1'].alignment = Alignment(horizontal='left', vertical='center')\n    ws.row_dimensions[1].height = 35\n    if subtitle:\n        ws.merge_cells('A2:H2')\n        ws['A2'] = subtitle\n        ws['A2'].font = s['subtitle_font']\n        ws.row_dimensions[2].height = 22\n    # 타이틀 하단 구분선\n    sep_row = 3 if subtitle else 2\n    for col in range(1, 9):\n        cell = ws.cell(row=sep_row, column=col)\n        cell.border = Border(bottom=Side(style='medium', color=colors['header_bg']))\n    ws.row_dimensions[sep_row].height = 6\n    return sep_row + 1  # 데이터 시작 행 반환\n```\n\n## 프로페셔널 데이터 테이블\n```python\ndef add_data_table(ws, headers, rows, start_row=1, start_col=1, colors=XL_COLORS,\n                   total_row=False, auto_width=True, number_cols=None, pct_cols=None):\n    \"\"\"프로페셔널 스타일 데이터 테이블 생성\"\"\"\n    s = xl_styles(colors)\n    number_cols = number_cols or []\n    pct_cols = pct_cols or []\n    # 헤더\n    for j, h in enumerate(headers):\n        cell = ws.cell(row=start_row, column=start_col + j, value=h)\n        cell.font = s['header_font']\n        cell.fill = s['header_fill']\n        cell.alignment = s['center']\n        cell.border = s['border']\n    ws.row_dimensions[start_row].height = 28\n    # 데이터 행 (줄무늬)\n    for i, row_data in enumerate(rows):\n        for j, val in enumerate(row_data):\n            cell = ws.cell(row=start_row + 1 + i, column=start_col + j, value=val)\n            cell.font = s['data_font']\n            cell.border = s['border']\n            if i % 2 == 1:\n                cell.fill = s['alt_fill']\n            col_idx = j + 1\n            if col_idx in number_cols:\n                cell.number_format = s['num_fmt']\n                cell.alignment = s['right']\n            elif col_idx in pct_cols:\n                cell.number_format = s['pct_fmt']\n                cell.alignment = s['center']\n            else:\n                cell.alignment = s['left']\n    # 합계 행\n    if total_row and rows:\n        total_r = start_row + 1 + len(rows)\n        ws.cell(row=total_r, column=start_col, value='합계').font = s['total_font']\n        ws.cell(row=total_r, column=start_col).fill = s['total_fill']\n        ws.cell(row=total_r, column=start_col).border = s['border']\n        for j in range(1, len(headers)):\n            cell = ws.cell(row=total_r, column=start_col + j)\n            col_letter = get_column_letter(start_col + j)\n            cell.value = f'=SUM({col_letter}{start_row+1}:{col_letter}{start_row+len(rows)})'\n            cell.font = s['total_font']\n            cell.fill = s['total_fill']\n            cell.border = s['border']\n            if (j + 1) in number_cols:\n                cell.number_format = s['num_fmt']\n    # 열 너비 자동 조절\n    if auto_width:\n        for j, h in enumerate(headers):\n            max_len = len(str(h))\n            for row_data in rows:\n                if j < len(row_data):\n                    max_len = max(max_len, len(str(row_data[j])))\n            ws.column_dimensions[get_column_letter(start_col + j)].width = min(max_len + 4, 40)\n    return start_row + 1 + len(rows) + (1 if total_row else 0)\n```\n\n## KPI 카드 시트\n```python\ndef add_kpi_row(ws, row, col, label, value, fmt='#,##0', colors=XL_COLORS):\n    \"\"\"KPI 지표 카드 (라벨 + 큰 숫자)\"\"\"\n    s = xl_styles(colors)\n    # 라벨\n    cell_label = ws.cell(row=row, column=col, value=label)\n    cell_label.font = s['muted_font']\n    cell_label.alignment = s['center']\n    # 값\n    cell_value = ws.cell(row=row + 1, column=col, value=value)\n    cell_value.font = Font(name='맑은 고딕', size=24, bold=True, color=colors['header_bg'])\n    cell_value.alignment = s['center']\n    cell_value.number_format = fmt\n    # 상단 액센트\n    accent = ws.cell(row=row - 1, column=col)\n    accent.fill = PatternFill(start_color=colors['subheader_bg'], end_color=colors['subheader_bg'], fill_type='solid')\n    ws.row_dimensions[row - 1].height = 4\n```\n\n## 조건부 색상 (양수/음수)\n```python\ndef apply_conditional_colors(ws, col_letter, start_row, end_row, colors=XL_COLORS):\n    \"\"\"양수는 녹색, 음수는 빨간색으로 표시\"\"\"\n    s = xl_styles(colors)\n    for row in range(start_row, end_row + 1):\n        cell = ws[f'{col_letter}{row}']\n        if cell.value is not None:\n            if isinstance(cell.value, (int, float)):\n                cell.font = s['positive_font'] if cell.value >= 0 else s['negative_font']\n```\n\n## 프로페셔널 차트\n```python\nfrom openpyxl.chart import BarChart, LineChart, PieChart, Reference\nfrom openpyxl.chart.series import DataPoint\nfrom openpyxl.chart.label import DataLabelList\n\ndef add_styled_bar_chart(ws, data_range, cat_range, title, position, colors=XL_COLORS):\n    chart = BarChart()\n    chart.title = title\n    chart.style = 10\n    chart.width = 20\n    chart.height = 12\n    chart.add_data(data_range, titles_from_data=True)\n    chart.set_categories(cat_range)\n    chart.y_axis.numFmt = '#,##0'\n    chart.legend.position = 'b'\n    # 색상 적용\n    for i, series in enumerate(chart.series):\n        color_list = [colors['header_bg'], colors['subheader_bg'], colors['accent']]\n        series.graphicalProperties.solidFill = color_list[i % len(color_list)]\n    ws.add_chart(chart, position)\n    return chart\n\ndef add_styled_pie_chart(ws, data_range, cat_range, title, position, colors=XL_COLORS):\n    chart = PieChart()\n    chart.title = title\n    chart.style = 10\n    chart.width = 16\n    chart.height = 12\n    chart.add_data(data_range, titles_from_data=True)\n    chart.set_categories(cat_range)\n    chart.dataLabels = DataLabelList()\n    chart.dataLabels.showPercent = True\n    chart.dataLabels.showVal = False\n    ws.add_chart(chart, position)\n    return chart\n```\n\n## 전체 리포트 조합 예제\n```python\nfrom openpyxl import Workbook\n\nwb = Workbook()\nws = wb.active\nws.title = '매출 리포트'\n\n# 1. 타이틀\ndata_start = add_sheet_title(ws, '월간 매출 리포트', '2025년 3월 | 기획팀')\n\n# 2. KPI 카드\nadd_kpi_row(ws, data_start + 1, 2, '총 매출', 1250000000, '#,##0원')\nadd_kpi_row(ws, data_start + 1, 4, '신규 고객', 1234, '#,##0명')\nadd_kpi_row(ws, data_start + 1, 6, 'NPS 점수', 67, '#,##0점')\n\n# 3. 데이터 테이블\ntable_start = data_start + 4\nheaders = ['지역', '매출', '목표', '달성률', '전월 대비']\nrows = [\n    ['서울', 450000000, 400000000, 1.125, 0.05],\n    ['부산', 280000000, 300000000, 0.933, -0.02],\n    ['대구', 190000000, 200000000, 0.95, 0.08],\n    ['인천', 170000000, 150000000, 1.133, 0.12],\n    ['광주', 160000000, 180000000, 0.889, -0.05],\n]\ntable_end = add_data_table(ws, headers, rows, start_row=table_start,\n    number_cols=[2, 3], pct_cols=[4, 5], total_row=True)\n\n# 4. 조건부 색상\napply_conditional_colors(ws, 'E', table_start + 1, table_start + len(rows))\n\n# 5. 차트\ndata_ref = Reference(ws, min_col=2, min_row=table_start, max_row=table_start + len(rows))\ncat_ref = Reference(ws, min_col=1, min_row=table_start + 1, max_row=table_start + len(rows))\nadd_styled_bar_chart(ws, data_ref, cat_ref, '지역별 매출', f'A{table_end + 2}')\n\n# 6. 틀 고정 & 인쇄 설정\nws.freeze_panes = f'A{table_start + 1}'\nws.sheet_properties.pageSetUpPr.fitToPage = True\n\nwb.save(output_path)\nprint(f'리포트 생성 완료: {output_path}')\n```\n\n## XLSX 디자인 체크리스트\n1. **xl_styles() 사용** — 일관된 컬러 스킴\n2. **시트 타이틀** — add_sheet_title()로 전문적 제목\n3. **헤더 스타일** — 배경색 + 흰색 볼드 텍스트\n4. **줄무늬** — 짝수 행 교대 색상\n5. **합계 행** — 별도 배경색 + 볼드\n6. **숫자 포맷** — #,##0 (천 단위 구분), 0.0% (퍼센트)\n7. **열 너비 자동** — auto_width=True\n8. **틀 고정** — 헤더 행 고정\n9. **조건부 색상** — 양수 녹색 / 음수 빨간색\n10. **차트** — 컬러 스킴과 일치하는 색상"
    },
    {
      "title": "Excel 파일 읽기 및 데이터 탐색",
      "content": "# Excel 파일 읽기 및 데이터 탐색\n\n## 설치\n```bash\npip install pandas openpyxl\n```\n\n## pandas로 Excel 읽기\n```python\nimport pandas as pd\n\n# 기본 읽기\ndf = pd.read_excel('data.xlsx')\n\n# 특정 시트 읽기\ndf = pd.read_excel('data.xlsx', sheet_name='시트2')\n\n# 모든 시트 읽기 (딕셔너리 반환)\nall_sheets = pd.read_excel('data.xlsx', sheet_name=None)\nfor name, sheet_df in all_sheets.items():\n    print(f'시트: {name}, 행: {len(sheet_df)}, 열: {len(sheet_df.columns)}')\n\n# 옵션 지정\ndf = pd.read_excel(\n    'data.xlsx',\n    sheet_name=0,        # 첫 번째 시트\n    header=0,            # 헤더 행 (None이면 헤더 없음)\n    skiprows=2,          # 상위 2행 건너뛰기\n    usecols='A:D',       # A~D열만 읽기\n    nrows=100,           # 최대 100행\n    dtype={'코드': str},  # 특정 열 타입 지정\n    na_values=['-', 'N/A', '']  # 결측값으로 처리할 값\n)\n```\n\n## 데이터 탐색\n```python\n# 기본 정보\nprint(f'행: {len(df)}, 열: {len(df.columns)}')\nprint(f'\\n열 목록: {df.columns.tolist()}')\nprint(f'\\n데이터 타입:\\n{df.dtypes}')\nprint(f'\\n결측값:\\n{df.isnull().sum()}')\n\n# 처음/끝 확인\nprint(f'\\n처음 5행:\\n{df.head().to_markdown()}')\nprint(f'\\n마지막 5행:\\n{df.tail().to_markdown()}')\n\n# 기본 통계\nprint(f'\\n기본 통계:\\n{df.describe().to_markdown()}')\n\n# 고유값 확인\nfor col in df.select_dtypes(include='object').columns:\n    unique = df[col].nunique()\n    print(f'{col}: {unique}개 고유값')\n    if unique <= 10:\n        print(f'  값: {df[col].unique().tolist()}')\n```\n\n## openpyxl로 상세 읽기 (서식 포함)\n```python\nfrom openpyxl import load_workbook\n\nwb = load_workbook('data.xlsx', data_only=True)  # data_only=True면 수식 대신 값\nprint(f'시트 목록: {wb.sheetnames}')\n\nws = wb.active  # 또는 wb['시트명']\nprint(f'시트: {ws.title}')\nprint(f'범위: {ws.dimensions}')\nprint(f'행: {ws.max_row}, 열: {ws.max_column}')\n\n# 특정 셀 읽기\nprint(f'A1: {ws[\"A1\"].value}')\nprint(f'B2: {ws.cell(row=2, column=2).value}')\n\n# 행 단위 읽기\nfor row in ws.iter_rows(min_row=1, max_row=5, values_only=True):\n    print(row)\n\n# 병합 셀 확인\nfor merged_range in ws.merged_cells.ranges:\n    print(f'병합 셀: {merged_range}')\n```\n\n## xls (구형 Excel) 읽기\n```bash\npip install xlrd\n```\n```python\ndf = pd.read_excel('old_file.xls', engine='xlrd')\n```"
    },
    {
      "title": "Excel 데이터 분석 및 가공",
      "content": "# Excel 데이터 분석 및 가공\n\n## 필터링 및 정렬\n```python\nimport pandas as pd\n\ndf = pd.read_excel('data.xlsx')\n\n# 조건 필터링\nfiltered = df[df['매출'] > 1000000]\nfiltered = df[(df['지역'] == '서울') & (df['연도'] >= 2024)]\nfiltered = df[df['카테고리'].isin(['전자제품', '의류'])]\nfiltered = df[df['이름'].str.contains('김', na=False)]\n\n# 정렬\nsorted_df = df.sort_values('매출', ascending=False)\nsorted_df = df.sort_values(['지역', '매출'], ascending=[True, False])\n\n# 상위/하위 N개\ntop10 = df.nlargest(10, '매출')\nbottom5 = df.nsmallest(5, '평점')\n\nprint(filtered.to_markdown(index=False))\n```\n\n## 그룹별 집계\n```python\n# 단일 그룹 집계\nresult = df.groupby('지역')['매출'].agg(['sum', 'mean', 'count'])\nresult.columns = ['합계', '평균', '건수']\nprint(result.to_markdown())\n\n# 다중 그룹 집계\nresult = df.groupby(['연도', '지역']).agg(\n    매출합계=('매출', 'sum'),\n    매출평균=('매출', 'mean'),\n    건수=('매출', 'count')\n).reset_index()\n\n# 피벗 테이블\npivot = pd.pivot_table(\n    df,\n    values='매출',\n    index='지역',\n    columns='분기',\n    aggfunc='sum',\n    fill_value=0,\n    margins=True,       # 합계 행/열 추가\n    margins_name='합계'\n)\nprint(pivot.to_markdown())\n```\n\n## 데이터 변환\n```python\n# 새 열 추가\ndf['이익률'] = (df['이익'] / df['매출'] * 100).round(1)\ndf['등급'] = pd.cut(df['점수'], bins=[0, 60, 80, 100], labels=['C', 'B', 'A'])\n\n# 날짜 처리\ndf['날짜'] = pd.to_datetime(df['날짜'])\ndf['연월'] = df['날짜'].dt.to_period('M')\ndf['요일'] = df['날짜'].dt.day_name()\n\n# 문자열 처리\ndf['이름'] = df['이름'].str.strip()\ndf['코드'] = df['코드'].str.upper()\ndf['카테고리'] = df['카테고리'].str.replace('/', '_')\n\n# 결측값 처리\ndf['매출'] = df['매출'].fillna(0)\ndf['이름'] = df['이름'].fillna('미입력')\ndf = df.dropna(subset=['필수열'])  # 특정 열 결측 행 삭제\n\n# 중복 제거\ndf = df.drop_duplicates(subset=['이름', '날짜'], keep='last')\n```\n\n## 여러 Excel 합치기\n```python\nimport glob\n\n# 같은 구조의 여러 파일 합치기\nfiles = glob.glob('/path/to/*.xlsx')\ndfs = [pd.read_excel(f) for f in files]\nmerged = pd.concat(dfs, ignore_index=True)\nprint(f'합친 결과: {len(merged)}행')\n\n# 두 시트/파일 조인\ndf1 = pd.read_excel('sales.xlsx')\ndf2 = pd.read_excel('products.xlsx')\nresult = pd.merge(df1, df2, on='제품코드', how='left')\n```\n\n## 분석 결과를 텍스트로 출력\n```python\n# Markdown 테이블로 출력 (채팅에 보기 좋게)\nprint(result.to_markdown(index=False))\n\n# 요약 리포트\nprint(f'\\n=== 분석 요약 ===')\nprint(f'총 건수: {len(df):,}건')\nprint(f'총 매출: {df[\"매출\"].sum():,.0f}원')\nprint(f'평균 매출: {df[\"매출\"].mean():,.0f}원')\nprint(f'최대 매출: {df[\"매출\"].max():,.0f}원 ({df.loc[df[\"매출\"].idxmax(), \"이름\"]})')\n```"
    },
    {
      "title": "Excel 내용 수정 및 저장",
      "content": "# Excel 내용 수정 및 저장\n\n## pandas로 가공 후 저장\n```python\nimport pandas as pd\n\ndf = pd.read_excel('input.xlsx')\n\n# 데이터 가공\ndf['매출'] = df['매출'] * 1.1  # 10% 인상\ndf = df.sort_values('매출', ascending=False)\n\n# 단일 시트 저장\ndf.to_excel('output.xlsx', index=False, sheet_name='결과')\n\n# 여러 시트로 저장\nwith pd.ExcelWriter('output.xlsx', engine='openpyxl') as writer:\n    df.to_excel(writer, sheet_name='전체', index=False)\n    df[df['지역'] == '서울'].to_excel(writer, sheet_name='서울', index=False)\n    df[df['지역'] == '부산'].to_excel(writer, sheet_name='부산', index=False)\n    pivot.to_excel(writer, sheet_name='피벗')\nprint(f'저장 완료: output.xlsx')\n```\n\n## openpyxl로 기존 파일 수정 (서식 유지)\n```python\nfrom openpyxl import load_workbook\nfrom openpyxl.styles import Font, PatternFill, Alignment, Border, Side, numbers\nfrom copy import copy\n\n# 기존 파일 열기 (서식 유지)\nwb = load_workbook('data.xlsx')\nws = wb.active\n\n# 특정 셀 값 수정\nws['A1'] = '수정된 제목'\nws.cell(row=2, column=3, value=99999)\n\n# 행 추가\nws.append(['새 항목', 100, 50000, '=B{0}*C{0}'.format(ws.max_row + 1)])\n\n# 행 삽입 (3번째 행 앞에)\nws.insert_rows(3)\nws.cell(row=3, column=1, value='삽입된 행')\n\n# 행 삭제 (5번째 행)\nws.delete_rows(5)\n\n# 열 추가\nfrom openpyxl.utils import get_column_letter\nnew_col = ws.max_column + 1\nws.cell(row=1, column=new_col, value='새 열')\nfor row in range(2, ws.max_row + 1):\n    ws.cell(row=row, column=new_col, value=f'=B{row}*C{row}')\n\nwb.save('data_modified.xlsx')\nprint('수정 완료: data_modified.xlsx')\n```\n\n## 셀 서식 변경\n```python\nfrom openpyxl import load_workbook\nfrom openpyxl.styles import Font, PatternFill, Alignment, Border, Side\n\nwb = load_workbook('data.xlsx')\nws = wb.active\n\n# 헤더 서식\nheader_font = Font(name='맑은 고딕', size=11, bold=True, color='FFFFFF')\nheader_fill = PatternFill(start_color='2F5496', end_color='2F5496', fill_type='solid')\nheader_align = Alignment(horizontal='center', vertical='center', wrap_text=True)\n\nfor cell in ws[1]:  # 첫 행\n    cell.font = header_font\n    cell.fill = header_fill\n    cell.alignment = header_align\n\n# 조건부 서식 (수동)\nfor row in ws.iter_rows(min_row=2, min_col=3, max_col=3):  # C열\n    for cell in row:\n        if cell.value and cell.value < 0:\n            cell.font = Font(color='FF0000', bold=True)  # 음수: 빨간색\n        elif cell.value and cell.value > 100000:\n            cell.fill = PatternFill(start_color='C6EFCE', fill_type='solid')  # 고액: 녹색 배경\n\n# 숫자 포맷\nfor row in ws.iter_rows(min_row=2, min_col=2, max_col=4):\n    for cell in row:\n        cell.number_format = '#,##0'  # 천 단위 구분\n\n# 열 너비 자동 조절\nfor col in ws.columns:\n    max_length = 0\n    col_letter = get_column_letter(col[0].column)\n    for cell in col:\n        if cell.value:\n            max_length = max(max_length, len(str(cell.value)))\n    ws.column_dimensions[col_letter].width = min(max_length + 4, 50)\n\n# 틀 고정 (Freeze Panes)\nws.freeze_panes = 'A2'  # 1행 고정\n\nwb.save('data_formatted.xlsx')\nprint('서식 적용 완료: data_formatted.xlsx')\n```\n\n## 시트 관리\n```python\nfrom openpyxl import load_workbook\n\nwb = load_workbook('data.xlsx')\n\n# 시트 추가\nws_new = wb.create_sheet('요약', index=0)  # 맨 앞에 추가\nws_new['A1'] = '요약 시트'\n\n# 시트 복사\nfrom copy import copy\nsource = wb['원본']\ntarget = wb.copy_worksheet(source)\ntarget.title = '백업'\n\n# 시트 삭제\nif '임시' in wb.sheetnames:\n    del wb['임시']\n\n# 시트 이름 변경\nwb['Sheet1'].title = '메인 데이터'\n\n# 시트 순서 변경\nwb.move_sheet('요약', offset=-2)  # 2칸 앞으로\n\nwb.save('data_sheets.xlsx')\nprint(f'시트 관리 완료. 현재 시트: {wb.sheetnames}')\n```\n\n## 병합 셀 처리\n```python\nfrom openpyxl import load_workbook\n\nwb = load_workbook('data.xlsx')\nws = wb.active\n\n# 병합 셀 해제\nmerged = list(ws.merged_cells.ranges)  # 복사 필요 (순회 중 변경 방지)\nfor cell_range in merged:\n    ws.unmerge_cells(str(cell_range))\n\n# 병합 셀 생성\nws.merge_cells('A1:D1')  # A1~D1 병합\nws['A1'] = '통합 헤더'\nws['A1'].alignment = Alignment(horizontal='center')\n\nwb.save('data_merged.xlsx')\n```"
    },
    {
      "title": "Excel 변환 및 고급 처리",
      "content": "# Excel 변환 및 고급 처리\n\n## Excel ↔ CSV 변환\n```python\nimport pandas as pd\n\n# Excel → CSV\ndf = pd.read_excel('data.xlsx')\ndf.to_csv('data.csv', index=False, encoding='utf-8-sig')  # utf-8-sig: Excel에서 한글 깨짐 방지\n\n# CSV → Excel\ndf = pd.read_csv('data.csv')\ndf.to_excel('data.xlsx', index=False)\n\n# 특정 시트만 CSV로\nall_sheets = pd.read_excel('data.xlsx', sheet_name=None)\nfor name, sheet_df in all_sheets.items():\n    sheet_df.to_csv(f'{name}.csv', index=False, encoding='utf-8-sig')\n    print(f'{name}.csv 저장 ({len(sheet_df)}행)')\n```\n\n## 대용량 Excel 처리\n```python\n# openpyxl read_only 모드 (메모리 절약, 대용량 파일에 권장)\nfrom openpyxl import load_workbook\nwb = load_workbook('large_data.xlsx', read_only=True)\nws = wb.active\nfor row in ws.iter_rows(min_row=2, values_only=True):\n    # 행 단위 처리\n    pass\nwb.close()  # read_only 모드에서는 반드시 close\n```\n\n## 수식 처리\n```python\nfrom openpyxl import load_workbook\n\n# 수식 읽기 (data_only=False가 기본값)\nwb = load_workbook('data.xlsx', data_only=False)\nws = wb.active\nprint(f'A1 수식: {ws[\"A1\"].value}')  # 예: =SUM(B2:B10)\n\n# 수식의 계산된 값 읽기 (Excel에서 마지막 저장 시 계산된 값)\nwb_values = load_workbook('data.xlsx', data_only=True)\nws_values = wb_values.active\nprint(f'A1 값: {ws_values[\"A1\"].value}')  # 예: 55000\n\n# 수식 추가\nws['E2'] = '=SUM(B2:D2)'\nws['E3'] = '=VLOOKUP(A3,Sheet2!A:B,2,FALSE)'\nws['F2'] = '=IF(E2>10000,\"고액\",\"일반\")'\n\n# 열 전체에 수식 적용\nfor row in range(2, ws.max_row + 1):\n    ws[f'G{row}'] = f'=B{row}*C{row}'\n    ws[f'H{row}'] = f'=IF(G{row}>0,\"이익\",\"손실\")'\n\nwb.save('data_formulas.xlsx')\n```\n\n## 이미지 삽입\n```python\nfrom openpyxl import load_workbook\nfrom openpyxl.drawing.image import Image\n\nwb = load_workbook('report.xlsx')\nws = wb.active\n\nimg = Image('chart.png')\nimg.width = 600\nimg.height = 400\nws.add_image(img, 'F2')  # F2 셀에 삽입\n\nwb.save('report_with_chart.xlsx')\n```\n\n## 공통 워크플로우\n```bash\n# 분석만 (결과 출력)\npip install pandas openpyxl && python analyze_excel.py\n\n# 수정 포함 (새 파일 생성)\npip install pandas openpyxl && python modify_excel.py\n\n# 주의: 원본 파일을 직접 덮어쓰지 않도록 다른 이름으로 저장\n```\n\n## 에러 처리\n```python\nimport sys\ntry:\n    df = pd.read_excel(input_path)\nexcept FileNotFoundError:\n    print(f'파일을 찾을 수 없습니다: {input_path}', file=sys.stderr)\n    sys.exit(1)\nexcept Exception as e:\n    print(f'Excel 읽기 실패: {e}', file=sys.stderr)\n    sys.exit(1)\n```"
    }
  ]
}
