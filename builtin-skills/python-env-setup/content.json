{
  "systemPrompt": "Python 스크립트를 실행할 때 반드시 SEPilot 전용 가상환경(venv)을 사용합니다. 글로벌 Python에 직접 pip install하지 마세요. 모든 패키지는 격리된 venv 내에서 설치하고 실행합니다.\n\n## SEPilot Python venv 규칙\n\n1. **venv 경로**: `~/.sepilot/environments/python`\n2. **멱등적 생성**: venv가 없을 때만 생성합니다. 이미 있으면 건너뜁니다.\n3. **절대 경로 실행**: `$VENV/bin/python`, `$VENV/bin/pip`을 직접 호출합니다. PATH에 의존하지 않습니다.\n4. **원샷 패턴**: command_execute에서는 venv 생성 → pip install → python 실행을 한 줄로 연결합니다.\n\n## 원샷 실행 패턴 (command_execute용)\n\n```bash\nVENV=\"$HOME/.sepilot/environments/python\" && \\\n(test -f \"$VENV/bin/python\" || python3 -m venv \"$VENV\") && \\\n\"$VENV/bin/pip\" install -q 필요패키지 && \\\n\"$VENV/bin/python\" /path/to/script.py\n```\n\n## 스크립트 내부 패턴 (file_write로 작성하는 .py 파일용, 크로스플랫폼)\n\n스크립트 상단에서 venv pip으로 의존성을 설치합니다:\n```python\nimport subprocess, os, sys\n\nVENV = os.path.expanduser('~/.sepilot/environments/python')\nBIN = 'Scripts' if os.name == 'nt' else 'bin'\nVENV_PIP = os.path.join(VENV, BIN, 'pip')\nVENV_PYTHON = os.path.join(VENV, BIN, 'python')\n\n# venv가 없으면 생성\nif not os.path.isfile(VENV_PYTHON):\n    subprocess.check_call([sys.executable, '-m', 'venv', VENV])\n\n# venv pip으로 패키지 설치\nsubprocess.check_call([VENV_PIP, 'install', '-q', '패키지명'])\n```\n\n## 금지사항\n- ❌ `pip install` 또는 `pip3 install`을 글로벌로 실행\n- ❌ `sys.executable`로 글로벌 Python에 패키지 설치\n- ❌ 사용자에게 수동 패키지 설치 요청\n- ❌ PATH에 의존하여 `python` 또는 `pip` 호출",
  "knowledge": [
    {
      "title": "SEPilot Python venv 환경 구성",
      "content": "# SEPilot Python venv 환경 구성\n\n## 개요\nSEPilot은 전용 Python 가상환경을 사용하여 글로벌 Python 환경을 오염시키지 않습니다.\n\n## venv 경로\n- Linux/macOS: `~/.sepilot/environments/python`\n- Windows: `%USERPROFILE%\\.sepilot\\environments\\python`\n\n## 실행 파일 경로\n- **Linux/macOS**:\n  - Python: `~/.sepilot/environments/python/bin/python`\n  - pip: `~/.sepilot/environments/python/bin/pip`\n- **Windows**:\n  - Python: `%USERPROFILE%\\.sepilot\\environments\\python\\Scripts\\python.exe`\n  - pip: `%USERPROFILE%\\.sepilot\\environments\\python\\Scripts\\pip.exe`\n\n## 멱등적 venv 생성\nvenv가 이미 존재하면 건너뛰고, 없을 때만 생성합니다:\n```bash\n# Linux/macOS 쉘\nVENV=\"$HOME/.sepilot/environments/python\"\ntest -f \"$VENV/bin/python\" || python3 -m venv \"$VENV\"\n```\n\n```python\n# Python 스크립트 내부\nimport subprocess, os, sys\nVENV = os.path.expanduser('~/.sepilot/environments/python')\nVENV_PYTHON = os.path.join(VENV, 'bin', 'python')\nif not os.path.isfile(VENV_PYTHON):\n    subprocess.check_call([sys.executable, '-m', 'venv', VENV])\n```\n\n## 원샷 실행 패턴 (command_execute)\n가장 많이 사용하는 패턴입니다. venv 생성, 패키지 설치, 스크립트 실행을 한 줄로:\n```bash\nVENV=\"$HOME/.sepilot/environments/python\" && \\\n(test -f \"$VENV/bin/python\" || python3 -m venv \"$VENV\") && \\\n\"$VENV/bin/pip\" install -q python-pptx python-docx openpyxl && \\\n\"$VENV/bin/python\" /path/to/create_document.py\n```\n\n## 패키지 설치만\n```bash\nVENV=\"$HOME/.sepilot/environments/python\" && \\\n(test -f \"$VENV/bin/python\" || python3 -m venv \"$VENV\") && \\\n\"$VENV/bin/pip\" install -q pandas matplotlib seaborn\n```\n\n## Python 스크립트 내부에서 venv pip 사용\n```python\nimport subprocess, os\n\nVENV = os.path.expanduser('~/.sepilot/environments/python')\nVENV_PIP = os.path.join(VENV, 'bin', 'pip')\n\n# 패키지 설치 (이미 설치된 경우 빠르게 건너뜀)\nsubprocess.check_call([VENV_PIP, 'install', '-q', 'python-pptx'])\n\nfrom pptx import Presentation\n# ... 문서 생성 로직 ...\n```\n\n## 에러 처리\n```bash\n# python3이 없으면 python으로 재시도\nVENV=\"$HOME/.sepilot/environments/python\" && \\\n(test -f \"$VENV/bin/python\" || python3 -m venv \"$VENV\" 2>/dev/null || python -m venv \"$VENV\") && \\\n\"$VENV/bin/pip\" install -q 패키지명 && \\\n\"$VENV/bin/python\" /path/to/script.py\n```\n\n## 장점\n1. **격리**: 글로벌 Python 환경을 오염시키지 않음\n2. **권한 문제 없음**: 사용자 홈 디렉토리에 설치하므로 sudo 불필요\n3. **충돌 방지**: 다른 프로젝트와 패키지 버전 충돌 없음\n4. **재현성**: 동일한 환경을 항상 보장\n5. **앱 재시작에도 유지**: `~/.sepilot/` 아래에 있으므로 앱 업데이트와 무관"
    }
  ]
}
