{
  "systemPrompt": "당신은 데이터 분석 및 시각화 전문가입니다. SEPilot Desktop은 Plotly.js 차트(```plotly 코드 블록)와 Mermaid 다이어그램(```mermaid 코드 블록)을 채팅 내에서 인라인 렌더링합니다. 간단한 차트는 Plotly JSON으로, 다이어그램/흐름도는 Mermaid로, 복잡한 분석은 Python 스크립트(pandas, matplotlib)로 처리합니다. 항상 데이터 특성에 맞는 최적의 시각화 방식을 선택합니다.\n\n## Python 사용 시 venv 환경 규칙 (필수)\n\nPython 스크립트(pandas, matplotlib 등)를 사용할 때 반드시 SEPilot 전용 가상환경을 사용합니다. 글로벌 Python에 직접 pip install하지 마세요.\n\n- command_execute 원샷 패턴:\n  ```bash\n  VENV=\"$HOME/.sepilot/environments/python\" && \\\n  (test -f \"$VENV/bin/python\" || python3 -m venv \"$VENV\") && \\\n  \"$VENV/bin/pip\" install -q pandas matplotlib seaborn && \\\n  \"$VENV/bin/python\" /path/to/script.py\n  ```\n- 스크립트 내부 패턴:\n  ```python\n  import subprocess, os\n  VENV = os.path.expanduser('~/.sepilot/environments/python')\n  BIN = 'Scripts' if os.name == 'nt' else 'bin'\n     VENV_PIP = os.path.join(VENV, BIN, 'pip')\n  subprocess.check_call([VENV_PIP, 'install', '-q', 'pandas', 'matplotlib'])\n  ```",
  "knowledge": [
    {
      "title": "Plotly.js 인라인 차트 (기본 차트 유형)",
      "content": "# Plotly.js 인라인 차트\n\nSEPilot은 ```plotly 코드 블록에 JSON을 작성하면 채팅 내에서 인터랙티브 차트를 바로 렌더링합니다.\n```json 코드 블록도 data 배열이 있으면 자동으로 Plotly 차트로 감지됩니다.\n\n## 필수 JSON 구조\n```json\n{\n  \"data\": [...],     // 필수: 차트 데이터 배열\n  \"layout\": {...},   // 선택: 레이아웃 설정\n  \"config\": {...}    // 선택: 차트 설정\n}\n```\n\n## 꺾은선 차트 (Line Chart)\n```plotly\n{\n  \"data\": [\n    {\n      \"x\": [\"1월\", \"2월\", \"3월\", \"4월\", \"5월\"],\n      \"y\": [10, 15, 13, 17, 22],\n      \"type\": \"scatter\",\n      \"mode\": \"lines+markers\",\n      \"name\": \"매출\",\n      \"line\": {\"color\": \"#636EFA\", \"width\": 2},\n      \"marker\": {\"size\": 8}\n    },\n    {\n      \"x\": [\"1월\", \"2월\", \"3월\", \"4월\", \"5월\"],\n      \"y\": [8, 12, 11, 14, 18],\n      \"type\": \"scatter\",\n      \"mode\": \"lines+markers\",\n      \"name\": \"비용\",\n      \"line\": {\"dash\": \"dash\"}\n    }\n  ],\n  \"layout\": {\n    \"title\": \"월별 매출 vs 비용\",\n    \"xaxis\": {\"title\": \"월\"},\n    \"yaxis\": {\"title\": \"금액 (만원)\"},\n    \"template\": \"plotly_dark\"\n  }\n}\n```\n\n## 막대 차트 (Bar Chart)\n```plotly\n{\n  \"data\": [\n    {\n      \"x\": [\"React\", \"Vue\", \"Angular\", \"Svelte\"],\n      \"y\": [45, 25, 20, 10],\n      \"type\": \"bar\",\n      \"marker\": {\n        \"color\": [\"#636EFA\", \"#EF553B\", \"#00CC96\", \"#AB63FA\"]\n      },\n      \"text\": [\"45%\", \"25%\", \"20%\", \"10%\"],\n      \"textposition\": \"auto\"\n    }\n  ],\n  \"layout\": {\n    \"title\": \"프레임워크 사용 비율\",\n    \"yaxis\": {\"title\": \"비율 (%)\"}\n  }\n}\n```\n\n## 원형 차트 (Pie Chart)\n```plotly\n{\n  \"data\": [\n    {\n      \"values\": [40, 30, 20, 10],\n      \"labels\": [\"기능 개발\", \"버그 수정\", \"코드 리뷰\", \"문서화\"],\n      \"type\": \"pie\",\n      \"hole\": 0.4,\n      \"textinfo\": \"label+percent\",\n      \"marker\": {\n        \"colors\": [\"#636EFA\", \"#EF553B\", \"#00CC96\", \"#AB63FA\"]\n      }\n    }\n  ],\n  \"layout\": {\"title\": \"개발 시간 분배\"}\n}\n```\n\n## 히스토그램\n```plotly\n{\n  \"data\": [\n    {\n      \"x\": [1, 2, 2, 3, 3, 3, 4, 4, 5, 5, 5, 5, 6, 6, 7],\n      \"type\": \"histogram\",\n      \"nbinsx\": 7,\n      \"marker\": {\"color\": \"#636EFA\"}\n    }\n  ],\n  \"layout\": {\n    \"title\": \"점수 분포\",\n    \"xaxis\": {\"title\": \"점수\"},\n    \"yaxis\": {\"title\": \"빈도\"}\n  }\n}\n```"
    },
    {
      "title": "Plotly.js 고급 차트 유형",
      "content": "# Plotly.js 고급 차트\n\n## 히트맵 (Heatmap)\n```plotly\n{\n  \"data\": [\n    {\n      \"z\": [[1, 20, 30], [20, 1, 60], [30, 60, 1]],\n      \"x\": [\"A팀\", \"B팀\", \"C팀\"],\n      \"y\": [\"A팀\", \"B팀\", \"C팀\"],\n      \"type\": \"heatmap\",\n      \"colorscale\": \"Viridis\",\n      \"text\": [[\"1\", \"20\", \"30\"], [\"20\", \"1\", \"60\"], [\"30\", \"60\", \"1\"]],\n      \"texttemplate\": \"%{text}\",\n      \"showscale\": true\n    }\n  ],\n  \"layout\": {\"title\": \"팀 간 협업 빈도\"}\n}\n```\n\n## 산점도 (Scatter Plot)\n```plotly\n{\n  \"data\": [\n    {\n      \"x\": [1, 2, 3, 4, 5, 6, 7, 8],\n      \"y\": [2, 3.5, 3, 5.5, 5, 7, 6.5, 8],\n      \"mode\": \"markers\",\n      \"type\": \"scatter\",\n      \"marker\": {\n        \"size\": [10, 15, 20, 25, 30, 35, 40, 45],\n        \"color\": [1, 2, 3, 4, 5, 6, 7, 8],\n        \"colorscale\": \"Viridis\",\n        \"showscale\": true\n      },\n      \"text\": [\"P1\", \"P2\", \"P3\", \"P4\", \"P5\", \"P6\", \"P7\", \"P8\"]\n    }\n  ],\n  \"layout\": {\n    \"title\": \"프로젝트 규모 vs 완료 시간\",\n    \"xaxis\": {\"title\": \"복잡도\"},\n    \"yaxis\": {\"title\": \"소요 시간 (주)\"}\n  }\n}\n```\n\n## 트리맵 (Treemap)\n```plotly\n{\n  \"data\": [\n    {\n      \"type\": \"treemap\",\n      \"labels\": [\"전체\", \"Frontend\", \"Backend\", \"DevOps\", \"React\", \"CSS\", \"Node.js\", \"DB\", \"CI/CD\", \"Infra\"],\n      \"parents\": [\"\", \"전체\", \"전체\", \"전체\", \"Frontend\", \"Frontend\", \"Backend\", \"Backend\", \"DevOps\", \"DevOps\"],\n      \"values\": [0, 0, 0, 0, 35, 15, 25, 15, 5, 5],\n      \"textinfo\": \"label+value+percent parent\",\n      \"marker\": {\"colorscale\": \"Blues\"}\n    }\n  ],\n  \"layout\": {\"title\": \"코드베이스 구성\"}\n}\n```\n\n## 다중 축 차트 (Dual Y-Axis)\n```plotly\n{\n  \"data\": [\n    {\n      \"x\": [\"Q1\", \"Q2\", \"Q3\", \"Q4\"],\n      \"y\": [100, 150, 130, 200],\n      \"type\": \"bar\",\n      \"name\": \"매출 (만원)\",\n      \"yaxis\": \"y\"\n    },\n    {\n      \"x\": [\"Q1\", \"Q2\", \"Q3\", \"Q4\"],\n      \"y\": [10, 15, 12, 20],\n      \"type\": \"scatter\",\n      \"mode\": \"lines+markers\",\n      \"name\": \"성장률 (%)\",\n      \"yaxis\": \"y2\"\n    }\n  ],\n  \"layout\": {\n    \"title\": \"분기별 매출 및 성장률\",\n    \"yaxis\": {\"title\": \"매출 (만원)\"},\n    \"yaxis2\": {\n      \"title\": \"성장률 (%)\",\n      \"overlaying\": \"y\",\n      \"side\": \"right\"\n    }\n  }\n}\n```\n\n## 박스 플롯 (Box Plot)\n```plotly\n{\n  \"data\": [\n    {\"y\": [2, 3, 4, 5, 5, 6, 7, 8, 9], \"type\": \"box\", \"name\": \"A팀\"},\n    {\"y\": [1, 3, 3, 5, 6, 6, 7, 8, 10], \"type\": \"box\", \"name\": \"B팀\"},\n    {\"y\": [3, 4, 5, 5, 6, 7, 7, 8, 9], \"type\": \"box\", \"name\": \"C팀\"}\n  ],\n  \"layout\": {\"title\": \"팀별 코드 리뷰 소요 시간 (시간)\"}\n}\n```\n\n## 레이아웃 팁\n- `template`: \"plotly_dark\" (다크 모드), \"plotly_white\" (라이트 모드), \"seaborn\"\n- `legend`: {\"orientation\": \"h\", \"y\": -0.2} (범례 하단 배치)\n- `margin`: {\"l\": 50, \"r\": 50, \"t\": 50, \"b\": 50} (여백 조정)\n- `height`: 400 (차트 높이 고정)\n- `font`: {\"family\": \"sans-serif\", \"size\": 12} (글꼴 설정)"
    },
    {
      "title": "Mermaid 다이어그램 시각화",
      "content": "# Mermaid 다이어그램 시각화\n\nSEPilot은 ```mermaid 코드 블록을 SVG로 인라인 렌더링합니다.\n렌더링 실패 시 LLM이 자동으로 구문을 수정합니다 (최대 3회).\n\n## 플로우차트 (Flowchart)\n```mermaid\nflowchart TD\n    A[데이터 수집] --> B[전처리]\n    B --> C{결측값?}\n    C -->|있음| D[결측값 처리]\n    C -->|없음| E[탐색적 분석]\n    D --> E\n    E --> F[시각화]\n    F --> G[인사이트 도출]\n```\n\n## 시퀀스 다이어그램\n```mermaid\nsequenceDiagram\n    participant U as 사용자\n    participant F as Frontend\n    participant B as Backend\n    participant DB as Database\n    U->>F: 데이터 요청\n    F->>B: API 호출\n    B->>DB: 쿼리 실행\n    DB-->>B: 결과 반환\n    B-->>F: JSON 응답\n    F-->>U: 차트 렌더링\n```\n\n## 간트 차트\n```mermaid\ngantt\n    title 프로젝트 일정\n    dateFormat YYYY-MM-DD\n    section 기획\n        요구사항 분석     :a1, 2025-01-01, 7d\n        설계              :a2, after a1, 5d\n    section 개발\n        프론트엔드        :b1, after a2, 14d\n        백엔드            :b2, after a2, 14d\n    section 테스트\n        QA 테스트         :c1, after b1, 7d\n```\n\n## 파이 차트\n```mermaid\npie title 이슈 유형 분포\n    \"버그\" : 35\n    \"기능 요청\" : 40\n    \"개선\" : 15\n    \"문서\" : 10\n```\n\n## 마인드맵\n```mermaid\nmindmap\n  root((데이터 분석))\n    수집\n      API\n      크롤링\n      CSV 파일\n    전처리\n      결측값 처리\n      이상치 제거\n      정규화\n    시각화\n      Plotly\n      Mermaid\n      Matplotlib\n    모델링\n      회귀 분석\n      분류\n      클러스터링\n```\n\n## ER 다이어그램\n```mermaid\nerDiagram\n    USERS ||--o{ ORDERS : places\n    USERS {\n        int id PK\n        string name\n        string email\n    }\n    ORDERS ||--|{ ORDER_ITEMS : contains\n    ORDERS {\n        int id PK\n        date created_at\n        string status\n    }\n    ORDER_ITEMS }o--|| PRODUCTS : references\n    PRODUCTS {\n        int id PK\n        string name\n        float price\n    }\n```\n\n## 클래스 다이어그램\n```mermaid\nclassDiagram\n    class DataProcessor {\n        +DataFrame data\n        +load(path: str) DataFrame\n        +clean() DataFrame\n        +transform() DataFrame\n    }\n    class Visualizer {\n        +create_chart(data, type) Chart\n        +export(format: str) File\n    }\n    DataProcessor --> Visualizer : feeds data\n```\n\n## 상태 다이어그램\n```mermaid\nstateDiagram-v2\n    [*] --> 수집중\n    수집중 --> 전처리중 : 데이터 확보\n    전처리중 --> 분석중 : 클리닝 완료\n    분석중 --> 시각화 : 인사이트 도출\n    시각화 --> 보고서작성 : 차트 완성\n    보고서작성 --> [*] : 완료\n    분석중 --> 전처리중 : 추가 정제 필요\n```\n\n## 주의사항\n- 노드 텍스트에 특수문자(괄호, 따옴표) 사용 시 큰따옴표로 감쌀 것\n- 한글 사용 가능하나, 특수문자 조합 시 렌더링 오류 가능\n- 복잡한 다이어그램은 자동 수정이 실패할 수 있으므로 단순하게 유지"
    },
    {
      "title": "Python 데이터 분석 (pandas + matplotlib)",
      "content": "# Python 데이터 분석 워크플로우\n\n복잡한 데이터 분석이나 파일 기반 처리가 필요할 때 Python 스크립트를 작성하여 실행합니다.\n\n## 워크플로우\n1. file_write로 Python 스크립트(.py) 작성\n2. command_execute로 `pip install pandas matplotlib && python script.py` 실행\n3. 결과 파일(이미지, CSV 등) 경로 안내\n\n## CSV 분석 + 차트 생성\n```python\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib\nmatplotlib.use('Agg')  # GUI 없는 환경\nplt.rcParams['font.family'] = 'DejaVu Sans'  # 한글: 'NanumGothic'\n\n# 데이터 로드\ndf = pd.read_csv('data.csv')\n\n# 기본 통계\nprint('=== 기본 통계 ===')\nprint(df.describe())\nprint(f'\\n행: {len(df)}, 열: {len(df.columns)}')\nprint(f'결측값:\\n{df.isnull().sum()}')\n\n# 시각화\nfig, axes = plt.subplots(2, 2, figsize=(12, 10))\n\n# 1. 막대 차트\ndf.groupby('category')['amount'].sum().plot(kind='bar', ax=axes[0,0], color='#636EFA')\naxes[0,0].set_title('카테고리별 합계')\n\n# 2. 꺾은선 차트\ndf.groupby('date')['amount'].mean().plot(kind='line', ax=axes[0,1], marker='o')\naxes[0,1].set_title('일별 평균')\n\n# 3. 히스토그램\ndf['amount'].plot(kind='hist', ax=axes[1,0], bins=20, color='#EF553B')\naxes[1,0].set_title('금액 분포')\n\n# 4. 상관관계 히트맵\nnumeric_cols = df.select_dtypes(include='number')\nim = axes[1,1].imshow(numeric_cols.corr(), cmap='coolwarm', aspect='auto')\naxes[1,1].set_xticks(range(len(numeric_cols.columns)))\naxes[1,1].set_xticklabels(numeric_cols.columns, rotation=45)\naxes[1,1].set_yticks(range(len(numeric_cols.columns)))\naxes[1,1].set_yticklabels(numeric_cols.columns)\naxes[1,1].set_title('상관관계')\nplt.colorbar(im, ax=axes[1,1])\n\nplt.tight_layout()\noutput_path = '/path/to/analysis_result.png'\nplt.savefig(output_path, dpi=150, bbox_inches='tight')\nprint(f'\\n차트 저장: {output_path}')\n```\n\n## 피벗 테이블 분석\n```python\nimport pandas as pd\n\ndf = pd.read_csv('sales.csv')\n\n# 피벗 테이블\npivot = pd.pivot_table(\n    df,\n    values='amount',\n    index='region',\n    columns='product',\n    aggfunc=['sum', 'mean', 'count']\n)\nprint(pivot.to_markdown())\n\n# 결과를 CSV로 저장\npivot.to_csv('/path/to/pivot_result.csv')\nprint(f'피벗 테이블 저장 완료')\n```\n\n## 시계열 분석\n```python\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib\nmatplotlib.use('Agg')\n\ndf = pd.read_csv('timeseries.csv', parse_dates=['date'])\ndf = df.set_index('date').sort_index()\n\nfig, axes = plt.subplots(3, 1, figsize=(12, 10))\n\n# 원본 데이터\ndf['value'].plot(ax=axes[0], title='원본 데이터')\n\n# 7일 이동 평균\ndf['value'].rolling(window=7).mean().plot(ax=axes[1], title='7일 이동 평균', color='orange')\n\n# 월별 집계\ndf['value'].resample('M').sum().plot(kind='bar', ax=axes[2], title='월별 합계')\n\nplt.tight_layout()\nplt.savefig('/path/to/timeseries_analysis.png', dpi=150)\nprint('시계열 분석 완료')\n```\n\n## 설치 명령어\n```bash\n# 기본 분석\npip install pandas matplotlib\n\n# 고급 분석\npip install pandas matplotlib seaborn scipy scikit-learn\n\n# 대용량 데이터\npip install pandas pyarrow\n```"
    },
    {
      "title": "시각화 방식 선택 가이드",
      "content": "# 시각화 방식 선택 가이드\n\n## 방식별 비교\n\n| 방식 | 장점 | 단점 | 적합한 경우 |\n|------|------|------|------------|\n| Plotly (```plotly) | 인터랙티브, 인라인 렌더링 | 대용량 데이터 제한 | 간단한 차트, 빠른 시각화 |\n| Mermaid (```mermaid) | 인라인 렌더링, 텍스트 기반 | 데이터 차트 제한적 | 다이어그램, 흐름도, 구조도 |\n| Python (matplotlib) | 복잡한 분석, 대용량 | 별도 실행 필요 | CSV 분석, 통계, 대시보드 |\n\n## 데이터 유형별 추천\n\n### 비교\n- 항목 간 비교 → Plotly 막대 차트\n- 비율 비교 → Plotly 원형 차트 또는 트리맵\n- 팀/그룹 비교 → Plotly 박스 플롯\n\n### 추세\n- 시간별 변화 → Plotly 꺾은선 차트\n- 계절성 분석 → Python 시계열 분석\n- 성장률 추적 → Plotly 다중 축 차트\n\n### 분포\n- 값 분포 → Plotly 히스토그램\n- 이상치 탐지 → Plotly 박스 플롯\n- 다변수 분포 → Python matplotlib 서브플롯\n\n### 관계\n- 변수 간 관계 → Plotly 산점도\n- 상관관계 → Plotly 히트맵\n- 다변수 관계 → Python seaborn pairplot\n\n### 구조/흐름\n- 프로세스 흐름 → Mermaid 플로우차트\n- 시스템 아키텍처 → Mermaid 플로우차트/C4\n- API 호출 흐름 → Mermaid 시퀀스 다이어그램\n- 일정 관리 → Mermaid 간트 차트\n- DB 스키마 → Mermaid ER 다이어그램\n- 상태 전이 → Mermaid 상태 다이어그램\n- 개념 구조화 → Mermaid 마인드맵\n\n### 대시보드\n- 여러 차트 조합 → Python matplotlib subplot\n- KPI 대시보드 → Plotly indicator + subplots\n\n## Plotly 다크 모드 팁\nSEPilot은 다크 모드를 지원합니다. Plotly 차트에서:\n```json\n{\n  \"layout\": {\n    \"template\": \"plotly_dark\",\n    \"paper_bgcolor\": \"rgba(0,0,0,0)\",\n    \"plot_bgcolor\": \"rgba(0,0,0,0)\"\n  }\n}\n```\n\n## 색상 팔레트 추천\n- Plotly 기본: #636EFA, #EF553B, #00CC96, #AB63FA, #FFA15A, #19D3F3\n- 순차형: Viridis, Blues, Reds, Greens\n- 발산형: RdBu, Spectral, Picnic\n- 정성형: Set1, Pastel1, Dark2"
    }
  ]
}
