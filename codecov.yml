# Codecov Configuration
# https://docs.codecov.io/docs/codecov-yaml

codecov:
  require_ci_to_pass: yes
  notify:
    wait_for_ci: yes

  # CI 공급자 설정
  ci:
    - "github-actions"

coverage:
  precision: 2
  round: down
  range: "70...100"

  status:
    # 전체 프로젝트 커버리지 체크
    project:
      default:
        target: 55%
        threshold: 2%
        if_ci_failed: error
        informational: false
        only_pulls: false

      # 프론트엔드 커버리지
      frontend:
        flags:
          - frontend
        target: 50%
        threshold: 3%
        informational: true
        paths:
          - "app/**"
          - "components/**"

      # 백엔드 커버리지
      backend:
        flags:
          - backend
        target: 55%
        threshold: 2%
        informational: false
        paths:
          - "lib/**"
          - "electron/**"

      # 주요 컴포넌트별 커버리지 추적
      chat:
        flags:
          - frontend
        target: 60%
        paths:
          - "components/chat/**"
          - "app/(chat)/**"
        informational: true

      langgraph:
        flags:
          - backend
        target: 65%
        paths:
          - "lib/langgraph/**"
        informational: true

      mcp:
        flags:
          - backend
        target: 60%
        paths:
          - "lib/mcp/**"
        informational: true

      electron-ipc:
        flags:
          - backend
        target: 70%
        paths:
          - "electron/ipc/**"
        informational: true

    # 새로 추가된 코드의 커버리지 체크
    patch:
      default:
        target: 60%
        threshold: 5%
        if_ci_failed: error
        informational: false
        only_pulls: true

      # 새 프론트엔드 코드
      frontend:
        flags:
          - frontend
        target: 55%
        informational: true

      # 새 백엔드 코드
      backend:
        flags:
          - backend
        target: 65%
        informational: true

    # 변경사항 커버리지
    changes:
      default:
        informational: true
        if_ci_failed: success

# Flag별 설정
flags:
  frontend:
    paths:
      - app/
      - components/
      - types/
    carryforward: true
    carryforward_mode: "labels"

  backend:
    paths:
      - lib/
      - electron/
      - types/
    carryforward: true
    carryforward_mode: "labels"

  bundle-analysis:
    paths:
      - .next/analyze/
    carryforward: false

# PR 코멘트 설정
comment:
  # 레이아웃: header, diff, flags, components, files, footer
  layout: "header,diff,flags,components,files,footer"
  behavior: default
  require_changes: false
  require_base: no
  require_head: yes
  # 변경사항이 있는 파일만 표시
  show_carryforward_flags: false
  # 커버리지 차트 포함
  after_n_builds: 1
  # 최소 커버리지 변경사항 표시 (0.01%)
  hide_comment_details: false

# Component별 추적
component_management:
  individual_components:
    # Chat 컴포넌트
    - component_id: chat
      name: "Chat System"
      paths:
        - "components/chat/**"
        - "app/(chat)/**"

    # LangGraph 시스템
    - component_id: langgraph
      name: "LangGraph Agent"
      paths:
        - "lib/langgraph/**"

    # MCP 통합
    - component_id: mcp
      name: "MCP Integration"
      paths:
        - "lib/mcp/**"

    # RAG 시스템
    - component_id: rag
      name: "RAG System"
      paths:
        - "lib/rag/**"

    # Electron IPC
    - component_id: electron
      name: "Electron IPC"
      paths:
        - "electron/ipc/**"

    # Settings
    - component_id: settings
      name: "Settings"
      paths:
        - "components/settings/**"
        - "app/settings/**"

# GitHub Checks
github_checks:
  annotations: true

# Pull Request Comments
parsers:
  gcov:
    branch_detection:
      conditional: yes
      loop: yes
      method: no
      macro: no

# 커버리지에서 제외할 파일
ignore:
  - "**/*.test.ts"
  - "**/*.test.tsx"
  - "**/*.spec.ts"
  - "**/*.spec.tsx"
  - "**/*.d.ts"
  - "dist/"
  - ".next/"
  - "out/"
  - "release/"
  - "node_modules/"
  - "scripts/"
  - "**/__mocks__/"
  - "**/__tests__/"
  - "**/*.config.js"
  - "**/*.config.ts"
  - "jest.config.js"
  - "next.config.js"
  - "tailwind.config.ts"
  - "postcss.config.js"
