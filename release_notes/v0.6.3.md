# SEPilot Desktop v0.6.3 릴리스 노트

## 주요 변경 사항

### 새로운 기능

- **DocumentList 탭 구조 대폭 개선 - Team Docs별 독립 탭**
  - **근본적 UX 개선**: 각 Team Docs를 별도 탭으로 분리
  - **동적 탭 생성**: `[Personal] [프로젝트 문서] [개발 가이드] ...` 각 Team Docs별 독립 탭
  - **Tree View 완전 분리**: 각 Team Docs별로 독립적인 Tree View 표시
  - **Push/Pull 버튼 개선**: 각 탭에서 해당 Team Docs의 Push/Pull 버튼만 표시
  - **명확한 구분**: 여러 Team Docs의 문서가 섞이지 않음
  - **필터링 로직 개선**: `filterByActiveTab` 함수로 Personal 또는 특정 Team Docs만 정확히 필터링
  - 코드 위치: `components/rag/DocumentList.tsx:64-1140`

- **DocumentUploadDialog에 Team Docs Repository 선택 기능 추가**
  - **근본 원인 해결**: 문서 생성 시부터 올바른 `teamDocsId` 설정
  - **Team Docs 선택 UI**: 문서 그룹을 'team'으로 선택 시 Repository 선택 드롭다운 표시
  - **자동 메타데이터 설정**: 선택한 Team Docs의 `teamDocsId`, `teamName`, `source` 자동 포함
  - **검증 로직**: Team Docs 선택하지 않으면 업로드 차단
  - **사용자 안내**: Team Docs 미설정 시 경고 메시지 표시
  - 코드 위치: `components/rag/DocumentUploadDialog.tsx:59-324`

### 버그 수정 및 UX 개선

- **Team Docs Push 에러 방지 및 UX 개선**
  - **UI 개선**: `teamDocsId`가 없는 경우 "저장 & Push" 버튼 비활성화
  - **시각적 피드백**: 비활성화된 버튼에 경고 아이콘 표시
  - **명확한 설명**: Tooltip으로 Push 불가 이유 설명
    - "Team Docs ID가 없어 GitHub Push를 할 수 없습니다."
    - "이 문서는 Team Docs에서 가져온 문서가 아닙니다."
  - **이중 안전장치**: 버튼 비활성화 + 백엔드 검증으로 에러 방지
  - 코드 위치:
    - UI 개선: `components/rag/DocumentEditDialog.tsx:477-520`
    - 백엔드 검증: `components/rag/DocumentEditDialog.tsx:219-226`

## 기술적 세부 사항

### 에러 발생 근본 원인

#### 1. DocumentList 탭 구조 문제

**기존 구조**:

- 단순히 `[Personal] [Team]` 두 개의 탭만 존재
- Team 탭에서 **모든 Team Docs의 문서가 섞여서 표시**
- 필터링: `docGroup === 'team'`만 확인, `teamDocsId` 구분 안함
- 결과: 여러 Team Docs의 문서가 하나의 tree에 혼재

**문제점**:

- 사용자가 어떤 Team Docs의 문서인지 구분 불가
- Push/Pull 버튼은 리스트로 표시되지만 tree view는 모두 섞임
- 특정 Team Docs의 문서만 보고 싶어도 불가능

#### 2. DocumentUploadDialog 메타데이터 누락

DocumentUploadDialog에서 `docGroup: 'team'`을 선택하면:

- **문제**: `teamDocsId` 없이 문서가 생성됨
- **결과**: 해당 문서는 Team Docs로 Push 불가능
- **에러**: "Team Docs 설정을 찾을 수 없습니다: undefined"

기존에는:

1. 사용자가 DocumentUploadDialog에서 Team Docs 선택
2. `docGroup: 'team'`만 설정되고 `teamDocsId`는 누락
3. DocumentEditDialog에서 "저장 & Push" 시도
4. `teamDocsId: undefined` 전달 → 에러 발생

### 해결 방법

#### 1. DocumentList 탭 구조 개선

- **activeTab 타입 변경**:

  ```typescript
  // 기존: const [activeTab, setActiveTab] = useState<'personal' | 'team'>('personal');
  // 개선: const [activeTab, setActiveTab] = useState<string>('personal');
  // 'personal' 또는 teamDocsId
  ```

- **동적 탭 생성**:

  ```typescript
  <TabsList style={{ gridTemplateColumns: `repeat(${1 + teamDocs.length}, minmax(0, 1fr))` }}>
    <TabsTrigger value="personal">Personal</TabsTrigger>
    {teamDocs.map(team => (
      <TabsTrigger value={team.id}>{team.name}</TabsTrigger>
    ))}
  </TabsList>
  ```

- **필터링 로직 개선**:

  ```typescript
  const filterByActiveTab = (docs) => {
    if (activeTab === 'personal') {
      return docs.filter((doc) => doc.metadata?.docGroup === 'personal');
    } else {
      // activeTab이 teamDocsId
      return docs.filter((doc) => doc.metadata?.teamDocsId === activeTab);
    }
  };
  ```

- **Push/Pull 버튼 단순화**:
  - 각 탭에서 현재 Team Docs의 Push/Pull 버튼만 단일 카드로 표시
  - 리스트 형태에서 단일 카드 형태로 변경

#### 2. DocumentUploadDialog 개선

- **Team Docs Repository 선택 UI 추가**:
  - `docGroup: 'team'` 선택 시 Repository 드롭다운 표시
  - 사용자가 명시적으로 어떤 Team Docs인지 선택
- **자동 메타데이터 설정**:
  - `teamDocsId`: 선택한 Team Docs ID
  - `teamName`: Team Docs 이름
  - `source`: `{owner}/{repo}` 형식
- **검증 로직**:
  - Team Docs 선택하지 않으면 업로드 차단
  - Team Docs 미설정 시 경고 메시지 표시

#### 3. DocumentEditDialog 개선 (증상 완화)

- **프론트엔드 (1차 방어)**:
  - `teamDocsId` 없으면 "저장 & Push" 버튼 비활성화
  - Tooltip으로 상태 및 이유 설명
  - AlertCircle 아이콘으로 시각적 피드백
- **백엔드 (2차 방어)**:
  - Push 요청 전 `teamDocsId` 존재 여부 검증
  - 검증 실패 시 Push 중단 및 명확한 에러 메시지 표시

### UI/UX 개선 효과

- **명확한 구분**: 각 Team Docs별로 독립적인 탭과 Tree View
- **직관적 탐색**: 원하는 Team Docs 탭을 선택하여 해당 문서만 확인
- **효율적 관리**: 각 Team Docs별로 독립적인 Push/Pull 가능
- **근본 해결**: 처음부터 올바른 메타데이터로 문서 생성
- **사용자 가이드**: 어떤 Team Docs에 속할지 명확히 선택
- **에러 방지**: 잘못된 상태의 문서가 생성되지 않음
- **직관적 UI**: 혼란스러운 에러 대신 사전 안내

## 영향 범위

- **DocumentList (대폭 개선)**: 탭 구조, 필터링, Push/Pull UI
- **DocumentUploadDialog (신규)**: Team Docs 선택 기능
- **DocumentEditDialog (개선)**: Push 버튼 검증
- **전반적 효과**: Team Docs 사용성 및 안정성 대폭 향상
