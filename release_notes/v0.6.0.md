# SEPilot Desktop v0.6.0 릴리스 노트

## 주요 변경 사항

### UI/UX 개선

* **이미지 첨부/생성 시 자동으로 Instant 모드로 전환 및 모드 잠금**
  * 이미지가 붙여넣기되거나 선택되면 자동으로 Thinking 모드가 Instant로 변경됨
  * 이미지 생성 토글이 활성화되면 자동으로 Instant 모드로 전환됨
  * 이미지 생성이 활성화된 동안 Thinking 모드 변경 불가 (두 기능은 공존 불가)
  * 멀티모달 모델과 이미지 생성은 Agent 그래프를 사용해야 하므로 Instant 모드가 최적
  * 사용자 경험 개선: 이미지 분석/생성 시 불필요한 사고 과정 생략

* **LLM 상태 표시줄을 별도 컴포넌트로 분리**
  * InputBox 하단의 모델 정보 표시 부분을 `LLMStatusBar` 컴포넌트로 분리
  * 모델명, max tokens, temperature, 컨텍스트 사용량 표시
  * 클릭하여 max tokens 및 temperature 즉시 수정 가능
  * 코드 재사용성 및 유지보수성 향상

* **사용 가능한 툴 목록 표시 기능**
  * LLMStatusBar에 MCP 툴 개수 표시 (예: "5 tools")
  * 툴 아이콘 클릭 시 Popover로 전체 툴 목록 표시
  * MCP 서버별 그룹화 및 Built-in 툴 구분
  * 각 툴의 이름과 설명 표시로 사용 가능한 기능 확인 용이
  * Radix UI Popover 컴포넌트 추가

### 코딩 에이전트 (Thinking Mode: Coding) 개선

* **Human-in-the-loop 툴 승인 기능 정상 작동**
  * `CodingAgentGraph` 클래스 추가 및 `stream()` 메서드 구현
  * Agent 그래프와 동일한 패턴으로 툴 승인 콜백 통합
  * 툴 호출 시 사용자 승인 대기 및 승인/거부 이벤트 처리
  * `lib/langgraph/index.ts`의 `streamCodingAgentGraph()` 메서드로 스트리밍 처리

* **에이전트 툴 호출 화면 표시 개선**
  * 각 노드 실행 시 이벤트 yield 추가 (`type: 'node'`)
  * Triage, Planner, Agent, Tools, Verifier, Reporter 등 모든 노드의 실행 상태 UI에 표시
  * 툴 승인 요청 및 결과 이벤트 (`tool_approval_request`, `tool_approval_result`) 별도 처리
  * 에러 이벤트 (`type: 'error'`) 처리 강화

* **코드 구조 개선**
  * Agent 그래프 (`agent.ts`)의 구현 패턴을 Coding Agent에 적용
  * 반복 가드 (iteration guard) 로직으로 무한 루프 방지
  * State 업데이트 및 이벤트 방출 로직 일관성 확보

* **Coding Agent 과정 전체 표시 (Claude Code 스타일)**
  * ReAct iteration 중 메시지가 사라지는 문제 해결
  * 모든 thinking, tool call, tool result 과정을 순차적으로 표시
  * 각 단계별 아이콘 및 포맷팅:
    - 🤔 **Thinking**: AI의 사고 과정
    - 🔧 **Using tools**: 사용 중인 툴 목록
    - ✅ **Tool result**: 툴 실행 결과 (500자 초과 시 truncate)
  * 긴 스크롤이 발생해도 전체 과정이 유지되어 사용자가 무슨 일이 일어나는지 명확히 파악 가능

* **Claude Code 스타일로 완전 리팩토링**
  * 복잡한 노드 제거 (Triage, Planner, Verifier)
  * 단순한 ReAct 루프 구현: Agent → Tool Approval → Tools → 반복
  * enhancedToolsNode에서 툴 결과를 메시지로 변환하여 LLM에 전달
    - file_list 등의 툴이 가짜 응답 대신 실제 결과 반환
    - OpenAI 호환 형식으로 tool result 메시지 생성
  * Reporter 노드를 에러/최대 반복 시에만 메시지 생성하도록 수정
    - 정상 완료 시 빈 객체 반환하여 기존 메시지 유지
    - 모든 thinking, tool call, tool result 과정이 화면에 남아있음
  * ToolExecutionResult 타입 명시적 정의로 타입 안정성 확보

* **Claude Code 스타일 툴 승인 UI 구현**
  * ToolApprovalDialog에 "예/아니오/항상 예(이번 세션)" 3가지 버튼 제공
  * 세션 단위 자동 승인 기능 (alwaysApproveToolsForSession)
    - "항상 예" 선택 시 이후 모든 툴 호출 자동 승인
    - 페이지 새로고침 시 초기화 (세션 단위)
  * ChatStore에 상태 관리 추가 및 InputBox에서 자동 승인 로직 처리
  * 반복적인 승인 없이 원활한 코딩 작업 가능

* **파일 변경 사항 Git Diff 스타일 표시**
  * 파일 생성/수정/삭제 시 변경 사항을 git diff 스타일로 시각화
  * MessageBubble에서 file_write, file_edit 툴 호출 자동 감지
  * CodeDiffViewer로 라인별 변경 사항 표시:
    - 추가된 줄 (+) 초록색
    - 삭제된 줄 (-) 빨간색
    - 수정된 줄 (~) 주황색
  * 파일 경로, 변경 통계 (추가/삭제/수정 라인 수) 표시
  * Message 타입에 FileChange 인터페이스 추가
  * Cursor 스타일의 파일 변경 확인 UI 제공

### RAG 개선

* **문서 청킹 크기 최적화**
  * chunkSize를 500자에서 2500자로 증가 (5배)
  * chunkOverlap을 50자에서 250자로 증가 (10% 비율 유지)
  * 벡터 임베딩 품질을 유지하면서도 더 풍부한 맥락 제공
  * 문서가 과도하게 쪼개지는 문제 해결 (청크 수 1/5로 감소)
  * 2500자는 약 600-750 토큰으로 임베딩 모델의 최적 범위 내
  * 한국어 텍스트에 더 적합한 크기로 여러 문단의 맥락 유지 가능

### 버그 수정

* **LLM 에러 발생 시 화면에 표시되지 않던 문제 해결**
  * CodingAgentState에 `agentError` 필드 추가
  * LLM API 호출 실패 시 (500 Internal Server Error 등) 사용자 친화적 에러 메시지 표시
  * 에러 발생 즉시 루프 종료 및 Reporter에서 처리
  * 이전에는 에러가 로그에만 출력되고 UI에 표시되지 않았던 문제 수정

* **설정 변경 시 프로그램 재시작 없이 즉시 반영되도록 수정**
  * Main Process의 `llm-init` 핸들러가 `LLMConfig` 대신 `AppConfig`를 올바르게 받도록 수정
  * `types/electron.d.ts`의 타입 정의와 실제 구현 불일치 문제 해결
  * 이제 LLM/Network 설정 변경 후 바로 적용됨 (재시작 불필요)

* **이미지 갤러리/문서 관리 페이지에서 대화 클릭 시 채팅 화면으로 전환되지 않던 문제 해결**
  * Sidebar에 `onConversationClick` prop 추가
  * 대화 목록 및 검색 결과 클릭 시 viewMode를 'chat'으로 전환하도록 수정
  * 이제 갤러리나 문서 페이지에서 사이드바의 대화를 클릭하면 정상적으로 채팅 화면으로 돌아감

* **InputBox 컴포넌트 미사용 변수 제거**
  * `ImageGenerationProgress` 타입 import 제거
  * `updateImageGenerationProgress` 함수 destructure 제거

---

**전체 변경 로그**: v0.5.0...v0.6.0
