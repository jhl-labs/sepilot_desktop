# SEPilot Desktop v0.6.16 릴리즈 노트

**릴리즈 날짜**: 2025-01-15

## 🎯 주요 개선사항

### 프록시 설정 안정성 최종 완성

v0.6.15의 프록시 개선사항을 기반으로, 사용자가 잘못된 프록시 설정 조합을 생성하거나 저장하지 못하도록 완전히 차단했습니다.

## 🐛 버그 수정

### 1. 프록시 설정 논리적 모순 방지 및 자동 정규화 (08c9d14)

**문제**:

- UI에서 `enabled: true + mode: 'none'` 조합 생성 가능
- DB에 잘못된 설정이 저장되면 프록시가 의도대로 동작하지 않음
- 사용자가 "프록시 사용"을 켰지만 모드를 "사용 안함"으로 선택하는 논리적 모순 발생

**수정 내역**:

**components/settings/NetworkSettingsTab.tsx**:

- **프록시 enabled toggle 로직 개선:**
  - OFF로 변경 → 자동으로 `mode: 'none'` 설정
  - ON으로 변경 → mode가 'none'이면 자동으로 'system'으로 변경
- **mode dropdown에서 'none' 옵션 제거:**
  - 이제 'system'과 'manual'만 선택 가능
  - 논리적 모순 조합 생성 불가능

**lib/http/config.ts**:

- **`normalizeNetworkConfig()` 함수 추가:**
  - `enabled: true + mode: 'none'` → `enabled: false` 자동 수정
  - `enabled: false + mode: 'manual' or 'system'` → `mode: 'none'` 자동 수정
- **모든 로드 함수에 정규화 적용:**
  - Database, IPC, localStorage에서 설정 로드 시 자동 정규화
  - 기존 잘못된 설정이 자동으로 수정됨

**효과**:

- UI에서 논리적으로 올바른 설정만 생성 가능
- DB에 저장된 잘못된 설정은 로드 시 자동 수정
- 프록시 "사용 안함" 의도가 명확하게 적용됨

### 2. browser-stub에 safeJsonParse 및 HttpError export 추가 (f090040)

**문제**:

- Next.js 빌드 시 browser-stub.ts에서 `safeJsonParse`, `HttpError`가 export되지 않음
- "Attempted import error" 발생으로 빌드 실패

**수정 내역**:

**lib/http/browser-stub.ts**:

- `safeJsonParse()` 함수 stub 추가
- `HttpError` 클래스 stub 추가
- `HttpErrorType` 타입 export 추가

**효과**:

- Next.js 빌드 성공
- 브라우저 환경에서도 에러 없이 import 가능

## 📊 적용 범위

### ✅ 완벽 적용된 기능

이번 릴리즈로 다음 기능들의 프록시 환경 안정성이 완벽해졌습니다:

- **LLM 통신**: OpenAI, Ollama (모델 조회, 채팅)
- **Settings UI**: 모든 연결 테스트 및 모델 조회
- **Embeddings**: 임베딩 모델 조회
- **GitHub 통합**: Release 정보 조회, OAuth 인증
- **모든 HTTP 통신**: 프록시 설정이 100% 정확하게 적용

### 프록시 설정 시나리오

#### 시나리오 1: 프록시 비활성화

```json
{ "proxy": { "enabled": false, "mode": "none" } }
```

- ✅ 환경 변수 HTTPS_PROXY 무시
- ✅ 프록시 없이 직접 연결

#### 시나리오 2: 시스템 프록시

```json
{ "proxy": { "enabled": true, "mode": "system" } }
```

- ✅ 환경 변수 (HTTPS_PROXY, HTTP_PROXY) 사용
- ✅ 자동 프록시 감지

#### 시나리오 3: 수동 프록시

```json
{ "proxy": { "enabled": true, "mode": "manual", "url": "http://proxy:8080" } }
```

- ✅ 지정된 프록시 URL 사용
- ✅ SSL 검증 설정 정확하게 적용

## 🔍 검증

### 정적 분석

- ✅ eslint: 통과
- ✅ TypeScript type-check: 통과
- ✅ Next.js build: 성공

### 자동 정규화 테스트

1. **잘못된 설정 자동 수정**:
   - 기존 DB: `{ enabled: true, mode: 'none' }`
   - 로드 후: `{ enabled: false, mode: 'none' }`
   - 로그: "Normalizing invalid config: enabled: true + mode: none → enabled: false"

2. **UI에서 잘못된 조합 생성 불가**:
   - 프록시 toggle ON → mode dropdown에서 'none' 선택 불가
   - 프록시 toggle OFF → mode 자동으로 'none' 설정

## 🎉 결론

v0.6.16은 **프록시 설정 안정성의 최종 완성판**입니다:

- ✅ UI에서 논리적으로 올바른 설정만 생성 가능
- ✅ 기존 잘못된 설정은 로드 시 자동 정규화
- ✅ 프록시 비활성화 설정이 환경 변수에 영향받지 않음
- ✅ 프록시 에러 발생 시 명확한 원인 파악 가능
- ✅ 빌드 안정성 향상 (browser-stub export 문제 해결)
- ✅ 기업 프록시 환경에서도 완벽한 동작
- ✅ 사용자 친화적인 에러 메시지

**v0.6.15 + v0.6.16 통합 개선사항**:

1. 프록시 비활성화 시 환경 변수 무시 처리 (이중 방어)
2. 프록시 환경에서 JSON 파싱 에러 감지 향상
3. UI에서 논리적 모순 방지
4. 자동 설정 정규화
5. 빌드 안정성 향상

---

**전체 변경사항**: [v0.6.15...v0.6.16](https://github.com/jhl-labs/sepilot_desktop/compare/v0.6.15...v0.6.16)
