# SEPilot Desktop v0.6.4-beta 릴리스 노트

## 주요 변경 사항

### 버그 수정 및 UX 개선

- **문서 다이얼로그 컴포넌트 통합 및 Monaco Editor 높이 개선**
  - **문제**: DocumentEditDialog와 DocumentUploadDialog가 중복된 코드를 가지고 있으며, Monaco Editor의 높이가 고정되어 편집 공간이 부족함
  - **해결**: 두 컴포넌트를 하나의 DocumentDialog로 통합
    - mode prop으로 'create' | 'edit' 구분
    - Monaco Editor를 공통으로 사용하여 코드 중복 제거
    - flex 레이아웃을 사용하여 Monaco Editor가 Dialog의 남은 공간을 모두 차지하도록 동적 높이 설정
    - AI 기능(정제, 번역, 확장, 축소 등)을 create 모드에서도 사용 가능
  - **효과**:
    - 코드 재사용성 및 유지보수성 향상
    - Monaco Editor 편집 공간 확보로 사용자 경험 개선
    - 컴포넌트 파일 수 감소 (3개 → 1개)
  - 코드 위치:
    - 통합 컴포넌트: `components/rag/DocumentDialog.tsx`
    - 사용처: `components/pages/DocumentsPage.tsx:418-432`

- **LLMStatusBar 설정 표시 수정**
  - **문제**: UnifiedChatInput에서 "모델 설정 필요" 메시지가 모델이 이미 설정되어 있는데도 표시됨
  - **원인**: llmConfig가 하드코딩된 null 값으로 LLMStatusBar에 전달됨
  - **해결**:
    - useConfigLoader 훅을 사용하여 실제 llmConfig 로드
    - 실제 설정 상태를 LLMStatusBar에 전달
  - **효과**:
    - 정확한 모델 설정 상태 표시
    - 사용자 혼란 방지
  - 코드 위치: `components/chat/unified/UnifiedChatInput.tsx`

- **Editor 기본 키보드 단축키 동작 복원**
  - **문제**: Editor에서 기본적인 키보드 단축키(Ctrl+C, Ctrl+X, Ctrl+V 등)가 동작하지 않음
  - **원인**: Markdown 파일 이미지 붙여넣기를 위한 Ctrl+V 핸들러가 Monaco의 `addCommand()`를 사용하여 모든 파일 타입에서 기본 키 바인딩을 덮어씀
  - **해결**:
    - Monaco command 시스템 대신 DOM paste 이벤트 리스너 사용
    - `editor.getDomNode().addEventListener('paste', handlePaste)` 방식으로 변경
    - Markdown 파일에서 클립보드에 이미지가 있을 때만 `preventDefault()` 호출
    - 그 외의 경우 모든 기본 동작 허용
    - `editor.hasTextFocus()` 체크로 에디터 포커스 확인
  - **효과**:
    - 모든 파일에서 표준 키보드 단축키 정상 동작
    - Markdown 이미지 붙여넣기 기능 유지
    - Monaco의 기본 키 바인딩 간섭 없음
  - 코드 위치: `components/editor/Editor.tsx:819-946`

### 인프라 개선

- **GitHub Actions 릴리스 워크플로우 안정성 개선**
  - **문제**: Windows 빌드 중 NSIS 다운로드 타임아웃으로 릴리스 실패
  - **해결**:
    - `nick-fields/retry-action@v3` 사용하여 빌드 자동 재시도 (최대 3회)
    - Windows 환경의 electron-builder 캐시 경로 수정
    - 타임아웃 30분으로 증가
    - 재시도 대기 시간 30초 설정
  - **효과**:
    - 일시적인 네트워크 문제로 인한 빌드 실패 방지
    - 릴리스 워크플로우 안정성 향상
  - 코드 위치: `.github/workflows/release.yml:79-91`

## 기술적 세부 사항

### 컴포넌트 통합 패턴

DocumentDialog는 mode prop을 통해 두 가지 모드를 지원합니다:

```typescript
interface DocumentDialogProps {
  mode: 'create' | 'edit';
  open: boolean;
  onOpenChange: (open: boolean) => void;
  document?: VectorDocument | null;
  onSave?: (doc: { id: string; content: string; metadata: Record<string, any> }) => Promise<void>;
  onUpload?: (
    documents: { content: string; metadata: Record<string, any> }[],
    chunkStrategy?: ChunkStrategy
  ) => Promise<void>;
}
```

### Monaco Editor 동적 높이

flex 레이아웃을 사용하여 Dialog의 남은 공간을 Monaco Editor가 모두 차지하도록 설정:

```typescript
<div className="flex-1 flex flex-col min-h-0">
  <div className="flex-1 border rounded-md overflow-hidden">
    <MonacoEditor height="100%" ... />
  </div>
</div>
```

### DOM 이벤트 리스너 패턴

Monaco의 command 시스템 대신 DOM 이벤트 리스너를 사용하여 기본 키보드 단축키와 충돌하지 않도록 구현:

```typescript
const handlePaste = async (e: ClipboardEvent) => {
  // Markdown 파일이고 이미지가 있을 때만 커스텀 처리
  if (isMarkdown && hasImage) {
    e.preventDefault();
    e.stopPropagation();
    // 이미지 삽입 로직
  }
  // 그 외에는 기본 동작 허용
};

editor.getDomNode().addEventListener('paste', handlePaste);
```

## 영향 범위

- **DocumentDialog (신규)**: 문서 업로드 및 편집 통합 컴포넌트
- **DocumentsPage (개선)**: DocumentDialog 사용으로 간소화
- **UnifiedChatInput (수정)**: 실제 llmConfig 로드 및 전달
- **Editor (수정)**: DOM 이벤트 리스너 기반 paste 처리
- **GitHub Actions (개선)**: 릴리스 워크플로우 재시도 로직 추가

## 업그레이드 참고사항

이번 릴리스는 기존 데이터나 설정과 호환됩니다. 별도의 마이그레이션이 필요하지 않습니다.
