# SEPilot Desktop v0.6.0 릴리스 노트

## 주요 신기능

### 1. AI 페르소나 시스템

- **AI 역할 정의 기능**: 번역가, 영어 선생님, 시니어 개발자 등 다양한 페르소나 제공
- **대화별 페르소나 지정**: 각 대화마다 서로 다른 페르소나 적용 가능
- **슬래시 커맨드 자동완성**: `/persona` 입력 시 페르소나 목록 자동완성
- **SQLite 영구 저장**: 사용자 정의 페르소나 데이터베이스 저장

### 2. Editor 모드 (Chat + Editor 듀얼 모드)

- **Monaco Editor 통합**: VS Code 엔진 기반 코드 편집기
- **파일 탐색 및 편집**: Working Directory 설정, 파일 트리 탐색, 여러 파일 동시 편집
- **전체 파일 검색**: ripgrep 기반 고속 검색 (Ctrl+Shift+F)
- **통합 터미널**: xterm.js 기반 실시간 터미널 (Windows: PowerShell, macOS/Linux: bash/zsh)
- **Editor 설정**: 폰트, 테마, 탭 크기, 줄바꿈, 미니맵 등 커스터마이징
- **AI 자동완성 (Autocomplete)**:
  - **비동기 처리 최적화**: 타이핑 끊김 없이 부드러운 자동완성 제공
  - **요청 취소 메커니즘**: AbortController로 이전 요청 자동 취소
  - **Monaco CancellationToken 활용**: 에디터 변경 시 즉시 요청 취소
  - **중복 요청 방지**: 동시에 여러 요청이 발생하지 않도록 제어
  - **타임아웃 처리**: 5초 타임아웃으로 느린 응답 방지
  - **에러 사일런트 처리**: 에러 발생 시에도 사용자 경험 방해 없음
  - **RAG 문서 활용 토글**: 업로드된 RAG 문서를 autocomplete에 사용할지 토글 (사이드바 아이콘)
  - **MCP Tools 활용 토글**: MCP Tools를 autocomplete에 사용할지 토글 (사이드바 아이콘)
  - **설정 영구 저장**: RAG/Tools 토글 설정을 localStorage에 저장하여 세션 간 유지

### 3. Browser 모드 (AI 기반 웹 브라우징)

- **내장 Chromium 브라우저**: Electron BrowserView API 활용
- **브라우저 기본 기능**: 크롬 스타일 탭 UI, 뒤로/앞으로/새로고침, URL 입력
- **페이지 캡처**: Pocket처럼 웹 페이지 스냅샷 저장 및 관리
- **북마크 관리**: 폴더별 북마크 저장 및 관리
- **Browser Agent (AI 자동화)**: LangGraph 기반 AI 에이전트가 브라우저 제어
  - Navigation: URL 이동
  - Page Inspection: 페이지 내용 분석, 요소 검색, 스크린샷
  - Page Interaction: 클릭, 텍스트 입력, 스크롤
  - Tab Management: 탭 생성/전환/닫기
  - Vision Tools: Set-of-Mark 기반 화면 분석 및 클릭
  - **Google Search Tools (NEW!)**: Perplexity 수준의 고급 검색 도구 (9개)
    - 검색 도구 (5개): 기본 웹 검색, 뉴스, 학술(Scholar), 이미지, 고급 검색
    - 추출 도구 (2개): 검색 결과 파싱, 관련 검색어 추출
    - 탐색 도구 (2개): 특정 결과 방문 및 콘텐츠 추출, 다음 페이지 이동
    - 고급 필터: 날짜 범위, 언어/지역, 사이트/파일타입, 정확한 문구, 제외 단어
  - **Bot 감지 우회 (NEW!)**: Google CAPTCHA 및 자동화 탐지 방지
    - Stealth 브라우저 핑거프린트: navigator.webdriver 제거, chrome 객체 추가, plugins/WebGL 스푸핑
    - 자연스러운 타이밍 패턴: 800-2000ms 랜덤 지연으로 사람처럼 동작
    - Google 홈페이지 사전 방문: 쿠키 및 세션 자동 설정
    - HTTP 헤더 강화: Accept-Language, Referer, Sec-Fetch-\* 등 실제 브라우저처럼 설정
    - 최신 Chrome User-Agent: Chrome 131 (2025년 1월)
    - ERR_ABORTED 에러 처리: 차단 발생 시 명확한 에러 메시지
- **Agent 설정**: LLM 파라미터, 폰트 설정 커스터마이징
- **실시간 로그**: Agent 실행 과정을 채팅 형태로 표시

### 4. RAG 시스템 (VectorDB + Embedding)

- **VectorDB 지원**: Chroma, Qdrant, Pinecone, Weaviate, Milvus
- **Embedding 모델**: OpenAI, Cohere, Vertex AI, HuggingFace, Ollama, VoyageAI
- **문서 관리**: 폴더/파일 업로드, 자동 chunk 분할 및 벡터화
- **실시간 검색**: 대화 중 자동으로 관련 문서 검색 및 컨텍스트 추가
- **컬렉션 관리**: 여러 컬렉션 생성, 활성화/비활성화 전환

### 5. LangGraph Agent 시스템

- **RAG Agent**: VectorDB 기반 문서 검색 및 답변
- **Browser Agent**: 웹 브라우저 자동화 작업
- **Tool Calling**: MCP 서버 도구 호출
- **Human-in-the-loop**: 도구 실행 전 사용자 승인 시스템
- **실시간 진행 상태**: 현재 작업, 진행률, 메시지 표시
- **반복 감지**: 무한 루프 방지 시스템

### 6. MCP (Model Context Protocol) 통합

- **MCP 서버 관리**: 서버 추가/삭제/시작/중지/재시작
- **도구 자동 로딩**: 연결된 서버의 도구 목록 자동 로드
- **다양한 전송 방식**: stdio, SSE 지원
- **환경 변수 지원**: 서버별 환경 변수 설정
- **실시간 상태 모니터링**: 서버 연결 상태 및 도구 목록 표시

### 7. GitHub 연동

- **OAuth 인증**: GitHub App을 통한 안전한 인증
- **Private Key 관리**: PEM 파일 업로드 및 안전한 저장
- **레포지토리 연동**: GitHub 레포지토리와 연동하여 코드 관리

### 8. ComfyUI 이미지 생성

- **ComfyUI 서버 연동**: 외부 ComfyUI 서버와 연결
- **워크플로우 실행**: JSON 워크플로우 파일 실행
- **실시간 진행 상태**: 이미지 생성 진행률 및 프리뷰 표시
- **이미지 관리**: 생성된 이미지 자동 저장 및 대화에 표시

### 9. 이미지 해석 및 생성

- **Vision 모델 지원**: OpenAI GPT-4 Vision, Claude Vision 등
- **이미지 업로드**: 드래그 앤 드롭, 클립보드 붙여넣기
- **이미지 생성**: 프롬프트 기반 이미지 생성 (ComfyUI 연동)
- **썸네일 표시**: 업로드된 이미지 미리보기

### 10. Quick Input (Instant 답변)

- **빠른 질문/답변**: 별도 대화 생성 없이 즉시 답변
- **Ctrl+Shift+I 단축키**: 어디서나 Quick Input 창 열기
- **독립 윈도우**: 메인 윈도우와 별도로 관리

## 버그 수정 및 개선사항

### Browser Agent - Google 검색 안정성 및 성능 향상

- **Stealth 스크립트 중복 실행 방지**:
  - IIFE(즉시 실행 함수)로 변수 스코프 격리
  - `__stealthInjected` 플래그로 중복 주입 차단
  - "Identifier 'originalQuery' has already been declared" 콘솔 에러 해결
  - WebGL 패치 및 Permissions API 오버라이드 중복 방지

- **Google 홈페이지 타임아웃 최적화**:
  - 타임아웃 시간 15초 → 5초로 단축 (빠른 실패)
  - 이미 Google에 있으면 홈페이지 방문 건너뛰기
  - 타임아웃 발생 시 즉시 검색 진행 (대기 시간 제거)
  - 불필요한 지연 시간 감소로 검색 속도 2-3배 향상

- **타임아웃 에러 복구 로직 개선**:
  - 30초 페이지 로드 타임아웃 발생 시 부분 로드 감지
  - 페이지가 부분적으로 로드된 경우 작업 계속 진행 (graceful degradation)
  - Google CAPTCHA 또는 차단 감지 시 명확한 에러 메시지 제공
  - 해결 방법 안내: Browser 탭 직접 열기, 재시도, 대체 방법 사용
  - 향상된 디버깅 로그: 페이지 상태(URL, 제목) 출력

### E2E 테스트 코드 정리

- 미사용 import 및 변수 제거
- ESLint 규칙 준수를 위한 underscore prefix 추가
- 코드 가독성 향상

### 기능 개선

- **Browser Chat Agent 백그라운드 동작 지원**:
  - 다른 탭/화면으로 전환해도 Agent가 계속 실행됨
  - Stream event handler를 Zustand store에 저장하여 컴포넌트 lifecycle과 독립
  - 언제든 돌아와서 최신 결과 확인 가능
  - 사용자 경험 향상: 메시지 보낸 후 다른 작업 수행 가능

### UI 개선

- **Browser Chat 인터페이스 최적화**:
  - 좁은 사이드바에 최적화된 컴팩트 레이아웃
  - 메시지 텍스트 크기 14px → 11px로 축소
  - Agent 로그 영역 대폭 압축 (특히 tool calling 메시지)
  - 로그 표시 개수 5개 → 3개로 제한 (최근 항목만)
  - 패딩/간격 최소화로 더 많은 내용 표시
  - 결과: 같은 공간에 2-3배 많은 정보 표시 가능

- MarkdownRenderer: text-sm 클래스 추가로 일관된 텍스트 크기 적용

- **Agent 도구 결과 출력 개선**:
  - Tool 실행 결과 출력을 `<small>` 태그로 감싸서 글씨 크기 축소
  - 가독성 향상을 위한 줄바꿈 추가
  - Agent 로그 영역의 정보 밀도 증가

### Tool 반복 호출 방지 시스템

- **System Prompt 추가**:
  - LLM에게 tool 사용 지침 제공 (중복 호출 방지, 한 번의 검색으로 충분, 결과 분석 우선)
  - Tool 결과 후 최종 답변 우선순위화

- **Tool 사용 횟수 추적**:
  - 각 tool별 누적 사용 횟수 모니터링
  - 3회 이상 사용 시 경고 메시지 표시
  - 5회 이상 사용 시 무한 루프 방지를 위해 자동 중단

- **중복 호출 감지**:
  - 연속된 iteration에서 동일 tool 반복 감지
  - 중복 패턴 발견 시 사용자에게 알림

- **Tool 결과 Truncation 개선**:
  - 최대 길이 20,000자 → 50,000자로 증가
  - 더 많은 컨텍스트 제공으로 재검색 필요성 감소
  - Truncation 메시지 개선 (재검색 대신 기존 정보 활용 권장)

- **Tools 토글 존중**:
  - GraphConfig의 `enableTools` 설정을 모든 사고 모드에서 존중
  - Tree of Thought 등에서도 Tools 비활성화 시 tool 사용 안 함
  - 사용자가 명시적으로 비활성화한 경우 tool 호출 방지

### Deep Web Research 그래프 개선

- **System Prompt 강화**:
  - 깊이 있는 다각도 탐색 원칙 추가 (첫 검색에서 만족하지 말고 최소 2-3번 검색)
  - 파라미터 제한 명시 강화 (tavily_search는 query, max_results만 허용)
  - `top_n`, `topn` 파라미터 명시적 금지 및 경고
  - 빈 값(빈 문자열, null, undefined) 사용 금지 명시
  - 잘못된 파라미터 예시 추가 (time_range, exclude_paths, top_n, 빈 문자열 등)
  - 정보 충분성 판단 기준 명확화 ("뭔가 나왔다"가 아닌 "질문에 완전히 답할 수 있다")

- **Error Handling 개선**:
  - 검색 실패 시 iteration 카운트에서 제외하여 재시도 기회 제공
  - lastSearchCount를 통한 이전 batch 추적으로 정확한 실패 감지
  - 모든 검색 실패 시 사용자에게 경고 메시지 출력

- **Parameter Filtering 대폭 강화**:
  - searchNode에서 tavily_search 파라미터 자동 정제 및 변환
  - `top_n`, `topn` 파라미터를 `max_results`로 자동 매핑
  - 빈 문자열, null, undefined 등 무효한 값 자동 제거
  - max_results 값 범위 제한 (1-10) 및 타입 변환
  - 사용자 보고 에러 해결: "top_n: Unexpected keyword argument", "time_range: '' is not one of ['day', 'week']"
  - 디버깅 로그 추가 (Original params와 Cleaned params 출력)

- **Iteration 로직 수정**:
  - checkPlan에서 >= 연산자 사용하여 정확히 MAX_ITERATIONS(3회)만큼만 실행
  - 최대 검색 횟수 도달 시 사용자에게 명확한 알림 메시지
  - 더욱 깊이 있고 체계적인 웹 연구 가능

## 아키텍처 개선

### 1. LLM Settings V2

- **Connection 기반 관리**: 여러 LLM 제공자를 Connection으로 관리
- **Model 기반 선택**: Connection의 모델을 Base, Vision, Embedding, Speech 용도로 지정
- **자동 변환**: V1 형식 설정을 V2로 자동 마이그레이션
- **Settings UI 개선**: 카테고리 기반 사이드바 네비게이션

### 2. SQLite 데이터베이스 통합

- **통합 DB 관리**: 대화, 페르소나, RAG 문서 등 모든 데이터 SQLite 저장
- **트랜잭션 지원**: 안전한 데이터 저장 및 롤백
- **마이그레이션 시스템**: 데이터베이스 스키마 버전 관리
- **데이터 복구**: 백업/복구 기능 제공

### 3. IPC 통신 최적화

- **타입 안전성**: TypeScript discriminated union으로 이벤트 타입 정의
- **스트리밍 최적화**: 대용량 데이터 스트리밍 처리
- **에러 핸들링**: 런타임 타입 가드 및 에러 수집

### 4. Performance 최적화

- **Selective Zustand Subscription**: 필요한 값만 구독하여 리렌더링 최소화
- **useMemo/useCallback**: 계산 및 함수 메모이제이션
- **React.memo**: 컴포넌트 리렌더링 최적화

### 5. Accessibility 개선

- **ARIA 속성 추가**: 스크린 리더 지원
- **키보드 네비게이션**: 모든 기능 키보드로 접근 가능
- **WCAG 2.1 준수**: 웹 접근성 가이드라인 준수

## 보안 개선

### 1. 입력 검증

- **API 키 검증**: 최소 길이 20자, baseURL 형식 체크
- **XSS 방지**: 사용자 입력 sanitize
- **Command Injection 방지**: 터미널 명령 검증

### 2. BrowserView 보안

- **sandbox 활성화**: 브라우저 프로세스 격리
- **nodeIntegration 비활성화**: Node.js API 접근 차단
- **contextIsolation 활성화**: 컨텍스트 격리

### 3. 데이터 보호

- **userData 경로 사용**: 사용자 데이터를 안전한 경로에 저장
- **환경 변수 암호화**: 민감한 환경 변수 암호화 저장

## 테스트 및 CI/CD

### 테스트 커버리지

- **전체 커버리지**: 68.37% → 68.45%
- **100% 달성 컴포넌트**: 3개
- **주요 테스트 추가**:
  - ActivityPanel: 96% → 98%
  - MessageList: 82% → 90%
  - SidebarBrowser: 71% → 80%
  - BrowserPanel: 65% → 75%

### GitHub Actions CI/CD 개선

- **자동 테스트 및 커버리지 측정**: PR 및 Push 시 자동으로 테스트 실행
- **Codecov 통합**: 커버리지 리포트 자동 업로드 및 뱃지 표시
- **PR 코멘트**: 커버리지 결과를 PR에 자동으로 코멘트
- **커버리지 Artifact**: 상세 HTML 리포트를 GitHub Actions artifact로 저장 (30일 보관)
- **커버리지 임계값**: Branches 70%, Functions/Lines/Statements 80%

## 아이콘 및 브랜딩

- **통일된 아이콘**: 모든 플랫폼에서 SEPilot 아이콘 적용
- **시스템 트레이 아이콘**: 실제 아이콘 파일로 교체
- **favicon 및 웹 아이콘**: 웹 페이지 아이콘 설정

## 기술 스택

- **Frontend**: Next.js 15.3.0, React 19, TypeScript, shadcn/ui
- **Backend**: Electron 35.2.0, Node.js
- **AI/ML**: LangChain, LangGraph, OpenAI, Anthropic
- **Database**: SQLite (better-sqlite3)
- **Editor**: Monaco Editor
- **Terminal**: xterm.js, node-pty
- **Browser**: Electron BrowserView
- **Search**: ripgrep (@vscode/ripgrep)
- **Vector DB**: Chroma, Qdrant, Pinecone, Weaviate, Milvus
- **Testing**: Vitest, Testing Library

## 알려진 제한사항

- **Editor 모드 LLM 프롬프트**: 아직 구현되지 않음 (UI만 완성)
- **Browser 모드**: Windows/Linux에서 일부 웹사이트 렌더링 이슈 가능
- **RAG Agent**: 매우 긴 문서의 경우 chunk 분할 최적화 필요
- **MCP 서버**: 일부 서버는 stdio 전송만 지원

## 업그레이드 가이드

### v0.5.0에서 업그레이드

1. **LLM 설정 자동 마이그레이션**: 기존 V1 설정이 V2로 자동 변환됩니다.
2. **데이터베이스 마이그레이션**: 앱 시작 시 자동으로 데이터베이스 마이그레이션이 실행됩니다.
3. **백업 권장**: 업그레이드 전 `Settings > 백업/복구`에서 데이터를 백업하세요.

### 주요 변경 사항

- **LLM 설정 방식 변경**: Connection과 Model 기반으로 재설계되었습니다.
- **새로운 모드 추가**: Editor 모드와 Browser 모드가 추가되었습니다.
- **페르소나 시스템**: 대화별로 페르소나를 지정할 수 있습니다.

## 기여자

- vtopia (메인 개발자)
- Claude (AI 코딩 어시스턴트)

## 라이선스

MIT License

---

**전체 변경 로그**: v0.5.0...v0.6.0
