# SEPilot Desktop v0.7.4 ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸

**ë¦´ë¦¬ì¦ˆ ë‚ ì§œ**: 2026-01-07

---

## ğŸ› ì¤‘ìš”í•œ ë²„ê·¸ ìˆ˜ì •

### ğŸš¨ MCP ë„êµ¬ í˜¸ì¶œ ì‹œ í™˜ê° ë°ì´í„° ë¬¸ì œ í•´ê²°

MCP(Model Context Protocol)ë¥¼ í†µí•œ ë„êµ¬ í˜¸ì¶œ ì‹œ LLMì´ ê°€ì§œ/í™˜ê° ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ì‹¬ê°í•œ ë¬¸ì œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

**ë°œê²¬ëœ ë¬¸ì œ:**

1. **`isError` í”Œë˜ê·¸ ë¬´ì‹œ**: MCP ë„êµ¬ê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•´ë„ (`isError: true`) ì´ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  ì •ìƒ ê²°ê³¼ì²˜ëŸ¼ LLMì—ê²Œ ì „ë‹¬
2. **ë¹ˆ ê²°ê³¼ë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ëŒ€ì²´**: "Tool returned no result", "Tool returned empty content" ê°™ì€ ì˜ë¯¸ ì—†ëŠ” ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ì—¬ LLMì´ ì‹¤ì œ ë°ì´í„°ë¡œ ì°©ê°
3. **ì—ëŸ¬ ì²˜ë¦¬ ì§€ì¹¨ ë¶€ì¡±**: ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— ë„êµ¬ ì‹¤íŒ¨ ì‹œ í™˜ê°í•˜ì§€ ë§ë¼ëŠ” ëª…í™•í•œ ì§€ì¹¨ì´ ì—†ì—ˆìŒ
4. **ê²°ê³¼ ê²€ì¦ ë¶€ì¬**: MCP ì‘ë‹µì˜ êµ¬ì¡°ë‚˜ ë‚´ìš©ì„ ê²€ì¦í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ LLMì—ê²Œ ì „ë‹¬

**ìˆ˜ì • ë‚´ìš©:**

#### 1. MCP ë„êµ¬ ì‘ë‹µ ê²€ì¦ ê°•í™” (`lib/langgraph/nodes/tools.ts`)

```typescript
// âš ï¸ CRITICAL: Check isError flag first to prevent hallucinations
if (mcpResult?.isError) {
  // MCP ë„êµ¬ê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•œ ê²½ìš° - ëª…í™•í•˜ê²Œ ì—ëŸ¬ë¡œ í‘œì‹œ
  const errorText =
    mcpResult.content
      ?.map((item: any) => item.text || '')
      .filter((text: string) => text)
      .join('\n') || 'Tool execution failed with unknown error';

  console.error(`[Tools] MCP tool returned error for ${call.name}:`, errorText);

  return {
    toolCallId: call.id,
    toolName: call.name,
    result: null,
    error: `Tool '${call.name}' failed: ${errorText}`,
  };
}
```

**ì£¼ìš” ê°œì„ ì‚¬í•­:**

- âœ… `isError` í”Œë˜ê·¸ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ í™•ì¸
- âœ… ì—ëŸ¬ ì‘ë‹µì„ `error` í•„ë“œì— ëª…í™•í•˜ê²Œ í‘œì‹œ
- âœ… null/undefined ì‘ë‹µ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
- âœ… ë¹ˆ content ë°°ì—´ ê°ì§€ ë° ì—ëŸ¬ ì²˜ë¦¬
- âœ… ë¹ˆ í…ìŠ¤íŠ¸ ê²°ê³¼ ê²€ì¦ ì¶”ê°€

#### 2. LLM ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ê°œì„  (`lib/langgraph/nodes/generate.ts`)

**ì¶”ê°€ëœ ì—ëŸ¬ ì²˜ë¦¬ ì§€ì¹¨:**

```markdown
## Critical: Handling Tool Errors

**âš ï¸ NEVER HALLUCINATE OR FABRICATE DATA WHEN A TOOL FAILS**

When you receive a tool error (marked with "Error:" in the result):

1. **Acknowledge the Error**: Tell the user that the tool operation failed
2. **Explain What Happened**: Clearly state which tool failed and why
3. **DO NOT Make Up Data**: Never invent, guess, or fabricate information
4. **Suggest Alternatives**: If possible, suggest alternative approaches
5. **Be Honest**: If you cannot complete the task without the tool, clearly state that

**Example of CORRECT error handling:**
âŒ BAD: "I searched GitHub and found these repositories..." (when the search actually failed)
âœ… GOOD: "The GitHub search tool failed with error: [error message]. I cannot provide search results without access to the GitHub API."

**Remember**: It's better to admit a tool failed than to provide false information.
```

**íš¨ê³¼:**

- âœ… LLMì—ê²Œ ë„êµ¬ ì‹¤íŒ¨ ì‹œ í™˜ê°í•˜ì§€ ë§ ê²ƒì„ ëª…í™•íˆ ì§€ì‹œ
- âœ… ì˜¬ë°”ë¥¸ ì—ëŸ¬ ì²˜ë¦¬ ì˜ˆì‹œ ì œê³µ
- âœ… ê±°ì§“ ì •ë³´ë³´ë‹¤ ì†”ì§í•œ ì‹¤íŒ¨ ì¸ì •ì„ ìš°ì„ í•˜ë„ë¡ êµìœ¡

---

## ğŸ”§ ê¸°ìˆ ì  ê°œì„ 

### ì½”ë“œ í’ˆì§ˆ: Extension Chat ì»´í¬ë„ŒíŠ¸ ë¦¬íŒ©í† ë§

Extension(Browser, Editor)ì˜ Chat ì»´í¬ë„ŒíŠ¸ë“¤ì—ì„œ ì¤‘ë³µëœ ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ì„ **Custom Hook**ìœ¼ë¡œ ì¶”ì¶œí•˜ì—¬ ì½”ë“œ ì¤‘ë³µì„ ì œê±°í•˜ê³  ìœ ì§€ë³´ìˆ˜ì„±ì„ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.

**ë¬¸ì œì :**

- `BrowserChatContainer`, `SimpleChatInput`, `EditorChatContainer`ì—ì„œ ë™ì¼í•œ LangGraph ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ ì¤‘ë³µ (~400 ë¼ì¸)
- ìŠ¤íŠ¸ë¦¬ë° ì´ë²¤íŠ¸ ì²˜ë¦¬, ë©”ì‹œì§€ ì—…ë°ì´íŠ¸, ì—ëŸ¬ ì²˜ë¦¬, Cleanup ë¡œì§ì´ ëª¨ë‘ ì¤‘ë³µ
- Tool Approval ë¡œì§ë„ ì—¬ëŸ¬ ê³³ì— ì¤‘ë³µ êµ¬í˜„
- ì½”ë“œ ìˆ˜ì • ì‹œ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ë™ì‹œì— ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´

**í•´ê²° ë°©ë²•:**

#### 1. `useLangGraphStream` Hook ìƒì„± (`lib/hooks/useLangGraphStream.ts`)

ê³µí†µ ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ì„ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ Hookìœ¼ë¡œ ì¶”ì¶œ:

```typescript
export function useLangGraphStream(options: UseLangGraphStreamOptions) {
  // ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ í•¨ìˆ˜
  const startStream = async (userMessage: string, thinkingMode: ...) => {
    // LangGraph ìŠ¤íŠ¸ë¦¬ë° ì„¤ì •
    // ì´ë²¤íŠ¸ ì²˜ë¦¬ (progress, streaming, node)
    // Tool Approval ì²˜ë¦¬ (Editor Agent)
    // WebLLM Fallback
  };

  // ìŠ¤íŠ¸ë¦¬ë° ì¤‘ë‹¨ í•¨ìˆ˜
  const stopStream = async () => {
    // Agent ì¤‘ë‹¨
    // AbortController cleanup
  };

  return { startStream, stopStream };
}
```

**ì£¼ìš” ê¸°ëŠ¥:**

- âœ… LangGraph ìŠ¤íŠ¸ë¦¬ë° ì„¤ì • ë° ì´ë²¤íŠ¸ ì²˜ë¦¬
- âœ… ì§„í–‰ë¥  ì¶”ì  (`progress` ì´ë²¤íŠ¸)
- âœ… ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ (`streaming` ì´ë²¤íŠ¸)
- âœ… ë…¸ë“œ ì‹¤í–‰ ê²°ê³¼ ì²˜ë¦¬ (`node` ì´ë²¤íŠ¸)
- âœ… Tool Approval ì²˜ë¦¬ (Editor Agentìš©)
  - `tool_approval_request` ì´ë²¤íŠ¸
  - `tool_approval_result` ì´ë²¤íŠ¸
  - ì„¸ì…˜ ì „ì²´ ìë™ ìŠ¹ì¸ ì§€ì›
- âœ… WebLLM Fallback (ë¹„-Electron í™˜ê²½)
- âœ… ì—ëŸ¬ ì²˜ë¦¬ ë° Cleanup

#### 2. ì»´í¬ë„ŒíŠ¸ ë¦¬íŒ©í† ë§

**BrowserChatContainer ë¦¬íŒ©í† ë§:**

```typescript
// Before: ~200 lines of streaming logic
const handleSendMessage = async (userMessage: string) => {
  // Setup graphConfig
  // Setup allMessages
  // Setup eventHandler with 100+ lines
  // Start streaming
  // Handle errors
  // Cleanup
};

// After: ~40 lines using Hook
const { startStream, stopStream } = useLangGraphStream({
  mode: 'browser',
  conversationId: 'browser-chat-temp',
  getMessages: () => useChatStore.getState().browserChatMessages,
  updateMessage: updateBrowserChatMessage,
  onAgentProgress: setAgentProgress,
});

const handleSendMessage = async (userMessage: string) => {
  addBrowserChatMessage({ role: 'user', content: userMessage });
  addBrowserChatMessage({ role: 'assistant', content: '' });
  await startStream(userMessage, 'browser-agent');
};
```

**SimpleChatInput ë¦¬íŒ©í† ë§:**

- 135ì¤„ â†’ 40ì¤„ (95ì¤„ ê°ì†Œ)
- `abortControllerRef` ì œê±° (Hook ë‚´ë¶€ì—ì„œ ê´€ë¦¬)
- ì¤‘ë³µ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê±°

**EditorChatContainer ë¦¬íŒ©í† ë§:**

- Tool Approval ì½œë°± ì—°ê²°
- ë¶ˆí•„ìš”í•œ import ì œê±° (`isElectron`, `getWebLLMClient`)
- Hookì„ í†µí•œ í†µí•© ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬

#### 3. ì½”ë“œ í’ˆì§ˆ ê°œì„ 

**ì œê±°ëœ ì¤‘ë³µ ì½”ë“œ:**

- ìŠ¤íŠ¸ë¦¬ë° ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§: ~150ì¤„ Ã— 3ê°œ ì»´í¬ë„ŒíŠ¸ = 450ì¤„
- Abort ì²˜ë¦¬: ~20ì¤„ Ã— 3ê°œ = 60ì¤„
- WebLLM Fallback: ~50ì¤„ Ã— 3ê°œ = 150ì¤„
- **ì´ ì•½ 660ì¤„ ì´ìƒì˜ ì¤‘ë³µ ì½”ë“œ ì œê±°**

**ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ:**

- âœ… ë‹¨ì¼ ì†ŒìŠ¤: Hook í•˜ë‚˜ë§Œ ìˆ˜ì •í•˜ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— ë°˜ì˜
- âœ… íƒ€ì… ì•ˆì „ì„±: TypeScript ì¸í„°í˜ì´ìŠ¤ë¡œ ì˜µì…˜ ì •ì˜
- âœ… í…ŒìŠ¤íŠ¸ ìš©ì´ì„±: Hook ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- âœ… í™•ì¥ì„±: ìƒˆë¡œìš´ Extension ì¶”ê°€ ì‹œ Hook ì¬ì‚¬ìš©

**ì¼ê´€ì„± ë³´ì¥:**

- âœ… ëª¨ë“  Extensionì—ì„œ ë™ì¼í•œ ìŠ¤íŠ¸ë¦¬ë° ë™ì‘
- âœ… ë™ì¼í•œ ì—ëŸ¬ ì²˜ë¦¬
- âœ… ë™ì¼í•œ Cleanup ë¡œì§

#### 4. ì˜í–¥ë°›ëŠ” íŒŒì¼

**ì‹ ê·œ ìƒì„±:**

- `lib/hooks/useLangGraphStream.ts` (380 lines)

**ìˆ˜ì •:**

- `extensions/browser/components/BrowserChatContainer.tsx` (-160 lines)
- `extensions/browser/components/SimpleChatInput.tsx` (-95 lines)
- `extensions/editor/components/EditorChatContainer.tsx` (-200 lines)

**ìˆœ ë³€ê²½:**

- ì¶”ê°€: +380 lines (Hook)
- ì œê±°: -455 lines (ì¤‘ë³µ ì½”ë“œ)
- **ìˆœ ê°ì†Œ: -75 lines**
- **ì‹¤ì§ˆì  ì¤‘ë³µ ì œê±°: ~600+ lines**

#### 5. ë¦¬íŒ©í† ë§ ì›ì¹™ ì¤€ìˆ˜

ì´ ë¦¬íŒ©í† ë§ì€ CLAUDE.mdì— ëª…ì‹œëœ í”„ë¡œì íŠ¸ ì›ì¹™ì„ ë”°ë¦…ë‹ˆë‹¤:

- âœ… **DRY (Don't Repeat Yourself)**: ì¤‘ë³µ ì½”ë“œë¥¼ Hookìœ¼ë¡œ ì¶”ì¶œ
- âœ… **ì¬ì‚¬ìš©ì„±**: ëª¨ë“  Extensionì—ì„œ Hook ì¬ì‚¬ìš©
- âœ… **ì»´í¬ë„ŒíŠ¸ ì„¤ê³„**: ì‘ê³  ì¬ì‚¬ìš© ê°€ëŠ¥í•œ Hook êµ¬ì„±
- âœ… **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ UI ë¶„ë¦¬**: ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ì„ Hookìœ¼ë¡œ ë¶„ë¦¬

---

## ğŸ”§ ê¸°ìˆ ì  ê°œì„ 

### MCP ì—ëŸ¬ ì²˜ë¦¬ íë¦„

**ì´ì „ (ë¬¸ì œê°€ ìˆë˜ íë¦„):**

```
MCP ë„êµ¬ í˜¸ì¶œ â†’ ì—ëŸ¬ ë°œìƒ â†’ isError í”Œë˜ê·¸ ë¬´ì‹œ â†’ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì „ë‹¬
â†’ LLMì´ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì‹¤ì œ ë°ì´í„°ë¡œ ì°©ê° â†’ í™˜ê° ë°ì´í„° ìƒì„±
```

**í˜„ì¬ (ìˆ˜ì •ëœ íë¦„):**

```
MCP ë„êµ¬ í˜¸ì¶œ â†’ ì—ëŸ¬ ë°œìƒ â†’ isError í”Œë˜ê·¸ í™•ì¸ â†’ error í•„ë“œì— ëª…í™•íˆ í‘œì‹œ
â†’ LLMì´ ì—ëŸ¬ì„ì„ ì¸ì‹ â†’ ì‚¬ìš©ìì—ê²Œ ì†”ì§í•˜ê²Œ ì‹¤íŒ¨ ì•Œë¦¼
```

### ì¶”ê°€ëœ ê²€ì¦ ë‹¨ê³„

1. **isError í”Œë˜ê·¸ ê²€ì¦**: ìµœìš°ì„  í™•ì¸
2. **null/undefined ê²€ì¦**: ì‘ë‹µì´ ì—†ëŠ” ê²½ìš° ëª…í™•í•œ ì—ëŸ¬
3. **ë¹ˆ content ë°°ì—´ ê²€ì¦**: ë‚´ìš©ì´ ì—†ëŠ” ì‘ë‹µ ê°ì§€
4. **ë¹ˆ í…ìŠ¤íŠ¸ ê²€ì¦**: ê³µë°±ë§Œ ìˆëŠ” ê²°ê³¼ í•„í„°ë§
5. **ì—ëŸ¬ ë¡œê¹…**: ëª¨ë“  ì—ëŸ¬ ìƒí™©ì„ ì½˜ì†”ì— ê¸°ë¡

---

## ğŸ“Š ì˜í–¥ ë²”ìœ„

**ê°œì„ ëœ MCP ë„êµ¬:**

- GitHub API ë„êµ¬ (search_repositories, get_file_contents ë“±)
- ì›¹ ê²€ìƒ‰ ë„êµ¬ (tavily_search ë“±)
- íŒŒì¼ ì‹œìŠ¤í…œ ë„êµ¬
- ë¸Œë¼ìš°ì € ì œì–´ ë„êµ¬
- ê¸°íƒ€ ëª¨ë“  MCP ê¸°ë°˜ ì™¸ë¶€ ë„êµ¬

**ì‚¬ìš©ì ê²½í—˜ ê°œì„ :**

- âœ… ë” ì´ìƒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì €ì¥ì†Œë‚˜ íŒŒì¼ì— ëŒ€í•œ ê°€ì§œ ì •ë³´ë¥¼ ë°›ì§€ ì•ŠìŒ
- âœ… ë„êµ¬ ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ìˆ˜ì‹ 
- âœ… LLMì´ ì‹¤íŒ¨ë¥¼ ì†”ì§í•˜ê²Œ ì¸ì •í•˜ê³  ëŒ€ì•ˆ ì œì‹œ
- âœ… ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ë§Œ ì œê³µë°›ìŒ

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê¶Œì¥ì‚¬í•­

ìˆ˜ì •ëœ ì½”ë“œë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤:

1. **ì¡´ì¬í•˜ì§€ ì•ŠëŠ” GitHub ì €ì¥ì†Œ ê²€ìƒ‰**: ì´ì „ì—ëŠ” ê°€ì§œ ì €ì¥ì†Œ ì •ë³´ë¥¼ ìƒì„±í–ˆìœ¼ë‚˜, ì´ì œëŠ” "ê²€ìƒ‰ ì‹¤íŒ¨" ë©”ì‹œì§€ë¥¼ ëª…í™•íˆ í‘œì‹œ
2. **ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤**: MCP ì„œë²„ ì—°ê²° ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
3. **ë¹ˆ ê²°ê³¼ ë°˜í™˜**: ë„êµ¬ê°€ ë¹ˆ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ë•Œ í™˜ê° ëŒ€ì‹  ì†”ì§í•œ ì‹¤íŒ¨ ì¸ì •
4. **íƒ€ì„ì•„ì›ƒ ì‹œë‚˜ë¦¬ì˜¤**: ë„êµ¬ í˜¸ì¶œì´ ì‹œê°„ ì´ˆê³¼ë  ë•Œ ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬

---

## ğŸ›  ê°œë°œì ë…¸íŠ¸

### ì½”ë“œ ë³€ê²½ ìœ„ì¹˜

**ìˆ˜ì •ëœ íŒŒì¼:**

1. `lib/langgraph/nodes/tools.ts` (Line 610-683)
   - MCP ì‘ë‹µ ì²˜ë¦¬ ë¡œì§ ì „ë©´ ê°œì„ 
   - isError í”Œë˜ê·¸ ê²€ì¦ ì¶”ê°€
   - ë‹¤ë‹¨ê³„ ê²€ì¦ êµ¬í˜„

2. `lib/langgraph/nodes/generate.ts` (Line 543-566)
   - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— ì—ëŸ¬ ì²˜ë¦¬ ì§€ì¹¨ ì¶”ê°€
   - í™˜ê° ë°©ì§€ ê°€ì´ë“œë¼ì¸ ëª…ì‹œ

### ì½”ë“œ ë¦¬ë·° ì‹œ ì£¼ì˜ì‚¬í•­

- `mcpResult?.isError` í™•ì¸ì€ **í•„ìˆ˜**ì…ë‹ˆë‹¤
- ë¹ˆ ê²°ê³¼ë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ëŒ€ì²´í•˜ì§€ ë§ˆì„¸ìš”
- ì—ëŸ¬ëŠ” í•­ìƒ `error` í•„ë“œì— ëª…í™•íˆ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤
- ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì—ì„œ ë„êµ¬ ì‹¤íŒ¨ ì‹œ í™˜ê° ê¸ˆì§€ë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤

---

## ğŸ“ ê´€ë ¨ ì´ìŠˆ

ì´ ìˆ˜ì •ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ í•´ê²°ë©ë‹ˆë‹¤:

- MCP ë„êµ¬ í˜¸ì¶œ ì‹œ ê°€ì§œ ë°ì´í„° ì‘ë‹µ
- GitHub API ì‹¤íŒ¨ ì‹œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì €ì¥ì†Œ ì •ë³´ ìƒì„±
- ì›¹ ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ í—ˆêµ¬ì˜ ê²€ìƒ‰ ê²°ê³¼ ì œê³µ
- íŒŒì¼ ì½ê¸° ì‹¤íŒ¨ ì‹œ ê°€ìƒì˜ íŒŒì¼ ë‚´ìš© ìƒì„±

---

## âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥

### ë°±ê·¸ë¼ìš´ë“œ ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì•Œë¦¼

ë‹¤ë¥¸ ëŒ€í™”ë¥¼ ë³´ê³  ìˆê±°ë‚˜ ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì— ìˆì„ ë•Œ ìŠ¤íŠ¸ë¦¬ë°ì´ ì™„ë£Œë˜ë©´ ì‹œìŠ¤í…œ ì•Œë¦¼ì„ í‘œì‹œí•©ë‹ˆë‹¤. Cursor, Claude Desktop, ChatGPT ë“±ì˜ AI ë„êµ¬ì™€ ë™ì¼í•œ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**

- âœ… **ìë™ ë°±ê·¸ë¼ìš´ë“œ ê°ì§€**: í˜„ì¬ í™œì„± ëŒ€í™”ì™€ ë‹¤ë¥¸ ëŒ€í™”ì˜ ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹œ ì•Œë¦¼
- âœ… **ì•± í¬ì»¤ìŠ¤ ì¶”ì **: ì•±ì´ ìµœì†Œí™”ë˜ê±°ë‚˜ ë‹¤ë¥¸ ì•±ì„ ì‚¬ìš© ì¤‘ì¼ ë•Œ ì•Œë¦¼
- âœ… **ì‹œìŠ¤í…œ ë„¤ì´í‹°ë¸Œ ì•Œë¦¼**: macOS/Windows ì•Œë¦¼ ì„¼í„°ì— í‘œì‹œ
- âœ… **ì›í´ë¦­ ì´ë™**: ì•Œë¦¼ í´ë¦­ ì‹œ í•´ë‹¹ ëŒ€í™”ë¡œ ìë™ ì „í™˜ ë° ì°½ ë³µì›

**êµ¬í˜„ ìƒì„¸:**

#### 1. Window Focus ìƒíƒœ ì¶”ì  (`lib/store/chat-store.ts`)

```typescript
interface ChatStore {
  isAppFocused: boolean; // Window focus state
  setAppFocused: (focused: boolean) => void;
}

// ì´ˆê¸° ìƒíƒœ
isAppFocused: true, // Initially focused
```

#### 2. Focus/Blur ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (`electron/main.ts`)

```typescript
mainWindow.on('focus', () => {
  mainWindow?.webContents.send('window:focus-changed', { focused: true });
});

mainWindow.on('blur', () => {
  mainWindow?.webContents.send('window:focus-changed', { focused: false });
});
```

#### 3. ë°±ê·¸ë¼ìš´ë“œ ê°ì§€ ë¡œì§ (`useMessageStreaming.ts`)

ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹œ ë‹¤ìŒ ì¡°ê±´ì„ ì²´í¬:

```typescript
const state = useChatStore.getState();
const isDifferentConversation = state.activeConversationId !== conversationId;
const isAppUnfocused = !state.isAppFocused;

if (isDifferentConversation || isAppUnfocused) {
  // ì‹œìŠ¤í…œ ì•Œë¦¼ í‘œì‹œ
  window.electronAPI.notification.show({
    conversationId,
    title: 'SEPilot',
    body: `"${title}" ëŒ€í™”ì˜ ì‘ë‹µì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`,
  });
}
```

#### 4. ì•Œë¦¼ IPC í•¸ë“¤ëŸ¬ (`electron/ipc/handlers/notification.ts`)

```typescript
export function setupNotificationHandlers(getMainWindow: () => BrowserWindow | null) {
  ipcMain.handle('notification:show', async (event, options) => {
    const notification = new Notification({
      title: options.title,
      body: options.body,
      silent: false,
      urgency: 'normal',
    });

    notification.on('click', () => {
      const mainWindow = getMainWindow();
      if (mainWindow) {
        if (mainWindow.isMinimized()) mainWindow.restore();
        mainWindow.show();
        mainWindow.focus();
        mainWindow.webContents.send('notification:click', options.conversationId);
      }
    });

    notification.show();
  });
}
```

#### 5. ì•Œë¦¼ í´ë¦­ ì²˜ë¦¬ (`app/page.tsx`)

```typescript
// ì•Œë¦¼ í´ë¦­ ë¦¬ìŠ¤ë„ˆ
const notificationCleanup = window.electronAPI.notification?.onClick((conversationId: string) => {
  useChatStore.getState().setActiveConversation(conversationId);
});
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

1. **ë‹¤ì¤‘ ëŒ€í™” ë™ì‹œ ì§„í–‰**: ëŒ€í™” Aì—ì„œ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ â†’ ëŒ€í™” Bë¡œ ì „í™˜ â†’ A ì™„ë£Œ ì‹œ ì•Œë¦¼ í‘œì‹œ
2. **ì•± ìµœì†Œí™” ì¤‘ ì™„ë£Œ**: ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ í›„ ì•± ìµœì†Œí™” â†’ ì™„ë£Œ ì‹œ ì•Œë¦¼ í‘œì‹œ
3. **ì•Œë¦¼ í´ë¦­ ë³µê·€**: ì•Œë¦¼ í´ë¦­ â†’ ì•± ë³µì› ë° í•´ë‹¹ ëŒ€í™”ë¡œ ìë™ ì „í™˜

**íƒ€ì… ì•ˆì „ì„±:**

- `types/electron.d.ts`ì— `NotificationAPI` ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€
- IPC í†µì‹ ì˜ ëª¨ë“  ë‹¨ê³„ê°€ TypeScriptë¡œ íƒ€ì… ì •ì˜ë¨

---

### Extension ê´€ë¦¬ UI ì¶”ê°€

Extension ì‹œìŠ¤í…œì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì „ìš© UIê°€ Settingsì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. Browser, Editor, Presentationê³¼ ê°™ì€ ë¹ŒíŠ¸ì¸ Extensionì„ í•œ ê³³ì—ì„œ í™œì„±í™”/ë¹„í™œì„±í™”í•˜ê³  ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì¶”ê°€ëœ ì»´í¬ë„ŒíŠ¸:**

#### 1. ExtensionCard ì»´í¬ë„ŒíŠ¸ (`components/settings/ExtensionCard.tsx`)

ê°œë³„ Extensionì„ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œí•˜ëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```typescript
export function ExtensionCard({
  manifest,
  isActive,
  canDeactivate,
  onToggle,
  onSettings,
  isToggling = false,
}: ExtensionCardProps) {
  // Extension ì•„ì´ì½˜, ì´ë¦„, ë²„ì „, ì‘ì„±ì í‘œì‹œ
  // ë² íƒ€ ë°°ì§€ í‘œì‹œ (betaFlagê°€ ìˆëŠ” ê²½ìš°)
  // ì˜ì¡´ì„± ëª©ë¡ í‘œì‹œ
  // í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€ ìŠ¤ìœ„ì¹˜
  // ì„¤ì • ë²„íŠ¼ (settingsTabì´ ìˆëŠ” ê²½ìš°)
}
```

**ì£¼ìš” ê¸°ëŠ¥:**

- âœ… Extension ë©”íƒ€ë°ì´í„° í‘œì‹œ (ì•„ì´ì½˜, ì´ë¦„, ë²„ì „, ì„¤ëª…, ì‘ì„±ì)
- âœ… ë² íƒ€ Extension ë°°ì§€ í‘œì‹œ
- âœ… ì˜ì¡´ì„± ëª©ë¡ ì‹œê°í™”
- âœ… í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€ (ì˜ì¡´ì„±ì´ ìˆëŠ” ê²½ìš° Tooltipìœ¼ë¡œ ì•ˆë‚´)
- âœ… ì„¤ì • íƒ­ìœ¼ë¡œ ë°”ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼

#### 2. ExtensionManagerTab ì»´í¬ë„ŒíŠ¸ (`components/settings/ExtensionManagerTab.tsx`)

Extension ê´€ë¦¬ ë©”ì¸ í™”ë©´ì…ë‹ˆë‹¤.

```typescript
export function ExtensionManagerTab({ onSectionChange, message }: ExtensionManagerTabProps) {
  const loadExtensions = () => {
    // Extension Registryì—ì„œ ì „ì²´ Extension ì¡°íšŒ
    // í™œì„±í™” ìƒíƒœ, ì˜ì¡´ì„± ì •ë³´ í™•ì¸
    // í™œì„±í™”ëœ Extension ìš°ì„  ì •ë ¬
  };

  const handleToggle = async (extensionId: string, enabled: boolean) => {
    // Extension í™œì„±í™”/ë¹„í™œì„±í™”
    // BetaConfig ë™ê¸°í™” (betaFlagê°€ ìˆëŠ” ê²½ìš°)
    // Extension ìƒíƒœ ì €ì¥ (AppConfig.extensions)
  };
}
```

**ì£¼ìš” ê¸°ëŠ¥:**

- âœ… Extension ëª©ë¡ í‘œì‹œ (í™œì„±í™”ëœ ê²ƒê³¼ ë¹„í™œì„±í™”ëœ ê²ƒ ë¶„ë¦¬)
- âœ… Extension í™œì„±í™”/ë¹„í™œì„±í™” ì²˜ë¦¬
- âœ… Extension ìƒíƒœ ì˜êµ¬ ì €ì¥ (`AppConfig.extensions`)
- âœ… BetaConfig ë™ê¸°í™” (Extensionì˜ `betaFlag`ê°€ ìˆëŠ” ê²½ìš°)
- âœ… ì˜ì¡´ì„± í™•ì¸ ë° ë¹„í™œì„±í™” ë°©ì§€
- âœ… ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€ í‘œì‹œ

**íƒ€ì… ì •ì˜ ì¶”ê°€ (`types/index.ts`):**

```typescript
export interface ExtensionStateConfig {
  [extensionId: string]: {
    enabled: boolean;
    settings?: Record<string, unknown>;
  };
}

export interface AppConfig {
  // ... ê¸°ì¡´ í•„ë“œë“¤
  extensions?: ExtensionStateConfig;
}
```

**Registry ë©”ì„œë“œ ì¶”ê°€ (`lib/extensions/registry.ts`):**

```typescript
// íŠ¹ì • Extensionì— ì˜ì¡´í•˜ëŠ” í™œì„±í™”ëœ Extension ì¡°íšŒ
getDependents(id: string): ExtensionDefinition[] {
  return Array.from(this.extensions.values())
    .filter((entry) => entry.isActive && entry.definition.manifest.dependencies?.includes(id))
    .map((entry) => entry.definition);
}

// Extension ë¹„í™œì„±í™” ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ (ë‹¤ë¥¸ í™œì„±í™”ëœ Extensionì´ ì˜ì¡´í•˜ê³  ìˆìœ¼ë©´ ë¶ˆê°€)
canDeactivate(id: string): boolean {
  const dependents = this.getDependents(id);
  return dependents.length === 0;
}
```

**ìƒíƒœ ë³µì› ë¡œì§ (`lib/extensions/loader.ts`):**

```typescript
async function loadExtensionsConfig(): Promise<ExtensionStateConfig> {
  // Electron í™˜ê²½ì—ì„œëŠ” electronAPI.config.load()ë¡œ ë¡œë“œ
  // ì›¹ í™˜ê²½ì—ì„œëŠ” localStorageì—ì„œ ë¡œë“œ
  // ì €ì¥ëœ Extension í™œì„±í™” ìƒíƒœ ë°˜í™˜
}

// Extension ë¡œë”© ì‹œ ì €ì¥ëœ ìƒíƒœ ë³µì›
// manifest.enabledë³´ë‹¤ ì €ì¥ëœ ìƒíƒœ ìš°ì„ 
```

**Settings UI í†µí•©:**

1. `components/settings/SettingsSidebar.tsx`
   - 'extensions' íƒ­ ì¶”ê°€ (Puzzle ì•„ì´ì½˜)
   - Features ì¹´í…Œê³ ë¦¬ì— ë°°ì¹˜

2. `components/settings/SettingsDialog.tsx`
   - ExtensionManagerTab ë Œë”ë§ ì¶”ê°€

**ë‹¤êµ­ì–´ ì§€ì› ì¶”ê°€ (`locales/ko.json`, `en.json`, `zh.json`):**

```json
{
  "settings": {
    "extensions": {
      "title": "Extension ê´€ë¦¬",
      "description": "ì•± ê¸°ëŠ¥ì„ í™•ì¥í•˜ëŠ” Extensionì„ ê´€ë¦¬í•©ë‹ˆë‹¤",
      "activeExtensions": "í™œì„±í™”ëœ Extension",
      "availableExtensions": "ì‚¬ìš© ê°€ëŠ¥í•œ Extension",
      "noDependencies": "ì˜ì¡´ì„± ì—†ìŒ",
      "dependencies": "ì˜ì¡´ì„±",
      "betaBadge": "ë² íƒ€",
      "cannotDeactivate": "ë‹¤ë¥¸ Extensionì´ ì´ Extensionì— ì˜ì¡´í•˜ê³  ìˆì–´ ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      "goToSettings": "ì„¤ì •",
      "version": "ë²„ì „",
      "author": "ì‘ì„±ì",
      "saved": "Extension ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤",
      "saveFailed": "Extension ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",
      "notFound": "Extensionì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
    }
  }
}
```

**ë°ì´í„° íë¦„:**

```
Extension ëª©ë¡ ë¡œë“œ
  â†’ extensionRegistry.getAll()
  â†’ í™œì„±í™” ìƒíƒœ í™•ì¸ (ì €ì¥ëœ ìƒíƒœ ìš°ì„ )
  â†’ UIì— í‘œì‹œ

ì‚¬ìš©ì í† ê¸€ ì•¡ì…˜
  â†’ extensionRegistry.activate/deactivate
  â†’ BetaConfig ë™ê¸°í™” (betaFlagê°€ ìˆëŠ” ê²½ìš°)
  â†’ AppConfig.extensionsì— ìƒíƒœ ì €ì¥
  â†’ UI ì—…ë°ì´íŠ¸

ì•± ì¬ì‹œì‘
  â†’ loadExtensionsConfig()ë¡œ ì €ì¥ëœ ìƒíƒœ ë¡œë“œ
  â†’ ì €ì¥ëœ ìƒíƒœì— ë”°ë¼ Extension í™œì„±í™”
  â†’ manifest.enabledëŠ” ê¸°ë³¸ê°’ìœ¼ë¡œë§Œ ì‚¬ìš©
```

**ì‚¬ìš©ì ê²½í—˜ ê°œì„ :**

- âœ… Settingsì—ì„œ ëª¨ë“  Extensionì„ í•œëˆˆì— í™•ì¸
- âœ… ì›í´ë¦­ìœ¼ë¡œ Extension í™œì„±í™”/ë¹„í™œì„±í™”
- âœ… Extension ê°„ ì˜ì¡´ì„± ìë™ ê´€ë¦¬
- âœ… Extensionë³„ ì„¤ì • í˜ì´ì§€ë¡œ ë¹ ë¥¸ ì´ë™
- âœ… ë² íƒ€ Extension ëª…í™•í•œ í‘œì‹œ
- âœ… ë‹¤êµ­ì–´ ì§€ì› (í•œêµ­ì–´, ì˜ì–´, ì¤‘êµ­ì–´)

**ì½”ë“œ í’ˆì§ˆ ê°œì„ :**

- âœ… ì˜ì¡´ì„± í‘œì‹œ ë¡œì§ ê°œì„  (ë¹ˆ ë°°ì—´ ì²˜ë¦¬)
- âœ… íƒ€ì… ì•ˆì „ì„± ê°•í™” (`Partial<AppConfig>` ì‚¬ìš©)
- âœ… ì—ëŸ¬ ë©”ì‹œì§€ ë‹¤êµ­ì–´ ì§€ì›
- âœ… Settings ì•„ì´ì½˜ ì˜ë¯¸ ëª…í™•í™” (Puzzle ì‚¬ìš©)

**ì˜í–¥ë°›ëŠ” íŒŒì¼:**

- **ì‹ ê·œ ìƒì„± (2ê°œ)**
  - `components/settings/ExtensionCard.tsx`
  - `components/settings/ExtensionManagerTab.tsx`

- **ìˆ˜ì • (7ê°œ)**
  - `types/index.ts`
  - `lib/extensions/registry.ts`
  - `lib/extensions/loader.ts`
  - `components/settings/SettingsSidebar.tsx`
  - `components/settings/SettingsDialog.tsx`
  - `locales/ko.json`, `en.json`, `zh.json`

### Monaco Editorì™€ Coding Agent í†µí•© ê°•í™”

Claude Desktopê³¼ ë™ë“±í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ìœ„í•´ Monaco Editorì˜ í…ìŠ¤íŠ¸ ì„ íƒ ê¸°ëŠ¥ì´ Coding Agentì™€ ì™„ì „íˆ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤.

**ì¶”ê°€ëœ ê¸°ëŠ¥:**

#### Monaco Editor Selection Change Listener (`extensions/editor/components/Editor.tsx`)

```typescript
// Monaco editor selection change listener
useEffect(() => {
  if (!editor || !monacoInstance) {
    return;
  }

  // Listen to cursor selection changes
  const disposable = editor.onDidChangeCursorSelection((e) => {
    const selection = e.selection;
    const model = editor.getModel();

    if (!model) {
      setActiveFileSelection(null);
      return;
    }

    // Check if there's a non-empty selection
    const hasSelection =
      !selection.isEmpty() &&
      (selection.startLineNumber !== selection.endLineNumber ||
        selection.startColumn !== selection.endColumn);

    if (hasSelection) {
      // Get selected text
      const selectedText = model.getValueInRange(selection);

      // Update store with selection info
      setActiveFileSelection({
        text: selectedText,
        range: {
          startLineNumber: selection.startLineNumber,
          startColumn: selection.startColumn,
          endLineNumber: selection.endLineNumber,
          endColumn: selection.endColumn,
        },
      });
    } else {
      // No selection - clear it
      setActiveFileSelection(null);
    }
  });

  // Cleanup listener on unmount
  return () => {
    disposable.dispose();
  };
}, [editor, monacoInstance, setActiveFileSelection]);
```

**ì£¼ìš” ê°œì„ ì‚¬í•­:**

- âœ… ì—ë””í„°ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ `activeFileSelection` ìƒíƒœ ì—…ë°ì´íŠ¸
- âœ… ì„ íƒëœ í…ìŠ¤íŠ¸ì™€ ì •í™•í•œ ìœ„ì¹˜ ì •ë³´(range) ì €ì¥
- âœ… Coding Agentê°€ ì‚¬ìš©ìê°€ ì„ íƒí•œ í…ìŠ¤íŠ¸ë¥¼ ì¸ì‹í•˜ê³  í™œìš© ê°€ëŠ¥
- âœ… `replace_selection` ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ íƒëœ í…ìŠ¤íŠ¸ ìˆ˜ì • ê°€ëŠ¥
- âœ… Claude Desktopê³¼ ë™ì¼í•œ ì›Œí¬í”Œë¡œìš° ì œê³µ

**ë°ì´í„° íë¦„:**

```
Monaco Editor í…ìŠ¤íŠ¸ ì„ íƒ
  â†’ onDidChangeCursorSelection ì´ë²¤íŠ¸
  â†’ setActiveFileSelection (store ì—…ë°ì´íŠ¸)
  â†’ getGraphConfig (GraphConfigì— í¬í•¨)
  â†’ IPCë¥¼ í†µí•´ Coding Agentì— ì „ë‹¬
  â†’ Coding Agentê°€ ì„ íƒëœ í…ìŠ¤íŠ¸ ì¸ì‹
  â†’ replace_selection ë„êµ¬ë¡œ í…ìŠ¤íŠ¸ ìˆ˜ì • ê°€ëŠ¥
```

**ì‚¬ìš©ì ê²½í—˜ ê°œì„ :**

- âœ… ì—ë””í„°ì—ì„œ ì½”ë“œë¥¼ ì„ íƒí•˜ê³  ì±„íŒ…ìœ¼ë¡œ "ì´ ë¶€ë¶„ì„ ê°œì„ í•´ì¤˜" ìš”ì²­ ê°€ëŠ¥
- âœ… Coding Agentê°€ ì •í™•íˆ ì„ íƒëœ ë¶€ë¶„ë§Œ ìˆ˜ì •
- âœ… íŒŒì¼ ì „ì²´ê°€ ì•„ë‹Œ íŠ¹ì • ì½”ë“œ ë¸”ë¡ì— ëŒ€í•œ ì‘ì—… ê°€ëŠ¥
- âœ… Claude Desktopê³¼ ë™ì¼í•œ ì‚¬ìš©ì ê²½í—˜

**ì˜í–¥ë°›ëŠ” íŒŒì¼:**

1. `extensions/editor/components/Editor.tsx`
   - `setActiveFileSelection` ì¶”ê°€
   - `onDidChangeCursorSelection` listener êµ¬í˜„

2. `extensions/editor/components/SingleFileEditor.tsx` â­ **NEW**
   - `editor:replace-selection` IPC listener êµ¬í˜„
   - Coding Agentê°€ ì„ íƒëœ í…ìŠ¤íŠ¸ë¥¼ ì‹¤ì œë¡œ êµì²´í•  ìˆ˜ ìˆë„ë¡ ì—°ê²°

3. `lib/mcp/tools/builtin-tools.ts`
   - `replace_selection` ë„êµ¬ ì •ì˜ ë° IPC ì´ë²¤íŠ¸ ë°œì†¡

4. `lib/langgraph/graphs/coding-agent.ts`
   - ì´ë¯¸ `state.activeFileSelection` ì²˜ë¦¬ ë¡œì§ êµ¬í˜„ë¨ (Line 555-570, 822-839)

5. `lib/store/chat-store.ts`
   - `getGraphConfig()` ì´ë¯¸ `activeFileSelection` í¬í•¨ ì¤‘

6. `extensions/editor/agents/editor-agent-advanced.ts`
   - `EditorAgentState`ì— `workingDirectory` íƒ€ì… ì¶”ê°€

### ğŸ”§ Critical Fix: IPC Listener ì¶”ê°€

**ì´ì „ ë¬¸ì œ:**

- `replace_selection` ë„êµ¬ê°€ ì •ì˜ë˜ì–´ ìˆê³  IPC ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ì§€ë§Œ
- SingleFileEditorì— ì´ë²¤íŠ¸ë¥¼ ë°›ëŠ” listenerê°€ ì—†ì–´ì„œ ì‹¤ì œ í…ìŠ¤íŠ¸ êµì²´ ë¶ˆê°€

**í•´ê²°:**

```typescript
// SingleFileEditor.tsx - IPC listener ì¶”ê°€
useEffect(() => {
  if (!editor || !isElectron() || !window.electronAPI) {
    return;
  }

  const handleReplaceSelection = (...args: unknown[]) => {
    const newText = args[0] as string;
    const selection = editor.getSelection();

    if (!selection) return;

    // Replace the selected text
    editor.executeEdits('replace-selection', [
      {
        range: selection,
        text: newText,
      },
    ]);

    // Mark file as dirty
    if (onChange) {
      onChange(editor.getValue());
    }
  };

  window.electronAPI.on('editor:replace-selection', handleReplaceSelection);

  return () => {
    window.electronAPI.removeListener('editor:replace-selection', handleReplaceSelection);
  };
}, [editor, onChange]);
```

**ì™„ì„±ë„:**

- âœ… 100% Claude Desktop ë™ë“± ê¸°ëŠ¥ ë‹¬ì„±
- âœ… ì „ì²´ ë°ì´í„° íë¦„ ì™„ì„±: Editor Selection â†’ Store â†’ GraphConfig â†’ IPC â†’ Coding Agent â†’ replace_selection ë„êµ¬ â†’ IPC ì´ë²¤íŠ¸ â†’ Editor í…ìŠ¤íŠ¸ êµì²´

---

## ğŸ›¡ï¸ ì•ˆì „ì„± ê°œì„ : Working Directory í•„ìˆ˜í™”

### ë¬¸ì œ ì¸ì‹

ì´ì „ì—ëŠ” Working Directoryë¥¼ ì„¤ì •í•˜ì§€ ì•Šê³  Coding modeë¥¼ ì‚¬ìš©í•˜ë©´:

- `process.cwd()` (ì•± ì„¤ì¹˜ ìœ„ì¹˜)ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©ë¨
- ì‚¬ìš©ìê°€ "src/index.tsë¥¼ ì½ì–´ì¤˜"ë¼ê³  ìš”ì²­í•˜ë©´ ì´ìƒí•œ ê²½ë¡œ(`/Applications/SEPilot.app/src/index.ts`) ì ‘ê·¼ ì‹œë„
- ëª…í™•í•˜ì§€ ì•Šì€ "File not found" ì—ëŸ¬ ë°œìƒ
- **ì‚¬ìš©ìê°€ ì™œ ì•ˆ ë˜ëŠ”ì§€ ì´í•´í•˜ê¸° ì–´ë ¤ì›€**

### í•´ê²° ë°©ë²•

**1. Working Directory í•„ìˆ˜í™”** (`lib/mcp/tools/builtin-tools.ts`)

```typescript
function resolvePath(filePath: string): string {
  const workingDir = getCurrentWorkingDirectory();

  if (!workingDir) {
    throw new Error(
      'Working directory is not set. Please select a working directory in Coding mode before using file operations.'
    );
  }

  // ... ë‚˜ë¨¸ì§€ ë¡œì§
}
```

**ì ìš©ëœ ë„êµ¬:**

- `file_read`, `file_write`, `file_edit`, `file_list` (resolvePath ì‚¬ìš©)
- `command_execute` (Line 791-795)
- `grep_search` (Line 875-879)

**2. UI ê²½ê³  í‘œì‹œ** (`components/chat/WorkingDirectoryIndicator.tsx`)

Coding modeì—ì„œ Working Directoryê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ì„ ë•Œ ëª…í™•í•œ ê²½ê³  ë°°ë„ˆ í‘œì‹œ:

```typescript
if (thinkingMode === 'coding' && !workingDirectory) {
  return (
    <div className="... bg-orange-500/10 border-orange-500/50">
      <AlertCircle />
      <span className="text-orange-700">
        Warning: Working directory not set. File operations will fail.
      </span>
      <Button className="bg-orange-600">Set Working Directory</Button>
    </div>
  );
}
```

**3. System Prompt ê°œì„ ** (`lib/langgraph/prompts/coding-agent-system.ts`)

Working Directoryê°€ ì—†ì„ ë•Œ Coding Agentì—ê²Œ ëª…í™•í•œ ì§€ì¹¨:

```markdown
## âš ï¸ CRITICAL: No Working Directory Set

**IMPORTANT**: The user has NOT set a working directory.

**What This Means**:

- File operations (file_read, file_write, file_edit, file_list) will FAIL
- Command execution (command_execute) will FAIL
- Search operations (grep_search) will FAIL

**What You Should Do**:

1. Immediately inform the user that working directory is not set
2. Ask them to select a working directory before proceeding
3. DO NOT attempt any file or command operations
```

### íš¨ê³¼

- âœ… **ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€**: "Working directory is not set. Please select..."
- âœ… **ì‹œê°ì  ê²½ê³ **: ì˜¤ë Œì§€ìƒ‰ ë°°ë„ˆë¡œ ì¦‰ì‹œ ì¸ì‹ ê°€ëŠ¥
- âœ… **ì›í´ë¦­ í•´ê²°**: ê²½ê³  ë°°ë„ˆì—ì„œ ë°”ë¡œ ë””ë ‰í† ë¦¬ ì„ íƒ ê°€ëŠ¥
- âœ… **AI ì•ˆë‚´**: Coding Agentê°€ ì‚¬ì „ì— ì‚¬ìš©ìì—ê²Œ ì„¤ì • ìš”ì²­
- âœ… **ì•ˆì „ì„± í–¥ìƒ**: ì˜ˆìƒì¹˜ ëª»í•œ ê²½ë¡œ ì ‘ê·¼ ë°©ì§€

### Claude Desktopê³¼ì˜ ë¹„êµ

| ê¸°ëŠ¥               | Claude Desktop | SEPilot (Before) | SEPilot (After) |
| ------------------ | -------------- | ---------------- | --------------- |
| Working Dir í•„ìˆ˜   | âœ…             | âŒ               | âœ…              |
| ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ | âœ…             | âŒ               | âœ…              |
| UI ê²½ê³  í‘œì‹œ       | âœ…             | âŒ               | âœ…              |
| AI ì‚¬ì „ ì•ˆë‚´       | âœ…             | âŒ               | âœ…              |

---

## âš ï¸ Breaking Changes

ì—†ìŒ. ì´ ìˆ˜ì •ì€ ë‚´ë¶€ ë¡œì§ ê°œì„ ì´ë©° API ì¸í„°í˜ì´ìŠ¤ëŠ” ë³€ê²½ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

---

**ì „ì²´ ë³€ê²½ ë¡œê·¸**: [v0.7.3...v0.7.4](https://github.com/jhl-labs/sepilot_desktop/compare/v0.7.3...v0.7.4)

### ğŸš€ Browser Extension Perplexity-Level ì†ë„ ìµœì í™” (5ë°° ê°œì„ )

Browser Agentì˜ ì›¹ ê²€ìƒ‰ ë° ì •ë³´ ìˆ˜ì§‘ ì†ë„ë¥¼ Perplexity ìˆ˜ì¤€ìœ¼ë¡œ ëŒ€í­ ê°œì„ í–ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì—°ì†ì ìœ¼ë¡œ ë°©ë¬¸í•  ë•Œ **5ë°° ë¹ ë¥¸ ì„±ëŠ¥**ì„ ì œê³µí•©ë‹ˆë‹¤.

#### íƒ­ ê¸°ë°˜ ì•„í‚¤í…ì²˜ êµ¬í˜„

ê²€ìƒ‰ ê²°ê³¼ ë°©ë¬¸ ì‹œ ê²€ìƒ‰ í˜ì´ì§€ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ **íƒ­ ê¸°ë°˜ ì‹œìŠ¤í…œ**ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤:

```
ì›ë˜ íƒ­ (ê²€ìƒ‰ í˜ì´ì§€)
    â†“ ìƒˆ íƒ­ ì—´ê¸°
ìƒˆ íƒ­ (ê²°ê³¼ 1) â†’ ì •ë³´ ìˆ˜ì§‘ â†’ íƒ­ ë‹«ê¸°
    â†“ ì›ë˜ íƒ­ìœ¼ë¡œ ë³µê·€
ì›ë˜ íƒ­ (ê²€ìƒ‰ í˜ì´ì§€)
    â†“ ìƒˆ íƒ­ ì—´ê¸°
ìƒˆ íƒ­ (ê²°ê³¼ 2) â†’ ì •ë³´ ìˆ˜ì§‘ â†’ íƒ­ ë‹«ê¸°
    â†“ ì›ë˜ íƒ­ìœ¼ë¡œ ë³µê·€
```

**ì¥ì :**

- âœ… ê²€ìƒ‰ í˜ì´ì§€ê°€ í•­ìƒ ìœ ì§€ë˜ì–´ ë‹¤ìŒ ê²°ê³¼ë¡œ ë¹ ë¥´ê²Œ ì´ë™
- âœ… ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬ ë³µì¡ë„ ì œê±° (ë’¤ë¡œê°€ê¸° ë¶ˆí•„ìš”)
- âœ… íƒ­ ìƒì„±/ì‚­ì œê°€ í˜ì´ì§€ ë¡œë“œë³´ë‹¤ ë¹ ë¦„
- âœ… Finally blockìœ¼ë¡œ íƒ­ ì •ë¦¬ ë³´ì¥ (ì—ëŸ¬ ë°œìƒ ì‹œì—ë„)

#### ì†ë„ ìµœì í™” ìƒì„¸

| ìµœì í™” í•­ëª©          | ê¸°ì¡´             | ê°œì„                     | ì†ë„ ì¦ê°€   |
| -------------------- | ---------------- | ----------------------- | ----------- |
| `naturalDelay`       | 500-1500ms       | 100-300ms               | **5ë°°**     |
| `maxWaitTime`        | 10ì´ˆ             | 5ì´ˆ                     | **2ë°°**     |
| `waitForJs`          | 1500ms           | 500ms                   | **3ë°°**     |
| í˜ì´ì§€ ë¡œë“œ          | ì „ì²´ ë¦¬ì†ŒìŠ¤ ëŒ€ê¸° | DOM-readyë§Œ             | **2-3ë°°**   |
| ë©”íƒ€ë°ì´í„° ì¶”ì¶œ      | ìˆœì°¨ ì‹¤í–‰        | ë³‘ë ¬ ì‹¤í–‰ (Promise.all) | **2ë°°**     |
| `extractType` ê¸°ë³¸ê°’ | 'text' (ì „ì²´)    | 'summary' (8ê°œ ë‹¨ë½)    | **3-5ë°°**   |
| íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬        | ì—ëŸ¬ ë°œìƒ        | ë¶€ë¶„ ì½˜í…ì¸  ì‚¬ìš©        | ì‹¤íŒ¨ìœ¨ ê°ì†Œ |

**ì‹¤ì œ ì„±ëŠ¥ ë¹„êµ:**

- ë‹¨ì¼ ê²°ê³¼ ë°©ë¬¸: **10-15ì´ˆ â†’ 2-3ì´ˆ** (5ë°° ë¹ ë¦„)
- 3ê°œ ê²°ê³¼ ì—°ì† ë°©ë¬¸: **30-45ì´ˆ â†’ 6-9ì´ˆ** (5ë°° ë¹ ë¦„)
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: 30% ê°ì†Œ (íƒ­ ì¦‰ì‹œ ì •ë¦¬)

#### ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

**1. ë‚´ë¶€ íƒ­ ê´€ë¦¬ í—¬í¼ í•¨ìˆ˜** (`electron/ipc/handlers/browser-view.ts`)

IPC ì˜¤ë²„í—¤ë“œë¥¼ ì œê±°í•˜ê³  Main processì—ì„œ ì§ì ‘ í˜¸ì¶œ ê°€ëŠ¥í•œ í•¨ìˆ˜ë“¤:

```typescript
// IPC ì—†ì´ ë¹ ë¥¸ íƒ­ ìƒì„± (loadURLì€ callerê°€ ì œì–´)
export function createTabInternal(mainWindow: BrowserWindow, url: string): string;

// íƒ­ ì „í™˜ (ì¦‰ì‹œ ì‹¤í–‰)
export function switchTabInternal(mainWindow: BrowserWindow, tabId: string): void;

// íƒ­ ë‹«ê¸° ë° ì •ë¦¬ (ë©”ëª¨ë¦¬ ì¦‰ì‹œ í•´ì œ)
export function closeTabInternal(mainWindow: BrowserWindow, tabId: string): void;
```

**2. google_visit_result ì™„ì „ ì¬ì‘ì„±** (`lib/mcp/tools/google-search-handlers.ts`)

ê¸°ì¡´: `loadURL` ì§ì ‘ í˜¸ì¶œ â†’ ê²€ìƒ‰ í˜ì´ì§€ ì´íƒˆ  
ê°œì„ : íƒ­ ìƒì„± â†’ ë°©ë¬¸ â†’ ì •ë³´ ìˆ˜ì§‘ â†’ íƒ­ ë‹«ê¸° â†’ ë³µê·€

**3. íƒ€ì„ì•„ì›ƒ ì „ëµ ê°œì„ **

ê¸°ì¡´: íƒ€ì„ì•„ì›ƒ ì‹œ ì—ëŸ¬ ë°œìƒ â†’ Agent ì¤‘ë‹¨  
ê°œì„ : íƒ€ì„ì•„ì›ƒ ì‹œ ë¶€ë¶„ ì½˜í…ì¸  ì‚¬ìš© â†’ ê³„ì† ì§„í–‰

**4. Summary ì¶”ì¶œ ìµœì í™”**

ì „ì²´ í…ìŠ¤íŠ¸ ëŒ€ì‹  í•µì‹¬ ë‹¨ë½ë§Œ ì¶”ì¶œ (ìƒìœ„ 8ê°œ ë‹¨ë½, 30ì ì´ìƒ)

#### Perplexity ëª¨ë“œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì¶”ê°€

Browser Agentê°€ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ **ìë™ìœ¼ë¡œ ì›¹ ê²€ìƒ‰ì´ í•„ìš”í•œì§€ íŒë‹¨**í•˜ë„ë¡ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

**ìë™ ê²€ìƒ‰ íŠ¸ë¦¬ê±° ì¡°ê±´:**

- âœ… **ìµœì‹ /ì‹¤ì‹œê°„ ì •ë³´**: "2024ë…„ ë…¸ë²¨ìƒ", "ìµœì‹  AI ë‰´ìŠ¤"
- âœ… **ì‚¬ì‹¤ í™•ì¸**: í†µê³„, ê°€ê²©, ë‚ ì§œ, íŠ¹ì • ì‚¬ì‹¤
- âœ… **ëª¨ë¥´ëŠ” ì£¼ì œ**: Agentê°€ í™•ì‹  ì—†ëŠ” ì •ë³´
- âœ… **íŠ¹ì • ì—”í‹°í‹°**: ê¸°ì—…, ì œí’ˆ, ì¸ë¬¼, ì¥ì†Œ ë“±

**Perplexity ìŠ¤íƒ€ì¼ ì‘ë‹µ:**

1. **ìë™ ê°ì§€**: ì§ˆë¬¸ ë¶„ì„ í›„ ì›¹ ê²€ìƒ‰ í•„ìš” ì—¬ë¶€ íŒë‹¨
2. **ë‹¤ì¤‘ ì†ŒìŠ¤ ì¡°ì‚¬**: ìƒìœ„ 2-3ê°œ ê²€ìƒ‰ ê²°ê³¼ ë°©ë¬¸
3. **ì •ë³´ ì¢…í•©**: ì—¬ëŸ¬ ì†ŒìŠ¤ì˜ ì •ë³´ë¥¼ ì¼ê´€ëœ ë‹µë³€ìœ¼ë¡œ í†µí•©
4. **ì¶œì²˜ ì¸ìš©**: `**ì¶œì²˜:**` ì„¹ì…˜ í¬í•¨ (ë§í¬ + ì„¤ëª…)

**ì˜í–¥ë°›ëŠ” íŒŒì¼:**

- `lib/mcp/tools/google-search-handlers.ts` - naturalDelay 5ë°° ë¹ ë¥´ê²Œ, google_visit_result ì™„ì „ ì¬ì‘ì„±
- `electron/ipc/handlers/browser-view.ts` - ë‚´ë¶€ íƒ­ ê´€ë¦¬ í—¬í¼ ì¶”ê°€
- `extensions/browser/agents/browser-agent.ts` - Perplexity ëª¨ë“œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì¶”ê°€
- `extensions/browser/README.md` - ì†ë„ ìµœì í™” ë¬¸ì„œ ì¶”ê°€

---

### ğŸ”§ useLangGraphStream Hook í†µí•© ë° íƒ€ì… ì•ˆì „ì„± ê°•í™”

ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì¤‘ë³µë˜ë˜ ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ì„ `useLangGraphStream` hookìœ¼ë¡œ í†µí•©í•˜ê³ , Editor Agentë¥¼ ìœ„í•œ ë„êµ¬ ìŠ¹ì¸ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

#### Hook í™•ì¥

**Tool approval ê´€ë ¨ ì˜µì…˜ ì¶”ê°€** (`lib/hooks/useLangGraphStream.ts`):

```typescript
onToolApprovalRequest?: (data: {
  conversationId: string;
  messageId: string;
  toolCalls: Array<{ id: string; name: string; arguments: Record<string, unknown> }>;
}) => void;

onToolApprovalResult?: (approved: boolean) => void;
alwaysApproveToolsForSession?: boolean;
```

#### ì»´í¬ë„ŒíŠ¸ ë¦¬íŒ©í† ë§

**SimpleChatInput** (`extensions/browser/components/SimpleChatInput.tsx`):

- useLangGraphStream hook ì‚¬ìš©ìœ¼ë¡œ ì „í™˜
- ì¤‘ë³µëœ ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ ì œê±° (**135ì¤„ â†’ 8ì¤„**)
- abortControllerRef ì œê±° (hook ë‚´ë¶€ì—ì„œ ê´€ë¦¬)

**EditorChatContainer** (`extensions/editor/components/EditorChatContainer.tsx`):

- useLangGraphStream hook ì‚¬ìš©ìœ¼ë¡œ ì „í™˜
- ë¶ˆí•„ìš”í•œ import ì œê±° (`isElectron`, `getWebLLMClient`)

**BrowserChatContainer** (`extensions/browser/components/BrowserChatContainer.tsx`):

- íƒ€ì… ì˜¤ë¥˜ ìˆ˜ì • (í•„ìš”í•œ import ë° íƒ€ì… ì •ì˜ ì¶”ê°€)

**ì½”ë“œ í’ˆì§ˆ ê°œì„ :**

- âœ… ì¤‘ë³µ ì½”ë“œ ì œê±° (SimpleChatInput 135ì¤„ â†’ 8ì¤„)
- âœ… íƒ€ì… ì•ˆì „ì„± ê°•í™”
- âœ… ê´€ì‹¬ì‚¬ ë¶„ë¦¬ (Hookì—ì„œ ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ ê´€ë¦¬)
- âœ… ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

**ì˜í–¥ë°›ëŠ” íŒŒì¼:**

- `lib/hooks/useLangGraphStream.ts` - Tool approval ì˜µì…˜ ì¶”ê°€, íƒ€ì… ì˜¤ë¥˜ ìˆ˜ì •
- `extensions/browser/components/SimpleChatInput.tsx` - Hook í†µí•©, ì¤‘ë³µ ì½”ë“œ ì œê±°
- `extensions/browser/components/BrowserChatContainer.tsx` - íƒ€ì… ì˜¤ë¥˜ ìˆ˜ì •
- `extensions/editor/components/EditorChatContainer.tsx` - Hook í†µí•©
