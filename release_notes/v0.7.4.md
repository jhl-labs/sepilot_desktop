# SEPilot Desktop v0.7.4 ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸

**ë¦´ë¦¬ì¦ˆ ë‚ ì§œ**: 2026-01-07

---

## ğŸ› ì¤‘ìš”í•œ ë²„ê·¸ ìˆ˜ì •

### ğŸš¨ MCP ë„êµ¬ í˜¸ì¶œ ì‹œ í™˜ê° ë°ì´í„° ë¬¸ì œ í•´ê²°

MCP(Model Context Protocol)ë¥¼ í†µí•œ ë„êµ¬ í˜¸ì¶œ ì‹œ LLMì´ ê°€ì§œ/í™˜ê° ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ì‹¬ê°í•œ ë¬¸ì œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

**ë°œê²¬ëœ ë¬¸ì œ:**

1. **`isError` í”Œë˜ê·¸ ë¬´ì‹œ**: MCP ë„êµ¬ê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•´ë„ (`isError: true`) ì´ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  ì •ìƒ ê²°ê³¼ì²˜ëŸ¼ LLMì—ê²Œ ì „ë‹¬
2. **ë¹ˆ ê²°ê³¼ë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ëŒ€ì²´**: "Tool returned no result", "Tool returned empty content" ê°™ì€ ì˜ë¯¸ ì—†ëŠ” ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ì—¬ LLMì´ ì‹¤ì œ ë°ì´í„°ë¡œ ì°©ê°
3. **ì—ëŸ¬ ì²˜ë¦¬ ì§€ì¹¨ ë¶€ì¡±**: ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— ë„êµ¬ ì‹¤íŒ¨ ì‹œ í™˜ê°í•˜ì§€ ë§ë¼ëŠ” ëª…í™•í•œ ì§€ì¹¨ì´ ì—†ì—ˆìŒ
4. **ê²°ê³¼ ê²€ì¦ ë¶€ì¬**: MCP ì‘ë‹µì˜ êµ¬ì¡°ë‚˜ ë‚´ìš©ì„ ê²€ì¦í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ LLMì—ê²Œ ì „ë‹¬

**ìˆ˜ì • ë‚´ìš©:**

#### 1. MCP ë„êµ¬ ì‘ë‹µ ê²€ì¦ ê°•í™” (`lib/langgraph/nodes/tools.ts`)

```typescript
// âš ï¸ CRITICAL: Check isError flag first to prevent hallucinations
if (mcpResult?.isError) {
  // MCP ë„êµ¬ê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•œ ê²½ìš° - ëª…í™•í•˜ê²Œ ì—ëŸ¬ë¡œ í‘œì‹œ
  const errorText =
    mcpResult.content
      ?.map((item: any) => item.text || '')
      .filter((text: string) => text)
      .join('\n') || 'Tool execution failed with unknown error';

  console.error(`[Tools] MCP tool returned error for ${call.name}:`, errorText);

  return {
    toolCallId: call.id,
    toolName: call.name,
    result: null,
    error: `Tool '${call.name}' failed: ${errorText}`,
  };
}
```

**ì£¼ìš” ê°œì„ ì‚¬í•­:**

- âœ… `isError` í”Œë˜ê·¸ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ í™•ì¸
- âœ… ì—ëŸ¬ ì‘ë‹µì„ `error` í•„ë“œì— ëª…í™•í•˜ê²Œ í‘œì‹œ
- âœ… null/undefined ì‘ë‹µ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
- âœ… ë¹ˆ content ë°°ì—´ ê°ì§€ ë° ì—ëŸ¬ ì²˜ë¦¬
- âœ… ë¹ˆ í…ìŠ¤íŠ¸ ê²°ê³¼ ê²€ì¦ ì¶”ê°€

#### 2. LLM ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ê°œì„  (`lib/langgraph/nodes/generate.ts`)

**ì¶”ê°€ëœ ì—ëŸ¬ ì²˜ë¦¬ ì§€ì¹¨:**

```markdown
## Critical: Handling Tool Errors

**âš ï¸ NEVER HALLUCINATE OR FABRICATE DATA WHEN A TOOL FAILS**

When you receive a tool error (marked with "Error:" in the result):

1. **Acknowledge the Error**: Tell the user that the tool operation failed
2. **Explain What Happened**: Clearly state which tool failed and why
3. **DO NOT Make Up Data**: Never invent, guess, or fabricate information
4. **Suggest Alternatives**: If possible, suggest alternative approaches
5. **Be Honest**: If you cannot complete the task without the tool, clearly state that

**Example of CORRECT error handling:**
âŒ BAD: "I searched GitHub and found these repositories..." (when the search actually failed)
âœ… GOOD: "The GitHub search tool failed with error: [error message]. I cannot provide search results without access to the GitHub API."

**Remember**: It's better to admit a tool failed than to provide false information.
```

**íš¨ê³¼:**

- âœ… LLMì—ê²Œ ë„êµ¬ ì‹¤íŒ¨ ì‹œ í™˜ê°í•˜ì§€ ë§ ê²ƒì„ ëª…í™•íˆ ì§€ì‹œ
- âœ… ì˜¬ë°”ë¥¸ ì—ëŸ¬ ì²˜ë¦¬ ì˜ˆì‹œ ì œê³µ
- âœ… ê±°ì§“ ì •ë³´ë³´ë‹¤ ì†”ì§í•œ ì‹¤íŒ¨ ì¸ì •ì„ ìš°ì„ í•˜ë„ë¡ êµìœ¡

---

## ğŸ”§ ê¸°ìˆ ì  ê°œì„ 

### MCP ì—ëŸ¬ ì²˜ë¦¬ íë¦„

**ì´ì „ (ë¬¸ì œê°€ ìˆë˜ íë¦„):**

```
MCP ë„êµ¬ í˜¸ì¶œ â†’ ì—ëŸ¬ ë°œìƒ â†’ isError í”Œë˜ê·¸ ë¬´ì‹œ â†’ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì „ë‹¬
â†’ LLMì´ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì‹¤ì œ ë°ì´í„°ë¡œ ì°©ê° â†’ í™˜ê° ë°ì´í„° ìƒì„±
```

**í˜„ì¬ (ìˆ˜ì •ëœ íë¦„):**

```
MCP ë„êµ¬ í˜¸ì¶œ â†’ ì—ëŸ¬ ë°œìƒ â†’ isError í”Œë˜ê·¸ í™•ì¸ â†’ error í•„ë“œì— ëª…í™•íˆ í‘œì‹œ
â†’ LLMì´ ì—ëŸ¬ì„ì„ ì¸ì‹ â†’ ì‚¬ìš©ìì—ê²Œ ì†”ì§í•˜ê²Œ ì‹¤íŒ¨ ì•Œë¦¼
```

### ì¶”ê°€ëœ ê²€ì¦ ë‹¨ê³„

1. **isError í”Œë˜ê·¸ ê²€ì¦**: ìµœìš°ì„  í™•ì¸
2. **null/undefined ê²€ì¦**: ì‘ë‹µì´ ì—†ëŠ” ê²½ìš° ëª…í™•í•œ ì—ëŸ¬
3. **ë¹ˆ content ë°°ì—´ ê²€ì¦**: ë‚´ìš©ì´ ì—†ëŠ” ì‘ë‹µ ê°ì§€
4. **ë¹ˆ í…ìŠ¤íŠ¸ ê²€ì¦**: ê³µë°±ë§Œ ìˆëŠ” ê²°ê³¼ í•„í„°ë§
5. **ì—ëŸ¬ ë¡œê¹…**: ëª¨ë“  ì—ëŸ¬ ìƒí™©ì„ ì½˜ì†”ì— ê¸°ë¡

---

## ğŸ“Š ì˜í–¥ ë²”ìœ„

**ê°œì„ ëœ MCP ë„êµ¬:**

- GitHub API ë„êµ¬ (search_repositories, get_file_contents ë“±)
- ì›¹ ê²€ìƒ‰ ë„êµ¬ (tavily_search ë“±)
- íŒŒì¼ ì‹œìŠ¤í…œ ë„êµ¬
- ë¸Œë¼ìš°ì € ì œì–´ ë„êµ¬
- ê¸°íƒ€ ëª¨ë“  MCP ê¸°ë°˜ ì™¸ë¶€ ë„êµ¬

**ì‚¬ìš©ì ê²½í—˜ ê°œì„ :**

- âœ… ë” ì´ìƒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì €ì¥ì†Œë‚˜ íŒŒì¼ì— ëŒ€í•œ ê°€ì§œ ì •ë³´ë¥¼ ë°›ì§€ ì•ŠìŒ
- âœ… ë„êµ¬ ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ìˆ˜ì‹ 
- âœ… LLMì´ ì‹¤íŒ¨ë¥¼ ì†”ì§í•˜ê²Œ ì¸ì •í•˜ê³  ëŒ€ì•ˆ ì œì‹œ
- âœ… ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ë§Œ ì œê³µë°›ìŒ

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê¶Œì¥ì‚¬í•­

ìˆ˜ì •ëœ ì½”ë“œë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤:

1. **ì¡´ì¬í•˜ì§€ ì•ŠëŠ” GitHub ì €ì¥ì†Œ ê²€ìƒ‰**: ì´ì „ì—ëŠ” ê°€ì§œ ì €ì¥ì†Œ ì •ë³´ë¥¼ ìƒì„±í–ˆìœ¼ë‚˜, ì´ì œëŠ” "ê²€ìƒ‰ ì‹¤íŒ¨" ë©”ì‹œì§€ë¥¼ ëª…í™•íˆ í‘œì‹œ
2. **ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤**: MCP ì„œë²„ ì—°ê²° ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
3. **ë¹ˆ ê²°ê³¼ ë°˜í™˜**: ë„êµ¬ê°€ ë¹ˆ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ë•Œ í™˜ê° ëŒ€ì‹  ì†”ì§í•œ ì‹¤íŒ¨ ì¸ì •
4. **íƒ€ì„ì•„ì›ƒ ì‹œë‚˜ë¦¬ì˜¤**: ë„êµ¬ í˜¸ì¶œì´ ì‹œê°„ ì´ˆê³¼ë  ë•Œ ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬

---

## ğŸ›  ê°œë°œì ë…¸íŠ¸

### ì½”ë“œ ë³€ê²½ ìœ„ì¹˜

**ìˆ˜ì •ëœ íŒŒì¼:**

1. `lib/langgraph/nodes/tools.ts` (Line 610-683)
   - MCP ì‘ë‹µ ì²˜ë¦¬ ë¡œì§ ì „ë©´ ê°œì„ 
   - isError í”Œë˜ê·¸ ê²€ì¦ ì¶”ê°€
   - ë‹¤ë‹¨ê³„ ê²€ì¦ êµ¬í˜„

2. `lib/langgraph/nodes/generate.ts` (Line 543-566)
   - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— ì—ëŸ¬ ì²˜ë¦¬ ì§€ì¹¨ ì¶”ê°€
   - í™˜ê° ë°©ì§€ ê°€ì´ë“œë¼ì¸ ëª…ì‹œ

### ì½”ë“œ ë¦¬ë·° ì‹œ ì£¼ì˜ì‚¬í•­

- `mcpResult?.isError` í™•ì¸ì€ **í•„ìˆ˜**ì…ë‹ˆë‹¤
- ë¹ˆ ê²°ê³¼ë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ëŒ€ì²´í•˜ì§€ ë§ˆì„¸ìš”
- ì—ëŸ¬ëŠ” í•­ìƒ `error` í•„ë“œì— ëª…í™•íˆ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤
- ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì—ì„œ ë„êµ¬ ì‹¤íŒ¨ ì‹œ í™˜ê° ê¸ˆì§€ë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤

---

## ğŸ“ ê´€ë ¨ ì´ìŠˆ

ì´ ìˆ˜ì •ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ í•´ê²°ë©ë‹ˆë‹¤:

- MCP ë„êµ¬ í˜¸ì¶œ ì‹œ ê°€ì§œ ë°ì´í„° ì‘ë‹µ
- GitHub API ì‹¤íŒ¨ ì‹œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì €ì¥ì†Œ ì •ë³´ ìƒì„±
- ì›¹ ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ í—ˆêµ¬ì˜ ê²€ìƒ‰ ê²°ê³¼ ì œê³µ
- íŒŒì¼ ì½ê¸° ì‹¤íŒ¨ ì‹œ ê°€ìƒì˜ íŒŒì¼ ë‚´ìš© ìƒì„±

---

## âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥

### ë°±ê·¸ë¼ìš´ë“œ ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì•Œë¦¼

ë‹¤ë¥¸ ëŒ€í™”ë¥¼ ë³´ê³  ìˆê±°ë‚˜ ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì— ìˆì„ ë•Œ ìŠ¤íŠ¸ë¦¬ë°ì´ ì™„ë£Œë˜ë©´ ì‹œìŠ¤í…œ ì•Œë¦¼ì„ í‘œì‹œí•©ë‹ˆë‹¤. Cursor, Claude Desktop, ChatGPT ë“±ì˜ AI ë„êµ¬ì™€ ë™ì¼í•œ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**

- âœ… **ìë™ ë°±ê·¸ë¼ìš´ë“œ ê°ì§€**: í˜„ì¬ í™œì„± ëŒ€í™”ì™€ ë‹¤ë¥¸ ëŒ€í™”ì˜ ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹œ ì•Œë¦¼
- âœ… **ì•± í¬ì»¤ìŠ¤ ì¶”ì **: ì•±ì´ ìµœì†Œí™”ë˜ê±°ë‚˜ ë‹¤ë¥¸ ì•±ì„ ì‚¬ìš© ì¤‘ì¼ ë•Œ ì•Œë¦¼
- âœ… **ì‹œìŠ¤í…œ ë„¤ì´í‹°ë¸Œ ì•Œë¦¼**: macOS/Windows ì•Œë¦¼ ì„¼í„°ì— í‘œì‹œ
- âœ… **ì›í´ë¦­ ì´ë™**: ì•Œë¦¼ í´ë¦­ ì‹œ í•´ë‹¹ ëŒ€í™”ë¡œ ìë™ ì „í™˜ ë° ì°½ ë³µì›

**êµ¬í˜„ ìƒì„¸:**

#### 1. Window Focus ìƒíƒœ ì¶”ì  (`lib/store/chat-store.ts`)

```typescript
interface ChatStore {
  isAppFocused: boolean; // Window focus state
  setAppFocused: (focused: boolean) => void;
}

// ì´ˆê¸° ìƒíƒœ
isAppFocused: true, // Initially focused
```

#### 2. Focus/Blur ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (`electron/main.ts`)

```typescript
mainWindow.on('focus', () => {
  mainWindow?.webContents.send('window:focus-changed', { focused: true });
});

mainWindow.on('blur', () => {
  mainWindow?.webContents.send('window:focus-changed', { focused: false });
});
```

#### 3. ë°±ê·¸ë¼ìš´ë“œ ê°ì§€ ë¡œì§ (`useMessageStreaming.ts`)

ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹œ ë‹¤ìŒ ì¡°ê±´ì„ ì²´í¬:

```typescript
const state = useChatStore.getState();
const isDifferentConversation = state.activeConversationId !== conversationId;
const isAppUnfocused = !state.isAppFocused;

if (isDifferentConversation || isAppUnfocused) {
  // ì‹œìŠ¤í…œ ì•Œë¦¼ í‘œì‹œ
  window.electronAPI.notification.show({
    conversationId,
    title: 'SEPilot',
    body: `"${title}" ëŒ€í™”ì˜ ì‘ë‹µì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`,
  });
}
```

#### 4. ì•Œë¦¼ IPC í•¸ë“¤ëŸ¬ (`electron/ipc/handlers/notification.ts`)

```typescript
export function setupNotificationHandlers(getMainWindow: () => BrowserWindow | null) {
  ipcMain.handle('notification:show', async (event, options) => {
    const notification = new Notification({
      title: options.title,
      body: options.body,
      silent: false,
      urgency: 'normal',
    });

    notification.on('click', () => {
      const mainWindow = getMainWindow();
      if (mainWindow) {
        if (mainWindow.isMinimized()) mainWindow.restore();
        mainWindow.show();
        mainWindow.focus();
        mainWindow.webContents.send('notification:click', options.conversationId);
      }
    });

    notification.show();
  });
}
```

#### 5. ì•Œë¦¼ í´ë¦­ ì²˜ë¦¬ (`app/page.tsx`)

```typescript
// ì•Œë¦¼ í´ë¦­ ë¦¬ìŠ¤ë„ˆ
const notificationCleanup = window.electronAPI.notification?.onClick((conversationId: string) => {
  useChatStore.getState().setActiveConversation(conversationId);
});
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

1. **ë‹¤ì¤‘ ëŒ€í™” ë™ì‹œ ì§„í–‰**: ëŒ€í™” Aì—ì„œ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ â†’ ëŒ€í™” Bë¡œ ì „í™˜ â†’ A ì™„ë£Œ ì‹œ ì•Œë¦¼ í‘œì‹œ
2. **ì•± ìµœì†Œí™” ì¤‘ ì™„ë£Œ**: ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ í›„ ì•± ìµœì†Œí™” â†’ ì™„ë£Œ ì‹œ ì•Œë¦¼ í‘œì‹œ
3. **ì•Œë¦¼ í´ë¦­ ë³µê·€**: ì•Œë¦¼ í´ë¦­ â†’ ì•± ë³µì› ë° í•´ë‹¹ ëŒ€í™”ë¡œ ìë™ ì „í™˜

**íƒ€ì… ì•ˆì „ì„±:**

- `types/electron.d.ts`ì— `NotificationAPI` ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€
- IPC í†µì‹ ì˜ ëª¨ë“  ë‹¨ê³„ê°€ TypeScriptë¡œ íƒ€ì… ì •ì˜ë¨

---

### Extension ê´€ë¦¬ UI ì¶”ê°€

Extension ì‹œìŠ¤í…œì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì „ìš© UIê°€ Settingsì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. Browser, Editor, Presentationê³¼ ê°™ì€ ë¹ŒíŠ¸ì¸ Extensionì„ í•œ ê³³ì—ì„œ í™œì„±í™”/ë¹„í™œì„±í™”í•˜ê³  ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì¶”ê°€ëœ ì»´í¬ë„ŒíŠ¸:**

#### 1. ExtensionCard ì»´í¬ë„ŒíŠ¸ (`components/settings/ExtensionCard.tsx`)

ê°œë³„ Extensionì„ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œí•˜ëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```typescript
export function ExtensionCard({
  manifest,
  isActive,
  canDeactivate,
  onToggle,
  onSettings,
  isToggling = false,
}: ExtensionCardProps) {
  // Extension ì•„ì´ì½˜, ì´ë¦„, ë²„ì „, ì‘ì„±ì í‘œì‹œ
  // ë² íƒ€ ë°°ì§€ í‘œì‹œ (betaFlagê°€ ìˆëŠ” ê²½ìš°)
  // ì˜ì¡´ì„± ëª©ë¡ í‘œì‹œ
  // í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€ ìŠ¤ìœ„ì¹˜
  // ì„¤ì • ë²„íŠ¼ (settingsTabì´ ìˆëŠ” ê²½ìš°)
}
```

**ì£¼ìš” ê¸°ëŠ¥:**

- âœ… Extension ë©”íƒ€ë°ì´í„° í‘œì‹œ (ì•„ì´ì½˜, ì´ë¦„, ë²„ì „, ì„¤ëª…, ì‘ì„±ì)
- âœ… ë² íƒ€ Extension ë°°ì§€ í‘œì‹œ
- âœ… ì˜ì¡´ì„± ëª©ë¡ ì‹œê°í™”
- âœ… í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€ (ì˜ì¡´ì„±ì´ ìˆëŠ” ê²½ìš° Tooltipìœ¼ë¡œ ì•ˆë‚´)
- âœ… ì„¤ì • íƒ­ìœ¼ë¡œ ë°”ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼

#### 2. ExtensionManagerTab ì»´í¬ë„ŒíŠ¸ (`components/settings/ExtensionManagerTab.tsx`)

Extension ê´€ë¦¬ ë©”ì¸ í™”ë©´ì…ë‹ˆë‹¤.

```typescript
export function ExtensionManagerTab({ onSectionChange, message }: ExtensionManagerTabProps) {
  const loadExtensions = () => {
    // Extension Registryì—ì„œ ì „ì²´ Extension ì¡°íšŒ
    // í™œì„±í™” ìƒíƒœ, ì˜ì¡´ì„± ì •ë³´ í™•ì¸
    // í™œì„±í™”ëœ Extension ìš°ì„  ì •ë ¬
  };

  const handleToggle = async (extensionId: string, enabled: boolean) => {
    // Extension í™œì„±í™”/ë¹„í™œì„±í™”
    // BetaConfig ë™ê¸°í™” (betaFlagê°€ ìˆëŠ” ê²½ìš°)
    // Extension ìƒíƒœ ì €ì¥ (AppConfig.extensions)
  };
}
```

**ì£¼ìš” ê¸°ëŠ¥:**

- âœ… Extension ëª©ë¡ í‘œì‹œ (í™œì„±í™”ëœ ê²ƒê³¼ ë¹„í™œì„±í™”ëœ ê²ƒ ë¶„ë¦¬)
- âœ… Extension í™œì„±í™”/ë¹„í™œì„±í™” ì²˜ë¦¬
- âœ… Extension ìƒíƒœ ì˜êµ¬ ì €ì¥ (`AppConfig.extensions`)
- âœ… BetaConfig ë™ê¸°í™” (Extensionì˜ `betaFlag`ê°€ ìˆëŠ” ê²½ìš°)
- âœ… ì˜ì¡´ì„± í™•ì¸ ë° ë¹„í™œì„±í™” ë°©ì§€
- âœ… ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€ í‘œì‹œ

**íƒ€ì… ì •ì˜ ì¶”ê°€ (`types/index.ts`):**

```typescript
export interface ExtensionStateConfig {
  [extensionId: string]: {
    enabled: boolean;
    settings?: Record<string, unknown>;
  };
}

export interface AppConfig {
  // ... ê¸°ì¡´ í•„ë“œë“¤
  extensions?: ExtensionStateConfig;
}
```

**Registry ë©”ì„œë“œ ì¶”ê°€ (`lib/extensions/registry.ts`):**

```typescript
// íŠ¹ì • Extensionì— ì˜ì¡´í•˜ëŠ” í™œì„±í™”ëœ Extension ì¡°íšŒ
getDependents(id: string): ExtensionDefinition[] {
  return Array.from(this.extensions.values())
    .filter((entry) => entry.isActive && entry.definition.manifest.dependencies?.includes(id))
    .map((entry) => entry.definition);
}

// Extension ë¹„í™œì„±í™” ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ (ë‹¤ë¥¸ í™œì„±í™”ëœ Extensionì´ ì˜ì¡´í•˜ê³  ìˆìœ¼ë©´ ë¶ˆê°€)
canDeactivate(id: string): boolean {
  const dependents = this.getDependents(id);
  return dependents.length === 0;
}
```

**ìƒíƒœ ë³µì› ë¡œì§ (`lib/extensions/loader.ts`):**

```typescript
async function loadExtensionsConfig(): Promise<ExtensionStateConfig> {
  // Electron í™˜ê²½ì—ì„œëŠ” electronAPI.config.load()ë¡œ ë¡œë“œ
  // ì›¹ í™˜ê²½ì—ì„œëŠ” localStorageì—ì„œ ë¡œë“œ
  // ì €ì¥ëœ Extension í™œì„±í™” ìƒíƒœ ë°˜í™˜
}

// Extension ë¡œë”© ì‹œ ì €ì¥ëœ ìƒíƒœ ë³µì›
// manifest.enabledë³´ë‹¤ ì €ì¥ëœ ìƒíƒœ ìš°ì„ 
```

**Settings UI í†µí•©:**

1. `components/settings/SettingsSidebar.tsx`
   - 'extensions' íƒ­ ì¶”ê°€ (Puzzle ì•„ì´ì½˜)
   - Features ì¹´í…Œê³ ë¦¬ì— ë°°ì¹˜

2. `components/settings/SettingsDialog.tsx`
   - ExtensionManagerTab ë Œë”ë§ ì¶”ê°€

**ë‹¤êµ­ì–´ ì§€ì› ì¶”ê°€ (`locales/ko.json`, `en.json`, `zh.json`):**

```json
{
  "settings": {
    "extensions": {
      "title": "Extension ê´€ë¦¬",
      "description": "ì•± ê¸°ëŠ¥ì„ í™•ì¥í•˜ëŠ” Extensionì„ ê´€ë¦¬í•©ë‹ˆë‹¤",
      "activeExtensions": "í™œì„±í™”ëœ Extension",
      "availableExtensions": "ì‚¬ìš© ê°€ëŠ¥í•œ Extension",
      "noDependencies": "ì˜ì¡´ì„± ì—†ìŒ",
      "dependencies": "ì˜ì¡´ì„±",
      "betaBadge": "ë² íƒ€",
      "cannotDeactivate": "ë‹¤ë¥¸ Extensionì´ ì´ Extensionì— ì˜ì¡´í•˜ê³  ìˆì–´ ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      "goToSettings": "ì„¤ì •",
      "version": "ë²„ì „",
      "author": "ì‘ì„±ì",
      "saved": "Extension ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤",
      "saveFailed": "Extension ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",
      "notFound": "Extensionì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
    }
  }
}
```

**ë°ì´í„° íë¦„:**

```
Extension ëª©ë¡ ë¡œë“œ
  â†’ extensionRegistry.getAll()
  â†’ í™œì„±í™” ìƒíƒœ í™•ì¸ (ì €ì¥ëœ ìƒíƒœ ìš°ì„ )
  â†’ UIì— í‘œì‹œ

ì‚¬ìš©ì í† ê¸€ ì•¡ì…˜
  â†’ extensionRegistry.activate/deactivate
  â†’ BetaConfig ë™ê¸°í™” (betaFlagê°€ ìˆëŠ” ê²½ìš°)
  â†’ AppConfig.extensionsì— ìƒíƒœ ì €ì¥
  â†’ UI ì—…ë°ì´íŠ¸

ì•± ì¬ì‹œì‘
  â†’ loadExtensionsConfig()ë¡œ ì €ì¥ëœ ìƒíƒœ ë¡œë“œ
  â†’ ì €ì¥ëœ ìƒíƒœì— ë”°ë¼ Extension í™œì„±í™”
  â†’ manifest.enabledëŠ” ê¸°ë³¸ê°’ìœ¼ë¡œë§Œ ì‚¬ìš©
```

**ì‚¬ìš©ì ê²½í—˜ ê°œì„ :**

- âœ… Settingsì—ì„œ ëª¨ë“  Extensionì„ í•œëˆˆì— í™•ì¸
- âœ… ì›í´ë¦­ìœ¼ë¡œ Extension í™œì„±í™”/ë¹„í™œì„±í™”
- âœ… Extension ê°„ ì˜ì¡´ì„± ìë™ ê´€ë¦¬
- âœ… Extensionë³„ ì„¤ì • í˜ì´ì§€ë¡œ ë¹ ë¥¸ ì´ë™
- âœ… ë² íƒ€ Extension ëª…í™•í•œ í‘œì‹œ
- âœ… ë‹¤êµ­ì–´ ì§€ì› (í•œêµ­ì–´, ì˜ì–´, ì¤‘êµ­ì–´)

**ì½”ë“œ í’ˆì§ˆ ê°œì„ :**

- âœ… ì˜ì¡´ì„± í‘œì‹œ ë¡œì§ ê°œì„  (ë¹ˆ ë°°ì—´ ì²˜ë¦¬)
- âœ… íƒ€ì… ì•ˆì „ì„± ê°•í™” (`Partial<AppConfig>` ì‚¬ìš©)
- âœ… ì—ëŸ¬ ë©”ì‹œì§€ ë‹¤êµ­ì–´ ì§€ì›
- âœ… Settings ì•„ì´ì½˜ ì˜ë¯¸ ëª…í™•í™” (Puzzle ì‚¬ìš©)

**ì˜í–¥ë°›ëŠ” íŒŒì¼:**

- **ì‹ ê·œ ìƒì„± (2ê°œ)**
  - `components/settings/ExtensionCard.tsx`
  - `components/settings/ExtensionManagerTab.tsx`

- **ìˆ˜ì • (7ê°œ)**
  - `types/index.ts`
  - `lib/extensions/registry.ts`
  - `lib/extensions/loader.ts`
  - `components/settings/SettingsSidebar.tsx`
  - `components/settings/SettingsDialog.tsx`
  - `locales/ko.json`, `en.json`, `zh.json`

### Monaco Editorì™€ Coding Agent í†µí•© ê°•í™”

Claude Desktopê³¼ ë™ë“±í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ìœ„í•´ Monaco Editorì˜ í…ìŠ¤íŠ¸ ì„ íƒ ê¸°ëŠ¥ì´ Coding Agentì™€ ì™„ì „íˆ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤.

**ì¶”ê°€ëœ ê¸°ëŠ¥:**

#### Monaco Editor Selection Change Listener (`extensions/editor/components/Editor.tsx`)

```typescript
// Monaco editor selection change listener
useEffect(() => {
  if (!editor || !monacoInstance) {
    return;
  }

  // Listen to cursor selection changes
  const disposable = editor.onDidChangeCursorSelection((e) => {
    const selection = e.selection;
    const model = editor.getModel();

    if (!model) {
      setActiveFileSelection(null);
      return;
    }

    // Check if there's a non-empty selection
    const hasSelection =
      !selection.isEmpty() &&
      (selection.startLineNumber !== selection.endLineNumber ||
        selection.startColumn !== selection.endColumn);

    if (hasSelection) {
      // Get selected text
      const selectedText = model.getValueInRange(selection);

      // Update store with selection info
      setActiveFileSelection({
        text: selectedText,
        range: {
          startLineNumber: selection.startLineNumber,
          startColumn: selection.startColumn,
          endLineNumber: selection.endLineNumber,
          endColumn: selection.endColumn,
        },
      });
    } else {
      // No selection - clear it
      setActiveFileSelection(null);
    }
  });

  // Cleanup listener on unmount
  return () => {
    disposable.dispose();
  };
}, [editor, monacoInstance, setActiveFileSelection]);
```

**ì£¼ìš” ê°œì„ ì‚¬í•­:**

- âœ… ì—ë””í„°ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ `activeFileSelection` ìƒíƒœ ì—…ë°ì´íŠ¸
- âœ… ì„ íƒëœ í…ìŠ¤íŠ¸ì™€ ì •í™•í•œ ìœ„ì¹˜ ì •ë³´(range) ì €ì¥
- âœ… Coding Agentê°€ ì‚¬ìš©ìê°€ ì„ íƒí•œ í…ìŠ¤íŠ¸ë¥¼ ì¸ì‹í•˜ê³  í™œìš© ê°€ëŠ¥
- âœ… `replace_selection` ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ íƒëœ í…ìŠ¤íŠ¸ ìˆ˜ì • ê°€ëŠ¥
- âœ… Claude Desktopê³¼ ë™ì¼í•œ ì›Œí¬í”Œë¡œìš° ì œê³µ

**ë°ì´í„° íë¦„:**

```
Monaco Editor í…ìŠ¤íŠ¸ ì„ íƒ
  â†’ onDidChangeCursorSelection ì´ë²¤íŠ¸
  â†’ setActiveFileSelection (store ì—…ë°ì´íŠ¸)
  â†’ getGraphConfig (GraphConfigì— í¬í•¨)
  â†’ IPCë¥¼ í†µí•´ Coding Agentì— ì „ë‹¬
  â†’ Coding Agentê°€ ì„ íƒëœ í…ìŠ¤íŠ¸ ì¸ì‹
  â†’ replace_selection ë„êµ¬ë¡œ í…ìŠ¤íŠ¸ ìˆ˜ì • ê°€ëŠ¥
```

**ì‚¬ìš©ì ê²½í—˜ ê°œì„ :**

- âœ… ì—ë””í„°ì—ì„œ ì½”ë“œë¥¼ ì„ íƒí•˜ê³  ì±„íŒ…ìœ¼ë¡œ "ì´ ë¶€ë¶„ì„ ê°œì„ í•´ì¤˜" ìš”ì²­ ê°€ëŠ¥
- âœ… Coding Agentê°€ ì •í™•íˆ ì„ íƒëœ ë¶€ë¶„ë§Œ ìˆ˜ì •
- âœ… íŒŒì¼ ì „ì²´ê°€ ì•„ë‹Œ íŠ¹ì • ì½”ë“œ ë¸”ë¡ì— ëŒ€í•œ ì‘ì—… ê°€ëŠ¥
- âœ… Claude Desktopê³¼ ë™ì¼í•œ ì‚¬ìš©ì ê²½í—˜

**ì˜í–¥ë°›ëŠ” íŒŒì¼:**

1. `extensions/editor/components/Editor.tsx`
   - `setActiveFileSelection` ì¶”ê°€
   - `onDidChangeCursorSelection` listener êµ¬í˜„

2. `extensions/editor/components/SingleFileEditor.tsx` â­ **NEW**
   - `editor:replace-selection` IPC listener êµ¬í˜„
   - Coding Agentê°€ ì„ íƒëœ í…ìŠ¤íŠ¸ë¥¼ ì‹¤ì œë¡œ êµì²´í•  ìˆ˜ ìˆë„ë¡ ì—°ê²°

3. `lib/mcp/tools/builtin-tools.ts`
   - `replace_selection` ë„êµ¬ ì •ì˜ ë° IPC ì´ë²¤íŠ¸ ë°œì†¡

4. `lib/langgraph/graphs/coding-agent.ts`
   - ì´ë¯¸ `state.activeFileSelection` ì²˜ë¦¬ ë¡œì§ êµ¬í˜„ë¨ (Line 555-570, 822-839)

5. `lib/store/chat-store.ts`
   - `getGraphConfig()` ì´ë¯¸ `activeFileSelection` í¬í•¨ ì¤‘

6. `extensions/editor/agents/editor-agent-advanced.ts`
   - `EditorAgentState`ì— `workingDirectory` íƒ€ì… ì¶”ê°€

### ğŸ”§ Critical Fix: IPC Listener ì¶”ê°€

**ì´ì „ ë¬¸ì œ:**

- `replace_selection` ë„êµ¬ê°€ ì •ì˜ë˜ì–´ ìˆê³  IPC ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ì§€ë§Œ
- SingleFileEditorì— ì´ë²¤íŠ¸ë¥¼ ë°›ëŠ” listenerê°€ ì—†ì–´ì„œ ì‹¤ì œ í…ìŠ¤íŠ¸ êµì²´ ë¶ˆê°€

**í•´ê²°:**

```typescript
// SingleFileEditor.tsx - IPC listener ì¶”ê°€
useEffect(() => {
  if (!editor || !isElectron() || !window.electronAPI) {
    return;
  }

  const handleReplaceSelection = (...args: unknown[]) => {
    const newText = args[0] as string;
    const selection = editor.getSelection();

    if (!selection) return;

    // Replace the selected text
    editor.executeEdits('replace-selection', [
      {
        range: selection,
        text: newText,
      },
    ]);

    // Mark file as dirty
    if (onChange) {
      onChange(editor.getValue());
    }
  };

  window.electronAPI.on('editor:replace-selection', handleReplaceSelection);

  return () => {
    window.electronAPI.removeListener('editor:replace-selection', handleReplaceSelection);
  };
}, [editor, onChange]);
```

**ì™„ì„±ë„:**

- âœ… 100% Claude Desktop ë™ë“± ê¸°ëŠ¥ ë‹¬ì„±
- âœ… ì „ì²´ ë°ì´í„° íë¦„ ì™„ì„±: Editor Selection â†’ Store â†’ GraphConfig â†’ IPC â†’ Coding Agent â†’ replace_selection ë„êµ¬ â†’ IPC ì´ë²¤íŠ¸ â†’ Editor í…ìŠ¤íŠ¸ êµì²´

---

## âš ï¸ Breaking Changes

ì—†ìŒ. ì´ ìˆ˜ì •ì€ ë‚´ë¶€ ë¡œì§ ê°œì„ ì´ë©° API ì¸í„°í˜ì´ìŠ¤ëŠ” ë³€ê²½ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

---

**ì „ì²´ ë³€ê²½ ë¡œê·¸**: [v0.7.3...v0.7.4](https://github.com/jhl-labs/sepilot_desktop/compare/v0.7.3...v0.7.4)
